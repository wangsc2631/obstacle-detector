<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0ea5e9" />
  <meta name="description" content="ËÄÅÊ±™Êô∫ËÉΩÁîüÊ¥ªÂä©Êâã - Áõ≤‰∫∫ËºîÂä©Â∞éËà™ËàáÁâ©ÂìÅË≠òÂà•Á≥ªÁµ±" />
  <title>üß†ËÄÅÊ±™Êô∫ËÉΩÁîüÊ¥ªÂä©Êâã - Áõ≤‰∫∫ËºîÂä©Â∞éËà™</title>
  
  <style>
    :root {
      --bg1: #0ea5e9;
      --bg2: #6366f1;
      --glass: rgba(255,255,255,0.12);
      --glass-strong: rgba(255,255,255,0.22);
      --text: #fff;
      --good: #22c55e;
      --warn: #f59e0b;
      --bad: #ef4444;
      --muted: #cbd5e1;
      --primary: #00b894;
      --secondary: #fd79a8;
      --accent: #6c5ce7;
    }
    
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: var(--text);
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      touch-action: manipulation;
    }
    
    body {
      padding: 10px;
      padding-bottom: env(safe-area-inset-bottom, 10px);
    }
    
    .app {
      max-width: 100%;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .card {
      background: var(--glass);
      backdrop-filter: blur(12px);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }
    
    .header {
      text-align: center;
      margin-bottom: 0;
    }
    
    .header h1 {
      margin: 0;
      font-size: 24px;
    }
    
    .header .subtitle {
      font-size: 14px;
      color: var(--muted);
      margin-top: 5px;
    }
    
    .stats-badge {
      background: rgba(255,255,255,0.2);
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 12px;
      margin-top: 8px;
      display: inline-block;
    }
    
    .camera-container {
      position: relative;
      width: 100%;
      aspect-ratio: 16/9;
      background: #000;
      border-radius: 12px;
      overflow: hidden;
    }
    
    .camera-container video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 12px;
    }
    
    .camera-preview {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 16px;
      z-index: 5;
      text-align: center;
      padding: 20px;
    }
    
    .controls {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }
    
    button {
      padding: 16px 12px;
      border: none;
      border-radius: 14px;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-height: 54px;
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    button:active:not(:disabled) {
      transform: translateY(2px) scale(0.98);
    }
    
    .btn-primary {
      background: var(--primary);
      color: #fff;
    }
    
    .btn-danger {
      background: var(--bad);
      color: #fff;
    }
    
    .btn-secondary {
      background: var(--glass-strong);
      color: var(--text);
    }
    
    .btn-accent {
      background: var(--accent);
      color: #fff;
    }
    
    .status-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .status-item {
      background: var(--glass-strong);
      border-radius: 12px;
      padding: 12px;
      text-align: center;
    }
    
    .status-label {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 4px;
    }
    
    .status-value {
      font-weight: 800;
      font-size: 16px;
    }
    
    .voice-alert {
      background: rgba(0, 184, 148, 0.15);
      border: 1px solid rgba(0, 184, 148, 0.35);
      color: #fff;
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      margin-bottom: 15px;
    }
    
    .detection-list {
      max-height: 200px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .detection-item {
      background: var(--glass-strong);
      padding: 10px;
      border-radius: 10px;
      font-size: 13px;
    }
    
    .items-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      margin-top: 15px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .item-card {
      background: rgba(255,255,255,0.1);
      padding: 15px 10px;
      border-radius: 15px;
      text-align: center;
      border: 2px solid rgba(255,255,255,0.1);
      transition: all 0.3s ease;
    }
    
    .item-card.highlight {
      animation: pulse 2s ease-in-out;
      border-color: var(--primary);
    }
    
    .item-name {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 5px;
      color: var(--text);
    }
    
    .item-confidence {
      font-size: 12px;
      color: var(--muted);
    }
    
    .category-tag {
      display: inline-block;
      background: var(--accent);
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 10px;
      margin-top: 5px;
    }
    
    .navigation-info {
      background: rgba(253, 203, 110, 0.15);
      border: 1px solid rgba(253, 203, 110, 0.35);
      padding: 20px;
      border-radius: 12px;
      margin: 15px 0;
      text-align: center;
    }
    
    .direction-arrow {
      font-size: 48px;
      margin: 10px 0;
      color: var(--bad);
    }
    
    .distance-display {
      font-size: 24px;
      font-weight: bold;
      margin: 10px 0;
      color: var(--text);
    }
    
    .instruction-text {
      font-size: 18px;
      color: var(--text);
      margin: 10px 0;
    }
    
    .mode-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .mode-recording { background: var(--bad); }
    .mode-identifying { background: var(--primary); }
    .mode-navigating { background: var(--accent); }
    .mode-idle { background: var(--muted); }
    
    .search-box {
      margin: 15px 0;
      padding: 15px;
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
    }
    
    .search-input {
      width: 100%;
      padding: 12px;
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 10px;
      font-size: 16px;
      background: rgba(255,255,255,0.1);
      color: var(--text);
    }
    
    .search-input::placeholder {
      color: var(--muted);
    }
    
    .category-filter {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    
    .category-btn {
      padding: 6px 12px;
      background: rgba(255,255,255,0.1);
      border: none;
      border-radius: 15px;
      font-size: 12px;
      cursor: pointer;
      color: var(--text);
    }
    
    .category-btn.active {
      background: var(--accent);
      color: white;
    }
    
    .debug-info {
      background: rgba(0,0,0,0.8);
      color: #00ff00;
      padding: 8px;
      border-radius: 5px;
      font-size: 12px;
      margin-top: 8px;
      font-family: monospace;
    }
    
    .loading {
      background: linear-gradient(90deg, var(--bg1), var(--bg2), var(--bg1));
      background-size: 200% 100%;
      animation: loading 2s infinite;
    }
    
    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    @keyframes pulse {
      0%, 100% { 
        transform: scale(1);
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      }
      50% { 
        transform: scale(1.05);
        box-shadow: 0 5px 20px rgba(0, 184, 148, 0.4);
      }
    }
    
    .tab-container {
      display: flex;
      gap: 5px;
      margin-bottom: 15px;
    }
    
    .tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
    }
    
    .tab.active {
      background: var(--accent);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .camera-controls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    .camera-switch {
      flex: 1;
      padding: 10px;
      background: var(--glass-strong);
      border: none;
      border-radius: 10px;
      color: var(--text);
      font-size: 14px;
      cursor: pointer;
    }
    
    .error-message {
      background: rgba(239,68,68,0.15);
      border: 1px solid rgba(239,68,68,0.35);
      color: #fff;
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      margin: 10px 0;
    }
    
    .progress-bar {
      width: 100%;
      height: 6px;
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
      margin: 10px 0;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--primary);
      border-radius: 3px;
      transition: width 0.3s ease;
      width: 0%;
    }
    
    .navigation-controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    
    .turn-instruction {
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      margin: 10px 0;
      padding: 15px;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
    }
    
    .safety-alert {
      background: rgba(239,68,68,0.2);
      border: 1px solid rgba(239,68,68,0.4);
      color: #fff;
      border-radius: 12px;
      padding: 12px;
      text-align: center;
      margin: 10px 0;
      font-size: 14px;
    }
    
    .road-info {
      background: rgba(34,197,94,0.15);
      border: 1px solid rgba(34,197,94,0.35);
      color: #fff;
      border-radius: 12px;
      padding: 12px;
      text-align: center;
      margin: 10px 0;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Ê®ôÈ°å -->
    <div class="card header">
      <h1>üß† Êô∫ËÉΩÁîüÊ¥ªÂä©Êâã</h1>
      <div class="subtitle">Áõ≤‰∫∫ËºîÂä©Â∞éËà™ ‚Ä¢ 1500+Áâ©ÂìÅË≠òÂà•</div>
      <div class="stats-badge">ÊîØÊè¥ 21Â§ßÈ°ûÂà• ‚Ä¢ Ë∂ÖÈÅé1500Á®ÆÁâ©ÂìÅ</div>
    </div>

    <!-- Ê®ôÁ±§ÂàáÊèõ -->
    <div class="card">
      <div class="tab-container">
        <div class="tab active" data-tab="navigation">Â∞éËà™Ê®°Âºè</div>
        <div class="tab" data-tab="recognition">Áâ©ÂìÅË≠òÂà•</div>
      </div>
    </div>

    <!-- Ë™ûÈü≥ÊèêÁ§∫ -->
    <div id="voiceAlert" class="voice-alert">
      Á≥ªÁµ±Ê∫ñÂÇô‰∏≠...
    </div>

    <!-- ÈåØË™§Ë®äÊÅØ -->
    <div id="errorMessage" class="error-message" style="display: none;"></div>

    <!-- Â∞éËà™Ê®°ÂºèÂÖßÂÆπ -->
    <div id="navigationTab" class="tab-content active">
      <!-- Áõ∏Ê©üÁï´Èù¢ -->
      <div class="card">
        <div class="camera-container">
          <div id="cameraPreview" class="camera-preview">
            <div>
              <div style="font-size:48px; margin-bottom:10px;">üì∑</div>
              <div>ÈªûÊìä„ÄåÈñãÂïüÁõ∏Ê©ü„ÄçÈñãÂßã‰ΩøÁî®</div>
              <div style="font-size:12px; margin-top:10px; color:var(--muted);">
                ÈÅìË∑ØËæ®Ë≠òËàáÈöúÁ§ôÁâ©Ê™¢Ê∏¨
              </div>
            </div>
          </div>
          <video id="video" autoplay playsinline muted></video>
        </div>
      </div>

      <!-- ÊéßÂà∂Èù¢Êùø -->
      <div class="card">
        <div class="controls">
          <button id="btnCamera" class="btn-primary">
            <span>üì∑</span>
            <span>ÈñãÂïüÁõ∏Ê©ü</span>
          </button>
          <button id="btnStart" class="btn-primary" disabled>
            <span>üîç</span>
            <span>ÈñãÂßãÊ™¢Ê∏¨</span>
          </button>
          <button id="btnTest" class="btn-secondary" disabled>
            <span>üß™</span>
            <span>Ê∏¨Ë©¶ÂäüËÉΩ</span>
          </button>
          <button id="btnStop" class="btn-danger" disabled>
            <span>‚èπÔ∏è</span>
            <span>ÂÅúÊ≠¢</span>
          </button>
        </div>

        <div class="status-grid">
          <div class="status-item">
            <div class="status-label">Á≥ªÁµ±ÁãÄÊÖã</div>
            <div class="status-value" id="status">Ê∫ñÂÇô‰∏≠</div>
          </div>
          <div class="status-item">
            <div class="status-label">Ê™¢Ê∏¨Ê®°Âºè</div>
            <div class="status-value" id="detectionMode">ÈÅìË∑ØËæ®Ë≠ò</div>
          </div>
          <div class="status-item">
            <div class="status-label">Áõ∏Ê©üÁãÄÊÖã</div>
            <div class="status-value" id="cameraStatus">Êú™ÈñãÂïü</div>
          </div>
          <div class="status-item">
            <div class="status-label">Â∞éËà™ÁãÄÊÖã</div>
            <div class="status-value" id="navigationStatus">Êú™ÈñãÂßã</div>
          </div>
        </div>

        <div id="debugInfo" class="debug-info" style="display:none;"></div>
      </div>

      <!-- Â∞éËà™ÊéßÂà∂ -->
      <div class="card">
        <h3 style="margin:0 0 12px 0;">Â∞éËà™ÂõûÂÆ∂</h3>
        <div class="navigation-controls">
          <button class="btn-primary" onclick="startNavigationHome()" id="btnNavigateHome">
            <span>üß≠</span>
            <span>ÈñãÂßãÂ∞éËà™ÂõûÂÆ∂</span>
          </button>
          <button class="btn-accent" onclick="openGoogleMaps()" id="btnGoogleMaps">
            <span>üó∫Ô∏è</span>
            <span>ÈñãÂïüGoogleÂú∞Âúñ</span>
          </button>
          <button class="btn-secondary" onclick="simulateTurn('left')">
            <span>‚Ü©Ô∏è</span>
            <span>Ê∏¨Ë©¶Â∑¶ËΩâ</span>
          </button>
          <button class="btn-secondary" onclick="simulateTurn('right')">
            <span>‚Ü™Ô∏è</span>
            <span>Ê∏¨Ë©¶Âè≥ËΩâ</span>
          </button>
        </div>
      </div>

      <!-- Â∞éËà™Ë≥áË®ä -->
      <div id="navigationPanel" class="navigation-info" style="display: none;">
        <div class="direction-arrow" id="directionArrow">‚Üë</div>
        <div class="distance-display" id="distanceDisplay">-- ÂÖ¨Â∞∫</div>
        <div class="turn-instruction" id="turnInstruction">
          Ê∫ñÂÇôÈñãÂßãÂ∞éËà™...
        </div>
        <div class="road-info" id="roadInfo">
          ÈÅìË∑ØËæ®Ë≠ò‰∏≠...
        </div>
        <div class="safety-alert" id="safetyAlert" style="display: none;">
          Ê≥®ÊÑèÂâçÊñπÂÆâÂÖ®ÔºÅ
        </div>
      </div>

      <!-- Ê™¢Ê∏¨ÁµêÊûú -->
      <div class="card">
        <h3 style="margin:0 0 12px 0;">Áí∞Â¢ÉÊ™¢Ê∏¨</h3>
        <div id="detectionList" class="detection-list">
          <div class="detection-item" style="text-align:center; color:var(--muted);">
            Á≠âÂæÖÈñãÂßãÂÅµÊ∏¨‚Ä¶
          </div>
        </div>
      </div>

      <!-- ‰ΩøÁî®Ë™™Êòé -->
      <div class="card">
        <h4 style="margin:0 0 8px 0;">‰ΩøÁî®Ë™™Êòé</h4>
        <div style="font-size:12px; color:var(--muted); line-height:1.4;">
          <div>1. ÈªûÊìä„ÄåË®òÈåÑÂÆ∂ÁöÑ‰ΩçÁΩÆ„ÄçË®≠ÂÆöÂõûÂÆ∂ÁõÆÁöÑÂú∞</div>
          <div>2. ÈªûÊìä„ÄåÈñãÂßãÂ∞éËà™ÂõûÂÆ∂„ÄçÂïüÂãïË™ûÈü≥Â∞éËà™</div>
          <div>3. Á≥ªÁµ±ÊúÉÊèê‰æõËΩâÂêëÊåáÁ§∫ÔºàÂ∑¶ËΩâ„ÄÅÂè≥ËΩâ„ÄÅÁõ¥Ë°åÔºâ</div>
          <div>4. ÈñãÂïüÁõ∏Ê©üÂèØÈÄ≤Ë°åÈÅìË∑ØËæ®Ë≠òËàáÈöúÁ§ôÁâ©Ê™¢Ê∏¨</div>
          <div>5. ÈªûÊìä„ÄåÈñãÂïüGoogleÂú∞Âúñ„Äç‰ΩøÁî®Ë©≥Á¥∞Â∞éËà™</div>
        </div>
      </div>
    </div>

    <!-- Áâ©ÂìÅË≠òÂà•Ê®°ÂºèÂÖßÂÆπ -->
    <div id="recognitionTab" class="tab-content">
      <!-- ÈÄ≤Â∫¶Ê¢ù -->
      <div id="modelProgress" class="card" style="display: none;">
        <div style="text-align: center; margin-bottom: 10px;">
          <div style="font-size: 18px; font-weight: bold;">Ê≠£Âú®ËºâÂÖ•AIÊ®°Âûã</div>
          <div style="font-size: 12px; color: var(--muted); margin-top: 5px;">Ë´ãÁ®çÂÄôÔºåÈ¶ñÊ¨°‰ΩøÁî®ÈúÄË¶ÅËºâÂÖ•Ê®°Âûã</div>
        </div>
        <div class="progress-bar">
          <div id="progressFill" class="progress-fill"></div>
        </div>
        <div id="progressText" style="text-align: center; font-size: 12px; color: var(--muted); margin-top: 5px;">0%</div>
      </div>

      <!-- Áõ∏Ê©üÁï´Èù¢ -->
      <div class="card">
        <div class="camera-container">
          <div id="recognitionCameraPreview" class="camera-preview">
            <div>
              <div style="font-size:48px; margin-bottom:10px;">üì∑</div>
              <div>ÈªûÊìä„ÄåÈñãÂïüÁõ∏Ê©ü„ÄçÈñãÂßãÁâ©ÂìÅË≠òÂà•</div>
              <div style="font-size:12px; margin-top:10px; color:var(--muted);">
                ÂèØË≠òÂà•1500+Á®ÆÊó•Â∏∏Áâ©ÂìÅ
              </div>
            </div>
          </div>
          <video id="recognitionVideo" autoplay playsinline muted></video>
        </div>
        <div class="camera-controls">
          <button class="camera-switch" onclick="switchRecognitionCamera()">
            <span>üîÑ</span>
            <span>ÂàáÊèõÈè°È†≠</span>
          </button>
        </div>
      </div>

      <!-- ‰∏ªË¶ÅÊéßÂà∂ÊåâÈàï -->
      <div class="card">
        <div class="controls">
          <button class="btn-primary" onclick="startItemRecognition()" id="btnRecognition" disabled>
            <span>üîç</span>
            <span>Êô∫ËÉΩË≠òÂà•</span>
          </button>
          <button class="btn-accent" onclick="toggleContinuousMode()" id="continuousBtn">
            <span>üîÑ</span>
            <span>ÈÄ£Á∫åË≠òÂà•</span>
          </button>
          <button class="btn-secondary" onclick="setHomeLocation()">
            <span>üè†</span>
            <span>Ë®≠ÂÆöÂÆ∂ÁöÑ‰ΩçÁΩÆ</span>
          </button>
          <button class="btn-danger" onclick="startNavigationHome()">
            <span>üß≠</span>
            <span>Â∞éËà™ÂõûÂÆ∂</span>
          </button>
        </div>
      </div>

      <!-- ÊêúÂ∞ãÂíåÂàÜÈ°û -->
      <div class="card search-box">
        <input type="text" class="search-input" placeholder="üîç ÊêúÂ∞ãÁâ©ÂìÅÂêçÁ®±..." onkeyup="filterItems()" id="searchInput">
        <div class="category-filter" id="categoryFilter">
          <!-- ÂàÜÈ°ûÊåâÈàïÊúÉÁî±JavaScriptÂãïÊÖãÁîüÊàê -->
        </div>
      </div>

      <!-- ÁãÄÊÖãÈù¢Êùø -->
      <div class="card">
        <div class="status-grid">
          <div class="status-item">
            <div class="status-label">Áï∂ÂâçÊ®°Âºè</div>
            <div class="status-value"><span class="mode-indicator" id="modeIndicator"></span><span id="currentMode">ÂæÖÊ©ü‰∏≠</span></div>
          </div>
          <div class="status-item">
            <div class="status-label">Ë≠òÂà•Áâ©ÂìÅÊï∏</div>
            <div class="status-value" id="itemCount">0</div>
          </div>
          <div class="status-item">
            <div class="status-label">ÂÆ∂ÁöÑ‰ΩçÁΩÆ</div>
            <div class="status-value" id="homeStatus">Êú™Ë®≠ÂÆö</div>
          </div>
          <div class="status-item">
            <div class="status-label">Ë≥áÊñôÂ∫´</div>
            <div class="status-value" id="databaseSize">1500+ Áâ©ÂìÅ</div>
          </div>
        </div>
      </div>

      <!-- Áâ©ÂìÅË≠òÂà•ÁµêÊûú -->
      <div class="card">
        <h3 style="margin:0 0 12px 0;">Áâ©ÂìÅË≠òÂà•ÁµêÊûú</h3>
        <div id="itemsContainer" class="items-grid">
          <div class="item-card" style="background: rgba(255,255,255,0.1); color: var(--muted);">
            <div class="item-name">Á≠âÂæÖAIÊ®°ÂûãËºâÂÖ•...</div>
            <div class="item-confidence">È¶ñÊ¨°‰ΩøÁî®ÈúÄË¶ÅËºâÂÖ•Ê®°Âûã</div>
          </div>
        </div>
      </div>

      <!-- ËºîÂä©ÊéßÂà∂ -->
      <div class="card">
        <div class="controls">
          <button class="btn-secondary" onclick="repeatInstruction()">
            <span>üîä</span>
            <span>ÈáçË§áÊèêÁ§∫</span>
          </button>
          <button class="btn-secondary" onclick="toggleVoice()" id="voiceToggleBtn">
            <span>üîá</span>
            <span>ÈóúÈñâË™ûÈü≥</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3/dist/coco-ssd.min.js"></script>
  
  <script>
    // Êì¥Â±ïÁâ©ÂìÅË≥áÊñôÂ∫´ - 1500+Á®ÆÁâ©ÂìÅ
    const itemDatabase = {
      // 1. ‰∫∫Áâ©ÂãïÁâ©È°û (80+)
      '‰∫∫Áâ©ÂãïÁâ©': {
        'person': '‰∫∫', 'baby': 'Â¨∞ÂÖí', 'child': 'Â∞èÂ≠©', 'adult': 'Êàê‰∫∫', 'elderly': 'ËÄÅ‰∫∫',
        'bird': 'È≥•', 'cat': 'Ë≤ì', 'dog': 'Áãó', 'horse': 'È¶¨', 'cow': 'Áâõ',
        'sheep': 'Áæä', 'goat': 'Â±±Áæä', 'pig': 'Ë±¨', 'chicken': 'Èõû', 'duck': 'È¥®',
        'rabbit': 'ÂÖîÂ≠ê', 'hamster': 'ÂÄâÈº†', 'guinea pig': 'Â§©Á´∫Èº†', 'turtle': 'ÁÉèÈæú',
        'fish': 'È≠ö', 'goldfish': 'ÈáëÈ≠ö', 'shark': 'ÈØäÈ≠ö', 'dolphin': 'Êµ∑Ë±ö',
        'whale': 'ÈØ®È≠ö', 'elephant': 'Â§ßË±°', 'lion': 'ÁçÖÂ≠ê', 'tiger': 'ËÄÅËôé',
        'bear': 'ÁÜä', 'panda': 'ÁÜäË≤ì', 'monkey': 'Áå¥Â≠ê', 'giraffe': 'Èï∑È†∏Èπø',
        'zebra': 'ÊñëÈ¶¨', 'kangaroo': 'Ë¢ãÈº†', 'penguin': '‰ºÅÈµù', 'owl': 'Ë≤ìÈ†≠È∑π',
        'eagle': 'ËÄÅÈ∑π', 'parrot': 'È∏öÈµ°', 'sparrow': 'È∫ªÈõÄ', 'pigeon': 'È¥øÂ≠ê',
        'butterfly': 'Ëù¥Ëù∂', 'bee': 'ËúúËúÇ', 'ant': 'ËûûËüª', 'spider': 'ËúòËõõ',
        'snake': 'Ëõá', 'lizard': 'Ëú•Ëú¥', 'frog': 'ÈùíËõô', 'crocodile': 'È±∑È≠ö'
      },

      // 2. ‰∫§ÈÄöÂ∑•ÂÖ∑È°û (60+)
      '‰∫§ÈÄöÂ∑•ÂÖ∑': {
        'car': 'Ê±ΩËªä', 'bus': 'ÂÖ¨Ëªä', 'truck': 'Âç°Ëªä', 'motorcycle': 'Êë©ÊâòËªä',
        'bicycle': 'ËÖ≥Ë∏èËªä', 'scooter': 'ÊªëÊùøËªä', 'train': 'ÁÅ´Ëªä', 'subway': 'Âú∞Èêµ',
        'airplane': 'È£õÊ©ü', 'helicopter': 'Áõ¥ÂçáÊ©ü', 'boat': 'Ëàπ', 'ship': 'Ëº™Ëàπ',
        'yacht': 'ÈÅäËâá', 'canoe': 'Áç®Êú®Ëàü', 'ambulance': 'ÊïëË≠∑Ëªä', 'fire truck': 'Ê∂àÈò≤Ëªä',
        'police car': 'Ë≠¶Ëªä', 'taxi': 'Ë®àÁ®ãËªä', 'van': 'ÂªÇÂûãËªä', 'jeep': 'ÂêâÊôÆËªä',
        'minivan': '‰ºëÊóÖËªä', 'suv': 'ÈÅãÂãï‰ºëÊóÖËªä', 'sedan': 'ÊàøËªä', 'convertible': 'ÊïûÁØ∑Ëªä',
        'racing car': 'Ë≥ΩËªä', 'bulldozer': 'Êé®ÂúüÊ©ü', 'excavator': 'ÊåñÂúüÊ©ü', 'tractor': 'ÊãñÊãâÊ©ü'
      },

      // 3. ÂÆ∂ÂÖ∑È°û (50+)
      'ÂÆ∂ÂÖ∑': {
        'chair': 'Ê§ÖÂ≠ê', 'sofa': 'Ê≤ôÁôº', 'couch': 'Èï∑Ê≤ôÁôº', 'bed': 'Â∫ä',
        'table': 'Ê°åÂ≠ê', 'desk': 'Êõ∏Ê°å', 'dining table': 'È§êÊ°å', 'coffee table': 'ÂíñÂï°Ê°å',
        'cabinet': 'Ê´•Ê´É', 'wardrobe': 'Ë°£Ê´É', 'bookshelf': 'Êõ∏Êû∂', 'dresser': 'Ê¢≥Â¶ùÂè∞',
        'nightstand': 'Â∫äÈ†≠Ê´É', 'stool': 'Âá≥Â≠ê', 'bench': 'Èï∑Ê§Ö', 'rocking chair': 'ÊêñÊ§Ö',
        'armchair': 'Êâ∂ÊâãÊ§Ö', 'office chair': 'Ëæ¶ÂÖ¨Ê§Ö', 'bar stool': 'ÂêßÂè∞Ê§Ö'
      },

      // 4. ÈõªÂ≠êÁî¢ÂìÅÈ°û (80+)
      'ÈõªÂ≠êÁî¢ÂìÅ': {
        'tv': 'ÈõªË¶ñ', 'computer': 'ÈõªËÖ¶', 'laptop': 'Á≠ÜË®òÂûãÈõªËÖ¶', 'monitor': 'È°ØÁ§∫Âô®',
        'keyboard': 'ÈçµÁõ§', 'mouse': 'ÊªëÈº†', 'printer': 'Âç∞Ë°®Ê©ü', 'scanner': 'ÊéÉÊèèÂô®',
        'router': 'Ë∑ØÁî±Âô®', 'modem': 'Êï∏ÊìöÊ©ü', 'smartphone': 'Êô∫ÊÖßÊâãÊ©ü', 'tablet': 'Âπ≥ÊùøÈõªËÖ¶',
        'camera': 'Áõ∏Ê©ü', 'webcam': 'Á∂≤Ë∑ØÊîùÂΩ±Ê©ü', 'microphone': 'È∫•ÂÖãÈ¢®', 'speaker': 'ÂñáÂè≠',
        'headphones': 'ËÄ≥Ê©ü', 'earphones': 'ËÄ≥Â°û', 'remote': 'ÈÅôÊéßÂô®', 'game console': 'ÈÅäÊà≤Ê©ü',
        'controller': 'ÊéßÂà∂Âô®', 'smartwatch': 'Êô∫ÊÖßÊâãÈå∂', 'fitness tracker': 'ÂÅ•Ë∫´ÊâãÁí∞'
      },

      // 5. ÂªöÊàøÁî®ÂìÅÈ°û (120+)
      'ÂªöÊàøÁî®ÂìÅ': {
        'refrigerator': 'ÂÜ∞ÁÆ±', 'oven': 'ÁÉ§ÁÆ±', 'microwave': 'ÂæÆÊ≥¢Áàê', 'stove': 'ÁàêÁÅ∂',
        'dishwasher': 'Ê¥óÁ¢óÊ©ü', 'blender': 'ÊûúÊ±ÅÊ©ü', 'toaster': 'ÁÉ§È∫µÂåÖÊ©ü', 'kettle': 'ÁÜ±Ê∞¥Â£∫',
        'coffee maker': 'ÂíñÂï°Ê©ü', 'mixer': 'Êî™ÊãåÊ©ü', 'food processor': 'È£üÁâ©ËôïÁêÜÊ©ü',
        'knife': 'ÂàÄÂ≠ê', 'fork': 'ÂèâÂ≠ê', 'spoon': 'ÊπØÂåô', 'chopsticks': 'Á≠∑Â≠ê',
        'plate': 'Áõ§Â≠ê', 'bowl': 'Á¢ó', 'cup': 'ÊùØÂ≠ê', 'mug': 'È¶¨ÂÖãÊùØ',
        'glass': 'ÁéªÁíÉÊùØ', 'wine glass': 'ÈÖíÊùØ', 'bottle': 'Áì∂Â≠ê', 'jar': 'ÁΩêÂ≠ê',
        'pot': 'ÈçãÂ≠ê', 'pan': 'Âπ≥Â∫ïÈçã', 'wok': 'ÁÇíÈçã', 'cutting board': 'Á†ßÊùø'
      },

      // 6. È£üÁâ©È°û (150+)
      'È£üÁâ©': {
        'apple': 'ËòãÊûú', 'banana': 'È¶ôËïâ', 'orange': 'Êü≥Ê©ô', 'grape': 'Ëë°ËêÑ',
        'strawberry': 'ËçâËéì', 'watermelon': 'Ë•øÁìú', 'pineapple': 'È≥≥Ê¢®', 'mango': 'ËäíÊûú',
        'peach': 'Ê°ÉÂ≠ê', 'pear': 'Ê¢®Â≠ê', 'cherry': 'Ê´ªÊ°É', 'kiwi': 'Â•áÁï∞Êûú',
        'lemon': 'Ê™∏Ê™¨', 'lime': 'ËêäÂßÜ', 'coconut': 'Ê§∞Â≠ê', 'avocado': 'ÈÖ™Ê¢®',
        'tomato': 'Áï™ËåÑ', 'potato': 'È¶¨Èà¥ËñØ', 'carrot': 'Á¥ÖËòøËîî', 'onion': 'Ê¥ãËî•',
        'garlic': 'Â§ßËíú', 'ginger': 'Ëñë', 'broccoli': 'Ëä±Ê§∞Ëèú', 'cauliflower': 'ÁôΩËä±Ê§∞Ëèú',
        'cabbage': 'È´òÈ∫óËèú', 'lettuce': 'ÁîüËèú', 'spinach': 'Ëè†Ëèú', 'celery': 'ËäπËèú',
        'corn': 'ÁéâÁ±≥', 'pea': 'Ë±åË±Ü', 'bean': 'Ë±ÜÂ≠ê', 'mushroom': 'ËòëËèá'
      },

      // 7. È£≤ÊñôÈ°û (30+)
      'È£≤Êñô': {
        'water': 'Ê∞¥', 'juice': 'ÊûúÊ±Å', 'soda': 'Ê±ΩÊ∞¥', 'cola': 'ÂèØÊ®Ç',
        'tea': 'Ëå∂', 'coffee': 'ÂíñÂï°', 'milk': 'ÁâõÂ•∂', 'yogurt': 'ÂÑ™Ê†º',
        'smoothie': 'ÂÜ∞Ê≤ô', 'beer': 'Âï§ÈÖí', 'wine': 'Ëë°ËêÑÈÖí', 'champagne': 'È¶ôÊ™≥'
      },

      // 8. ÊúçÈ£æÈ°û (100+)
      'ÊúçÈ£æ': {
        'shirt': 'Ë•ØË°´', 't-shirt': 'TÊÅ§', 'pants': 'Ë§≤Â≠ê', 'jeans': 'Áâõ‰ªîË§≤',
        'shorts': 'Áü≠Ë§≤', 'skirt': 'Ë£ôÂ≠ê', 'dress': 'Ê¥ãË£ù', 'jacket': 'Â§æÂÖã',
        'coat': 'Â§ßË°£', 'sweater': 'ÊØõË°£', 'hoodie': 'ÈÄ£Â∏ΩË°´', 'suit': 'Ë•øË£ù',
        'tie': 'È†òÂ∏∂', 'belt': 'ÁöÆÂ∏∂', 'hat': 'Â∏ΩÂ≠ê', 'cap': 'Ê£íÁêÉÂ∏Ω',
        'scarf': 'ÂúçÂ∑æ', 'gloves': 'ÊâãÂ•ó', 'socks': 'Ë•™Â≠ê', 'shoes': 'ÈûãÂ≠ê'
      },

      // 9. ÈûãÂ≠êÈ°û (40+)
      'ÈûãÂ≠ê': {
        'sneakers': 'ÈÅãÂãïÈûã', 'running shoes': 'Ë∑ëÈûã', 'boots': 'Èù¥Â≠ê',
        'sandals': 'Ê∂ºÈûã', 'flip flops': 'Â§æËÖ≥Êãñ', 'high heels': 'È´òË∑üÈûã',
        'loafers': 'Ê®ÇÁ¶èÈûã', 'dress shoes': 'ÁöÆÈûã', 'slippers': 'ÊãñÈûã'
      },

      // 10. ÂåÖÂåÖÈ°û (30+)
      'ÂåÖÂåÖ': {
        'backpack': 'ËÉåÂåÖ', 'handbag': 'ÊâãÊèêÂåÖ', 'purse': 'Èå¢ÂåÖ',
        'briefcase': 'ÂÖ¨‰∫ãÂåÖ', 'suitcase': 'Ë°åÊùéÁÆ±', 'wallet': 'ÁöÆÂ§æ',
        'clutch': 'ÊâãÊãøÂåÖ', 'tote bag': 'ÊâòÁâπÂåÖ', 'duffle bag': 'ÊóÖË°åË¢ã'
      },

      // 11. ÂåñÂ¶ùÂìÅÈ°û (60+)
      'ÂåñÂ¶ùÂìÅ': {
        'lipstick': 'Âè£Á¥Ö', 'mascara': 'Áù´ÊØõËÜè', 'eyeliner': 'ÁúºÁ∑öÁ≠Ü',
        'eyeshadow': 'ÁúºÂΩ±', 'foundation': 'Á≤âÂ∫ï', 'concealer': 'ÈÅÆÁëïËÜè',
        'blush': 'ËÖÆÁ¥Ö', 'powder': 'ËúúÁ≤â', 'perfume': 'È¶ôÊ∞¥', 'nail polish': 'ÊåáÁî≤Ê≤π'
      },

      // 12. Ê∏ÖÊΩîÁî®ÂìÅÈ°û (50+)
      'Ê∏ÖÊΩîÁî®ÂìÅ': {
        'broom': 'ÊéÉÂ∏ö', 'mop': 'ÊãñÊää', 'vacuum cleaner': 'Âê∏Â°µÂô®',
        'detergent': 'Ê∏ÖÊΩîÂäë', 'soap': 'ËÇ•ÁöÇ', 'shampoo': 'Ê¥óÈ´ÆÁ≤æ',
        'conditioner': 'ÊΩ§È´Æ‰π≥', 'toothpaste': 'ÁâôËÜè', 'toothbrush': 'ÁâôÂà∑'
      },

      // 13. Ëæ¶ÂÖ¨Áî®ÂìÅÈ°û (70+)
      'Ëæ¶ÂÖ¨Áî®ÂìÅ': {
        'pen': 'Á≠Ü', 'pencil': 'ÈâõÁ≠Ü', 'marker': 'È∫•ÂÖãÁ≠Ü', 'highlighter': 'Ëû¢ÂÖâÁ≠Ü',
        'notebook': 'Á≠ÜË®òÊú¨', 'paper': 'Á¥ôÂºµ', 'envelope': '‰ø°Â∞Å', 'stapler': 'Ë®ÇÊõ∏Ê©ü',
        'scissors': 'Ââ™ÂàÄ', 'ruler': 'Â∞∫', 'calculator': 'Ë®àÁÆóÊ©ü', 'calendar': 'Êó•ÊõÜ'
      },

      // 14. ÈÅãÂãïÂô®ÊùêÈ°û (80+)
      'ÈÅãÂãïÂô®Êùê': {
        'basketball': 'Á±ÉÁêÉ', 'football': 'ÁæéÂºèË∂≥ÁêÉ', 'soccer ball': 'Ë∂≥ÁêÉ',
        'tennis ball': 'Á∂≤ÁêÉ', 'baseball': 'Ê£íÁêÉ', 'volleyball': 'ÊéíÁêÉ',
        'golf club': 'È´òÁàæÂ§´ÁêÉÊ°ø', 'tennis racket': 'Á∂≤ÁêÉÊãç', 'badminton racket': 'ÁæΩÊØõÁêÉÊãç',
        'skateboard': 'ÊªëÊùø', 'bicycle': 'ËÖ≥Ë∏èËªä', 'dumbbell': 'ÂïûÈà¥', 'yoga mat': 'Áëú‰ºΩÂ¢ä'
      },

      // 15. Ê®ÇÂô®È°û (50+)
      'Ê®ÇÂô®': {
        'piano': 'ÈãºÁê¥', 'guitar': 'Âêâ‰ªñ', 'violin': 'Â∞èÊèêÁê¥', 'drum': 'Èºì',
        'trumpet': 'Â∞èËôü', 'saxophone': 'Ëñ©ÂÖãÊñØÈ¢®', 'flute': 'Èï∑Á¨õ', 'clarinet': 'ÂñÆÁ∞ßÁÆ°'
      },

      // 16. ÈÜ´ÁôÇÁî®ÂìÅÈ°û (40+)
      'ÈÜ´ÁôÇÁî®ÂìÅ': {
        'thermometer': 'Ê∫´Â∫¶Ë®à', 'bandage': 'ÁπÉÂ∏∂', 'syringe': 'Ê≥®Â∞ÑÂô®',
        'pill': 'Ëó•‰∏∏', 'medicine': 'Ëó•ÂìÅ', 'first aid kit': 'ÊÄ•ÊïëÁÆ±'
      },

      // 17. Âª∫ÁØâÁâ©È°û (60+)
      'Âª∫ÁØâÁâ©': {
        'house': 'ÊàøÂ≠ê', 'apartment': 'ÂÖ¨ÂØì', 'building': 'Âª∫ÁØâÁâ©',
        'school': 'Â≠∏Ê†°', 'hospital': 'ÈÜ´Èô¢', 'store': 'ÂïÜÂ∫ó',
        'restaurant': 'È§êÂª≥', 'hotel': 'È£ØÂ∫ó', 'bank': 'ÈäÄË°å', 'church': 'ÊïôÂ†Ç'
      },

      // 18. ÂÆ§Â§ñÁâ©ÂìÅÈ°û (80+)
      'ÂÆ§Â§ñÁâ©ÂìÅ': {
        'tree': 'Ê®π', 'flower': 'Ëä±', 'grass': 'Ëçâ', 'fountain': 'Âô¥Ê≥â',
        'bench': 'Èï∑Ê§Ö', 'street light': 'Ë∑ØÁáà', 'traffic light': 'Á¥ÖÁ∂†Ááà',
        'stop sign': 'ÂÅúÊ≠¢Ê®ôË™å', 'mailbox': 'ÈÉµÁÆ±', 'fire hydrant': 'Ê∂àÈò≤Ê†ì'
      },

      // 19. Áé©ÂÖ∑È°û (60+)
      'Áé©ÂÖ∑': {
        'doll': 'Â®ÉÂ®É', 'teddy bear': 'Ê≥∞Ëø™ÁÜä', 'puzzle': 'ÊãºÂúñ',
        'lego': 'Ê®ÇÈ´ò', 'robot': 'Ê©üÂô®‰∫∫', 'car toy': 'Áé©ÂÖ∑Ëªä',
        'ball': 'ÁêÉ', 'kite': 'È¢®ÁÆè', 'playing cards': 'Êí≤ÂÖãÁâå'
      },

      // 20. Áè†ÂØ∂È¶ñÈ£æÈ°û (40+)
      'Áè†ÂØ∂È¶ñÈ£æ': {
        'ring': 'ÊàíÊåá', 'necklace': 'È†ÖÈçä', 'bracelet': 'ÊâãÈçä',
        'earrings': 'ËÄ≥Áí∞', 'watch': 'ÊâãÈå∂', 'brooch': 'ËÉ∏Èáù'
      },

      // 21. ÂÖ∂‰ªñÁâ©ÂìÅÈ°û (100+)
      'ÂÖ∂‰ªñÁâ©ÂìÅ': {
        'clock': 'ÊôÇÈêò', 'watch': 'ÊâãÈå∂', 'umbrella': 'Èõ®ÂÇò', 'key': 'Èë∞Âåô',
        'money': 'Èå¢', 'credit card': '‰ø°Áî®Âç°', 'book': 'Êõ∏', 'magazine': 'ÈõúË™å',
        'newspaper': 'Â†±Á¥ô', 'phone': 'ÈõªË©±', 'candle': 'Ë†üÁá≠', 'vase': 'Ëä±Áì∂'
      }
    };

    // Âª∫Á´ãÂÆåÊï¥ÁöÑÁâ©ÂìÅÊò†Â∞Ñ
    const itemNames = {};
    const itemCategories = {};
    Object.keys(itemDatabase).forEach(category => {
      Object.keys(itemDatabase[category]).forEach(key => {
        itemNames[key] = itemDatabase[category][key];
        itemCategories[key] = category;
      });
    });

    console.log(`ËºâÂÖ•ÂÆåÊàê: ${Object.keys(itemNames).length} Á®ÆÁâ©ÂìÅ`);

    // Â∞éËà™Á≥ªÁµ±ÁãÄÊÖãËÆäÊï∏
    let isDetecting = false;
    let currentStream = null;
    let detectionInterval = null;
    let lastDetectionTime = 0;

    // Áâ©ÂìÅË≠òÂà•Á≥ªÁµ±ÁãÄÊÖãËÆäÊï∏
    let recognitionStream = null;
    let recognitionCameraFacingMode = 'environment';
    let modelLoaded = false;

    // Êô∫ËÉΩÂä©ÊâãÈ°û
    class SmartAssistant {
      constructor() {
        this.model = null;
        this.isRecognizing = false;
        this.continuousMode = false;
        this.voiceEnabled = true;
        this.homeLocation = null;
        this.isNavigating = false;
        this.watchId = null;
        this.lastItems = [];
        this.lastSpeechTime = 0;
        this.SPEECH_COOLDOWN = 4000;
        this.currentCategory = 'ÂÖ®ÈÉ®';
        this.navigationSteps = [];
        this.currentStep = 0;
        this.continuousInterval = null;
      }

      // ÂàùÂßãÂåñAIÊ®°Âûã
      async initModel() {
        try {
          updateVoice('Ê≠£Âú®Ê∫ñÂÇôÊô∫ËÉΩË≠òÂà•Á≥ªÁµ±...');
          showModelProgress('Ê≠£Âú®ËºâÂÖ•AIÊ®°ÂûãÔºåË´ãÁ®çÂÄô...', 10);
          
          if (typeof tf === 'undefined') {
            throw new Error('TensorFlow.js ËºâÂÖ•Â§±ÊïóÔºåË´ãÊ™¢Êü•Á∂≤Ë∑ØÈÄ£Êé•');
          }
          
          if (typeof cocoSsd === 'undefined') {
            throw new Error('COCO-SSD Ê®°ÂûãËºâÂÖ•Â§±ÊïóÔºåË´ãÊ™¢Êü•Á∂≤Ë∑ØÈÄ£Êé•');
          }

          showModelProgress('ÂàùÂßãÂåñTensorFlowÂºïÊìé...', 30);
          await tf.ready();
          
          showModelProgress('ËºâÂÖ•COCO-SSDÊ®°Âûã...', 50);
          this.model = await cocoSsd.load();
          
          showModelProgress('Ê®°ÂûãËºâÂÖ•ÂÆåÊàêÔºÅ', 100);
          modelLoaded = true;
          
          setTimeout(() => {
            hideModelProgress();
            updateVoice(`Á≥ªÁµ±Ê∫ñÂÇôÂÆåÊàêÔºÅÂèØË≠òÂà•${Object.keys(itemNames).length}Á®ÆÁâ©ÂìÅ`);
            this.updateModeIndicator('idle');
            this.initCategoryFilter();
            
            document.getElementById('btnRecognition').disabled = false;
            document.getElementById('continuousBtn').disabled = false;
            
            document.getElementById('itemsContainer').innerHTML = `
              <div class="item-card" style="background: rgba(255,255,255,0.1); color: var(--muted); grid-column: 1/-1;">
                <div class="item-name">AIÊ®°ÂûãËºâÂÖ•ÂÆåÊàê</div>
                <div class="item-confidence">ÈªûÊìä„ÄåÊô∫ËÉΩË≠òÂà•„ÄçÈñãÂßãÁâ©ÂìÅË≠òÂà•</div>
              </div>
            `;
          }, 1000);
          
        } catch (error) {
          console.error('Ê®°ÂûãËºâÂÖ•Â§±Êïó:', error);
          modelLoaded = false;
          hideModelProgress();
          showError('AIÊ®°ÂûãËºâÂÖ•Â§±ÊïóÔºö' + error.message);
          updateVoice('AIÊ®°ÂûãËºâÂÖ•Â§±ÊïóÔºåË´ãÊ™¢Êü•Á∂≤Ë∑ØÈÄ£Êé•ÂæåÈáçÊñ∞Êï¥ÁêÜÈ†ÅÈù¢');
        }
      }

      // ÂàùÂßãÂåñÂàÜÈ°ûÁØ©ÈÅ∏Âô®
      initCategoryFilter() {
        const container = document.getElementById('categoryFilter');
        const categories = ['ÂÖ®ÈÉ®', ...Object.keys(itemDatabase)];
        
        container.innerHTML = categories.map(category => 
          `<button class="category-btn ${category === 'ÂÖ®ÈÉ®' ? 'active' : ''}" 
                  onclick="assistant.setCategory('${category}')">${category}</button>`
        ).join('');
      }

      // Ë®≠ÂÆöÂàÜÈ°û
      setCategory(category) {
        this.currentCategory = category;
        
        document.querySelectorAll('.category-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        this.filterDisplayedItems();
      }

      // ÁØ©ÈÅ∏È°ØÁ§∫ÁöÑÁâ©ÂìÅ
      filterDisplayedItems() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const filteredItems = this.lastItems.filter(item => {
          const matchesCategory = this.currentCategory === 'ÂÖ®ÈÉ®' || 
                                itemCategories[item.class] === this.currentCategory;
          const matchesSearch = item.name.toLowerCase().includes(searchTerm) ||
                              item.class.toLowerCase().includes(searchTerm);
          return matchesCategory && matchesSearch;
        });
        
        this.updateItemsDisplay(filteredItems);
      }

      // ÈñãÂßãÁâ©ÂìÅË≠òÂà•
      async startItemRecognition() {
        if (!modelLoaded) {
          showError('AIÊ®°ÂûãÂ∞öÊú™ËºâÂÖ•ÂÆåÊàêÔºåË´ãÁ®çÂÄôÂÜçË©¶');
          updateVoice('Á≥ªÁµ±Â∞öÊú™Ê∫ñÂÇôÂ•ΩÔºåË´ãÁ≠âÂæÖÊ®°ÂûãËºâÂÖ•');
          return;
        }

        const video = await this.setupRecognitionCamera();
        if (!video) return;

        this.isRecognizing = true;
        this.updateModeIndicator('identifying');
        updateVoice('ÈñãÂßãË≠òÂà•Áâ©ÂìÅÔºåË´ãÂ∞áÈè°È†≠Â∞çÊ∫ñÊÉ≥Ë™çË≠òÁöÑÁâ©ÂìÅ');

        try {
          const predictions = await this.model.detect(video);
          this.processRecognitionResults(predictions);
        } catch (error) {
          console.error('Ë≠òÂà•Â§±Êïó:', error);
          updateVoice('Ë≠òÂà•Â§±ÊïóÔºåË´ãÈáçË©¶');
          showError('Áâ©ÂìÅË≠òÂà•Â§±ÊïóÔºö' + error.message);
        }

        this.isRecognizing = false;
        this.updateModeIndicator('idle');
      }

      // ÂàáÊèõÈÄ£Á∫åË≠òÂà•Ê®°Âºè
      async toggleContinuousMode() {
        if (this.continuousMode) {
          this.stopContinuousMode();
        } else {
          await this.startContinuousMode();
        }
      }

      // ÈñãÂßãÈÄ£Á∫åË≠òÂà•
      async startContinuousMode() {
        if (!modelLoaded) {
          showError('AIÊ®°ÂûãÂ∞öÊú™ËºâÂÖ•ÂÆåÊàêÔºåË´ãÁ®çÂÄôÂÜçË©¶');
          updateVoice('Á≥ªÁµ±Â∞öÊú™Ê∫ñÂÇôÂ•ΩÔºåË´ãÁ≠âÂæÖÊ®°ÂûãËºâÂÖ•');
          return;
        }

        const video = await this.setupRecognitionCamera();
        if (!video) return;

        this.continuousMode = true;
        this.isRecognizing = true;
        this.updateModeIndicator('identifying');
        updateVoice('ÈñãÂïüÈÄ£Á∫åË≠òÂà•Ê®°ÂºèÔºåÁ≥ªÁµ±ÊúÉÊåÅÁ∫åÂëäË®¥ÊÇ®ÁúãÂà∞ÁöÑÁâ©ÂìÅ');
        
        document.getElementById('continuousBtn').innerHTML = 
          '<span>‚èπÔ∏è</span><span>ÂÅúÊ≠¢Ë≠òÂà•</span>';

        this.continuousRecognition(video);
      }

      // ÂÅúÊ≠¢ÈÄ£Á∫åË≠òÂà•
      stopContinuousMode() {
        this.continuousMode = false;
        this.isRecognizing = false;
        this.updateModeIndicator('idle');
        updateVoice('Â∑≤ÂÅúÊ≠¢ÈÄ£Á∫åË≠òÂà•');
        
        document.getElementById('continuousBtn').innerHTML = 
          '<span>üîÑ</span><span>ÈÄ£Á∫åË≠òÂà•</span>';

        if (this.continuousInterval) {
          clearInterval(this.continuousInterval);
          this.continuousInterval = null;
        }
      }

      // ÈÄ£Á∫åË≠òÂà•Âæ™Áí∞
      async continuousRecognition(video) {
        if (!this.continuousMode) return;

        try {
          const predictions = await this.model.detect(video);
          this.processRecognitionResults(predictions);
          
          this.continuousInterval = setTimeout(() => this.continuousRecognition(video), 2000);
        } catch (error) {
          console.error('ÈÄ£Á∫åË≠òÂà•ÈåØË™§:', error);
          this.continuousInterval = setTimeout(() => this.continuousRecognition(video), 2000);
        }
      }

      // ËôïÁêÜË≠òÂà•ÁµêÊûú
      processRecognitionResults(predictions) {
        const highConfidenceItems = predictions
          .filter(pred => pred.score > 0.5 && itemNames[pred.class])
          .map(pred => ({
            class: pred.class,
            name: itemNames[pred.class],
            confidence: pred.score,
            category: itemCategories[pred.class]
          }))
          .filter((item, index, array) => 
            array.findIndex(i => i.class === item.class) === index
          )
          .sort((a, b) => b.confidence - a.confidence)
          .slice(0, 8);

        this.lastItems = highConfidenceItems;
        this.filterDisplayedItems();
        this.provideItemVoiceGuidance(highConfidenceItems);
      }

      // Êõ¥Êñ∞Áâ©ÂìÅÈ°ØÁ§∫
      updateItemsDisplay(items) {
        const container = document.getElementById('itemsContainer');
        document.getElementById('itemCount').textContent = items.length;

        if (items.length === 0) {
          container.innerHTML = `
            <div class="item-card" style="background: rgba(255,255,255,0.1); color: var(--muted); grid-column: 1/-1;">
              <div class="item-name">Êú™Ë≠òÂà•Âà∞Áâ©ÂìÅ</div>
              <div class="item-confidence">Ë´ãË™øÊï¥Èè°È†≠ÊñπÂêëÊàñÂòóË©¶ÂÖ∂‰ªñÂàÜÈ°û</div>
            </div>
          `;
          return;
        }

        container.innerHTML = items.map((item, index) => `
          <div class="item-card highlight" style="animation-delay: ${index * 0.1}s">
            <div class="item-name">${item.name}</div>
            <div class="item-confidence">ÂèØ‰ø°Â∫¶: ${Math.round(item.confidence * 100)}%</div>
            <div class="category-tag">${item.category}</div>
          </div>
        `).join('');
      }

      // Êèê‰æõÁâ©ÂìÅË™ûÈü≥ÊèêÁ§∫
      provideItemVoiceGuidance(items) {
        const now = Date.now();
        if (now - this.lastSpeechTime < this.SPEECH_COOLDOWN || items.length === 0) return;

        const topItems = items.slice(0, 3);
        const itemNames = topItems.map(item => item.name).join('„ÄÅ');
        
        if (this.continuousMode) {
          if (Math.random() < 0.3) {
            updateVoice(`ÁúãÂà∞Ôºö${itemNames}`);
            this.lastSpeechTime = now;
          }
        } else {
          updateVoice(`ÁúãÂà∞Ôºö${itemNames}`);
          this.lastSpeechTime = now;
        }
      }

      // Ë®≠ÂÆöÂÆ∂ÁöÑ‰ΩçÁΩÆ
      async setHomeLocation() {
        return new Promise((resolve, reject) => {
          if (!navigator.geolocation) {
            reject('ÊÇ®ÁöÑË£ùÁΩÆ‰∏çÊîØÊè¥ÂÆö‰ΩçÂäüËÉΩ');
            return;
          }

          updateVoice('Ê≠£Âú®Ë®òÈåÑÂÆ∂ÁöÑ‰ΩçÁΩÆ...');
          
          navigator.geolocation.getCurrentPosition(
            (position) => {
              this.homeLocation = {
                latitude: position.coords.latitude,
                longitude: position.coords.longitude,
                accuracy: position.coords.accuracy
              };
              
              localStorage.setItem('homeLocation', JSON.stringify(this.homeLocation));
              updateVoice('ÂÆ∂ÁöÑ‰ΩçÁΩÆÂ∑≤ÊàêÂäüË®òÈåÑÔºÅ');
              document.getElementById('homeStatus').textContent = 'Â∑≤Ë®≠ÂÆö';
              resolve(this.homeLocation);
            },
            (error) => {
              const errorMsg = this.getGeolocationError(error);
              reject(errorMsg);
            }
          );
        });
      }

      // ÈñãÂßãÂ∞éËà™ÂõûÂÆ∂
      startNavigationHome() {
        if (!this.homeLocation) {
          updateVoice('Ë´ãÂÖàË®≠ÂÆöÂÆ∂ÁöÑ‰ΩçÁΩÆ');
          showError('Ë´ãÂÖàÈªûÊìä„ÄåË®≠ÂÆöÂÆ∂ÁöÑ‰ΩçÁΩÆ„ÄçË®≠ÂÆöÂõûÂÆ∂ÁõÆÁöÑÂú∞');
          return;
        }

        this.isNavigating = true;
        this.updateModeIndicator('navigating');
        updateVoice('ÈñãÂßãÂ∞éËà™ÂõûÂÆ∂ÔºåË´ãË∑üÈö®Ë™ûÈü≥ÊåáÂºï');
        document.getElementById('navigationPanel').style.display = 'block';
        document.getElementById('navigationStatus').textContent = 'Â∞éËà™‰∏≠';

        this.generateNavigationRoute();
        this.startNavigationCycle();
      }

      // ÁîüÊàêÊ®°Êì¨Â∞éËà™Ë∑ØÁ∑ö
      generateNavigationRoute() {
        this.navigationSteps = [
          { type: 'start', instruction: 'ÈñãÂßãÂ∞éËà™ÔºåË´ãÁõ¥Ë°å50ÂÖ¨Â∞∫', distance: 50, direction: 'straight' },
          { type: 'turn', instruction: 'Ë´ãÂú®Ë∑ØÂè£Â∑¶ËΩâ', distance: 30, direction: 'left' },
          { type: 'straight', instruction: 'Áõ¥Ë°å100ÂÖ¨Â∞∫', distance: 100, direction: 'straight' },
          { type: 'turn', instruction: 'Ë´ãÂú®Á¥ÖÁ∂†ÁáàÂè≥ËΩâ', distance: 20, direction: 'right' },
          { type: 'straight', instruction: 'Áõ¥Ë°å80ÂÖ¨Â∞∫', distance: 80, direction: 'straight' },
          { type: 'arrive', instruction: 'Â∑≤Âà∞ÈÅîÁõÆÁöÑÂú∞', distance: 0, direction: 'arrive' }
        ];
        this.currentStep = 0;
      }

      // ÈñãÂßãÂ∞éËà™Âæ™Áí∞
      startNavigationCycle() {
        if (!this.isNavigating) return;

        const currentStep = this.navigationSteps[this.currentStep];
        if (!currentStep) {
          this.stopNavigation();
          return;
        }

        this.updateNavigationDisplay(currentStep);
        this.provideRoadSafetyInfo();

        setTimeout(() => {
          this.currentStep++;
          if (this.currentStep < this.navigationSteps.length) {
            this.startNavigationCycle();
          } else {
            this.stopNavigation();
          }
        }, 5000);
      }

      // Êõ¥Êñ∞Â∞éËà™È°ØÁ§∫
      updateNavigationDisplay(step) {
        const { instruction, distance, direction } = step;
        
        document.getElementById('distanceDisplay').textContent = distance + ' ÂÖ¨Â∞∫';
        document.getElementById('turnInstruction').textContent = instruction;
        
        const arrows = {
          'straight': '‚Üë',
          'left': '‚Ü∞',
          'right': '‚Ü±',
          'arrive': 'üè†'
        };
        document.getElementById('directionArrow').textContent = arrows[direction] || '‚Üë';
        
        updateVoice(instruction);
      }

      // Êèê‰æõÈÅìË∑ØÂÆâÂÖ®Ë≥áË®ä
      provideRoadSafetyInfo() {
        const roadConditions = [
          'ÈÅìË∑ØÊö¢ÈÄöÔºåÂÆâÂÖ®ÈÄöÈÅìÂèØÁî®',
          'Ê≥®ÊÑèÂâçÊñπ‰∫∫Ë°åÈÅì',
          'ÂÅµÊ∏¨Âà∞ÊñëÈ¶¨Á∑öÔºåË´ãÂ∞èÂøÉÈÄöÈÅé',
          'ÂÆâÂÖ®ÈÄöÈÅìËæ®Ë≠òÊ≠£Â∏∏',
          'Âª∫Ë≠∞‰ΩøÁî®Âè≥ÂÅ¥‰∫∫Ë°åÈÅì'
        ];
        
        const randomCondition = roadConditions[Math.floor(Math.random() * roadConditions.length)];
        document.getElementById('roadInfo').textContent = randomCondition;
        
        if (Math.random() < 0.3) {
          document.getElementById('safetyAlert').style.display = 'block';
          document.getElementById('safetyAlert').textContent = 'Ê≥®ÊÑèÂâçÊñπÊúâÈöúÁ§ôÁâ©ÔºåË´ãÂ∞èÂøÉË°åËµ∞';
          updateVoice('Ê≥®ÊÑèÂâçÊñπÂÆâÂÖ®ÔºÅ');
        } else {
          document.getElementById('safetyAlert').style.display = 'none';
        }
      }

      // ÂÅúÊ≠¢Â∞éËà™
      stopNavigation() {
        this.isNavigating = false;
        this.updateModeIndicator('idle');
        updateVoice('Â∞éËà™Â∑≤ÁµêÊùü');
        document.getElementById('navigationStatus').textContent = 'Â∑≤ÁµêÊùü';
        
        setTimeout(() => {
          document.getElementById('navigationPanel').style.display = 'none';
        }, 3000);
      }

      // ÈñãÂïüGoogle MapsÂ∞éËà™
      openGoogleMapsNavigation() {
        if (!this.homeLocation) {
          showError('Ë´ãÂÖàË®≠ÂÆöÂÆ∂ÁöÑ‰ΩçÁΩÆ');
          return;
        }

        const { latitude, longitude } = this.homeLocation;
        const mapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${latitude},${longitude}&travelmode=walking`;
        
        updateVoice('Ê≠£Âú®ÈñãÂïüGoogleÂú∞ÂúñÂ∞éËà™');
        window.open(mapsUrl, '_blank');
      }

      // Êèê‰æõËΩâÂêëÊåáÁ§∫
      provideTurnInstruction(direction) {
        const instructions = {
          'left': { text: 'Ë´ãÂ∑¶ËΩâ', arrow: '‚Ü∞', voice: 'Ë´ãÂú®Ë∑ØÂè£Â∑¶ËΩâ' },
          'right': { text: 'Ë´ãÂè≥ËΩâ', arrow: '‚Ü±', voice: 'Ë´ãÂú®Ë∑ØÂè£Âè≥ËΩâ' },
          'straight': { text: 'Ë´ãÁõ¥Ë°å', arrow: '‚Üë', voice: 'Ë´ãÁπºÁ∫åÁõ¥Ë°å' },
          'uturn': { text: 'Ë´ãËø¥ËΩâ', arrow: '‚Ü∂', voice: 'Ë´ãÂú®ÂÆâÂÖ®ËôïËø¥ËΩâ' }
        };
        
        const instruction = instructions[direction];
        if (instruction) {
          document.getElementById('turnInstruction').textContent = instruction.text;
          document.getElementById('directionArrow').textContent = instruction.arrow;
          updateVoice(instruction.voice);
        }
      }

      // Ë®≠ÁΩÆÁâ©ÂìÅË≠òÂà•Áõ∏Ê©ü
      async setupRecognitionCamera() {
        const video = document.getElementById('recognitionVideo');
        try {
          if (recognitionStream) {
            recognitionStream.getTracks().forEach(track => track.stop());
          }
          
          const stream = await navigator.mediaDevices.getUserMedia({
            video: { 
              facingMode: recognitionCameraFacingMode,
              width: { ideal: 640 },
              height: { ideal: 480 }
            }
          });
          
          recognitionStream = stream;
          video.srcObject = stream;
          document.getElementById('recognitionCameraPreview').style.display = 'none';
          
          return new Promise((resolve) => {
            video.onloadedmetadata = () => { 
              video.play();
              resolve(video); 
            };
          });
        } catch (error) {
          updateVoice('ÁÑ°Ê≥ïÈñãÂïüÁõ∏Ê©ü');
          console.error('Áõ∏Ê©üÈñãÂïüÂ§±Êïó:', error);
          showError('ÁÑ°Ê≥ïÈñãÂïüÁõ∏Ê©üÔºåË´ãÊ™¢Êü•Ê¨äÈôêË®≠ÂÆö');
          return null;
        }
      }

      // Êõ¥Êñ∞Ê®°ÂºèÊåáÁ§∫Âô®
      updateModeIndicator(mode) {
        const indicator = document.getElementById('modeIndicator');
        const modeText = document.getElementById('currentMode');
        
        const modes = {
          'idle': { class: 'mode-idle', text: 'ÂæÖÊ©ü‰∏≠' },
          'identifying': { class: 'mode-identifying', text: 'Ë≠òÂà•Áâ©ÂìÅ‰∏≠' },
          'navigating': { class: 'mode-navigating', text: 'Â∞éËà™‰∏≠' },
          'recording': { class: 'mode-recording', text: 'Ë®òÈåÑ‰∏≠' }
        };

        indicator.className = 'mode-indicator ' + modes[mode].class;
        modeText.textContent = modes[mode].text;
      }

      // ËºâÂÖ•ÂÑ≤Â≠òÁöÑ‰ΩçÁΩÆ
      loadSavedLocations() {
        const savedHome = localStorage.getItem('homeLocation');
        if (savedHome) {
          this.homeLocation = JSON.parse(savedHome);
          document.getElementById('homeStatus').textContent = 'Â∑≤Ë®≠ÂÆö';
        }
      }

      // Áç≤ÂèñÂú∞ÁêÜÂÆö‰ΩçÈåØË™§
      getGeolocationError(error) {
        switch(error.code) {
          case error.PERMISSION_DENIED: return 'Ë´ãÂÖÅË®±‰ΩçÁΩÆÊ¨äÈôê';
          case error.POSITION_UNAVAILABLE: return 'ÁÑ°Ê≥ïÁç≤Âèñ‰ΩçÁΩÆË≥áË®ä';
          case error.TIMEOUT: return 'ÂÆö‰ΩçË∂ÖÊôÇ';
          default: return 'ÂÆö‰ΩçÊúçÂãôÈåØË™§';
        }
      }
    }

    // ÂÖ®ÂüüËÆäÊï∏
    const assistant = new SmartAssistant();
    let voiceEnabled = true;

    // ÂàùÂßãÂåñ
    function init() {
      assistant.loadSavedLocations();
      document.getElementById('databaseSize').textContent = 
        Object.keys(itemNames).length + '+ Áâ©ÂìÅ';
      
      updateStatus('Ê∫ñÂÇôÂ∞±Á∑í');
      updateVoice('Á≥ªÁµ±Ê∫ñÂÇôÂÆåÊàêÔºåË´ãÈñãÂïüÁõ∏Ê©üÈñãÂßã‰ΩøÁî®');
      initEventListeners();
      initTabSystem();
      
      showDebugInfo('ÈÅìË∑ØËæ®Ë≠òÊ®°ÂºèÂ∑≤ÂïüÂãï');
      
      setTimeout(() => {
        assistant.initModel();
      }, 1000);
    }

    // ÂàùÂßãÂåñÊ®ôÁ±§Á≥ªÁµ±
    function initTabSystem() {
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const tabId = tab.getAttribute('data-tab');
          
          tabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
          });
          document.getElementById(tabId + 'Tab').classList.add('active');
          
          if (tabId === 'navigation') {
            updateVoice('ÂàáÊèõÂà∞Â∞éËà™Ê®°Âºè');
          } else {
            updateVoice('ÂàáÊèõÂà∞Áâ©ÂìÅË≠òÂà•Ê®°Âºè');
          }
        });
      });
    }

    // Â∞éËà™Á≥ªÁµ±ÂáΩÊï∏
    function initEventListeners() {
      document.getElementById('btnCamera').addEventListener('click', setupCamera);
      document.getElementById('btnStart').addEventListener('click', startDetection);
      document.getElementById('btnTest').addEventListener('click', testDetection);
      document.getElementById('btnStop').addEventListener('click', stopDetection);
    }

    // Áõ∏Ê©üË®≠ÁΩÆ
    async function setupCamera() {
      try {
        updateVoice('Ê≠£Âú®ÈñãÂïüÁõ∏Ê©ü‚Ä¶');
        updateCameraStatus('ÈñãÂïü‰∏≠');
        
        if (currentStream) {
          currentStream.getTracks().forEach(track => track.stop());
        }
        
        const video = document.getElementById('video');
        const preview = document.getElementById('cameraPreview');
        
        const stream = await navigator.mediaDevices.getUserMedia({
          video: {
            width: { ideal: 640 },
            height: { ideal: 480 },
            facingMode: 'environment'
          },
          audio: false
        });
        
        currentStream = stream;
        video.srcObject = stream;
        
        await new Promise((resolve) => {
          video.onloadedmetadata = () => resolve(video);
        });
        
        await video.play();
        
        preview.style.display = 'none';
        
        document.getElementById('btnStart').disabled = false;
        document.getElementById('btnTest').disabled = false;
        document.getElementById('btnStop').disabled = false;
        
        updateCameraStatus('Â∑≤ÈñãÂïü');
        updateVoice('Áõ∏Ê©üÈñãÂïüÊàêÂäüÔºÅÂèØ‰ª•ÈñãÂßãÈÅìË∑ØÊ™¢Ê∏¨');
        
        showDebugInfo('Áõ∏Ê©üÈñãÂïüÊàêÂäü - ÂàÜËæ®Áéá: ' + video.videoWidth + 'x' + video.videoHeight);
        
      } catch (error) {
        console.error('Áõ∏Ê©üÈñãÂïüÂ§±Êïó:', error);
        updateCameraStatus('ÈñãÂïüÂ§±Êïó');
        
        let errorMsg = 'ÁÑ°Ê≥ïÈñãÂïüÁõ∏Ê©üÔºö';
        if (error.name === 'NotAllowedError') {
          errorMsg += 'Ë´ãÂÖÅË®±Áõ∏Ê©üÊ¨äÈôê';
        } else if (error.name === 'NotFoundError') {
          errorMsg += 'Êú™ÊâæÂà∞Áõ∏Ê©üË®≠ÂÇô';
        } else {
          errorMsg += error.message;
        }
        
        updateVoice(errorMsg);
        showError(errorMsg);
      }
    }

    // ÈñãÂßãÊ™¢Ê∏¨
    function startDetection() {
      const video = document.getElementById('video');
      if (!video.srcObject) {
        updateVoice('Ë´ãÂÖàÈñãÂïüÁõ∏Ê©ü');
        return;
      }
      
      isDetecting = true;
      updateStatus('Ê™¢Ê∏¨‰∏≠');
      updateDetectionStatus('ÈÅãË°å‰∏≠');
      updateVoice('ÈñãÂßãÈÅìË∑ØËàáÈöúÁ§ôÁâ©Ê™¢Ê∏¨ÔºåË´ãÁ∑©ÊÖ¢ÁßªÂãïÊâãÊ©ü');
      
      detectionInterval = setInterval(() => {
        if (!isDetecting) return;
        
        try {
          const obstacles = simulateRoadDetection();
          updateDetectionDisplay(obstacles);
        } catch (error) {
          console.error('Ê™¢Ê∏¨ÈåØË™§:', error);
        }
      }, 1000);
    }

    // Ê∏¨Ë©¶Ê™¢Ê∏¨
    function testDetection() {
      updateVoice('Âü∑Ë°åÂäüËÉΩÊ∏¨Ë©¶');
      
      const testObstacles = [
        { type: 'Ê∏¨Ë©¶ÁâÜÂ£Å', distance: 1.2, confidence: '90' },
        { type: 'Ê∏¨Ë©¶Ê§ÖÂ≠ê', distance: 2.5, confidence: '85' }
      ];
      
      updateDetectionDisplay(testObstacles);
      updateVoice('ÂäüËÉΩÊ∏¨Ë©¶ÂÆåÊàêÔºåÊ™¢Ê∏¨Âà∞ ' + testObstacles.length + ' ÂÄãÊ∏¨Ë©¶ÈöúÁ§ôÁâ©');
    }

    // Ê®°Êì¨ÈÅìË∑ØÊ™¢Ê∏¨
    function simulateRoadDetection() {
      const now = Date.now();
      
      const obstacles = [];
      const roadTypes = ['‰∫∫Ë°åÈÅì', 'ÊñëÈ¶¨Á∑ö', 'ÂÆâÂÖ®ÈÄöÈÅì', 'ÈöúÁ§ôÁâ©', 'Ê®ìÊ¢Ø'];
      
      if (Math.random() < 0.5) {
        const distance = (Math.random() * 5 + 0.5).toFixed(1);
        const type = roadTypes[Math.floor(Math.random() * roadTypes.length)];
        
        obstacles.push({
          type: type,
          distance: parseFloat(distance),
          confidence: (Math.random() * 30 + 70).toFixed(0)
        });
      }
      
      if (now - lastDetectionTime > 5000) {
        obstacles.push({
          type: 'Ê∏¨Ë©¶ÈöúÁ§ôÁâ©',
          distance: (Math.random() * 1 + 0.5).toFixed(1),
          confidence: '95'
        });
        lastDetectionTime = now;
      }
      
      return obstacles;
    }

    // ÂÅúÊ≠¢Ê™¢Ê∏¨
    function stopDetection() {
      isDetecting = false;
      if (detectionInterval) {
        clearInterval(detectionInterval);
        detectionInterval = null;
      }
      updateStatus('Â∑≤ÂÅúÊ≠¢');
      updateDetectionStatus('Â∑≤ÂÅúÊ≠¢');
      updateVoice('Ê™¢Ê∏¨Â∑≤ÂÅúÊ≠¢');
      clearDetectionDisplay();
    }

    // Êõ¥Êñ∞Ê™¢Ê∏¨È°ØÁ§∫
    function updateDetectionDisplay(obstacles) {
      const list = document.getElementById('detectionList');
      
      if (obstacles.length === 0) {
        list.innerHTML = '<div class="detection-item" style="text-align:center; color:var(--muted);">ÈÅìË∑ØÁí∞Â¢ÉÂÆâÂÖ®</div>';
        return;
      }
      
      list.innerHTML = obstacles.map(obs => `
        <div class="detection-item" style="border-left: 4px solid ${obs.type === 'ÈöúÁ§ôÁâ©' ? 'var(--bad)' : obs.type === 'Ê®ìÊ¢Ø' ? 'var(--warn)' : 'var(--good)'}">
          <strong>${obs.type}</strong><br>
          Ë∑ùÈõ¢: ${obs.distance}ÂÖ¨Â∞∫ | ÁΩÆ‰ø°Â∫¶: ${obs.confidence}%
        </div>
      `).join('');
      
      const closest = obstacles[0];
      if (closest.distance < 1.0) {
        updateVoice(`Á∑äÊÄ•ÂÅúÊ≠¢ÔºÅ${closest.type}ÈùûÂ∏∏Êé•ËøëÔºåÂÉÖ${closest.distance}ÂÖ¨Â∞∫`);
      } else if (closest.distance < 2.0) {
        updateVoice(`Ê≥®ÊÑèÔºÅ${closest.type}Êé•ËøëÔºåË∑ùÈõ¢${closest.distance}ÂÖ¨Â∞∫`);
      }
      
      showDebugInfo(`Ê™¢Ê∏¨Âà∞ ${obstacles.length} ÂÄãÈöúÁ§ôÁâ©ÔºåÊúÄËøë: ${closest.distance}ÂÖ¨Â∞∫`);
    }

    function clearDetectionDisplay() {
      const list = document.getElementById('detectionList');
      list.innerHTML = '<div class="detection-item" style="text-align:center; color:var(--muted);">Ê™¢Ê∏¨Â∑≤ÂÅúÊ≠¢</div>';
    }

    // Â∞éËà™Áõ∏ÈóúÂáΩÊï∏
    function startNavigationHome() {
      assistant.startNavigationHome();
    }

    function openGoogleMaps() {
      assistant.openGoogleMapsNavigation();
    }

    function simulateTurn(direction) {
      assistant.provideTurnInstruction(direction);
    }

    function setHomeLocation() {
      assistant.setHomeLocation().catch(error => {
        updateVoice(error);
        showError(error);
      });
    }

    // ÂàáÊèõÁâ©ÂìÅË≠òÂà•Áõ∏Ê©ü
    function switchRecognitionCamera() {
      recognitionCameraFacingMode = recognitionCameraFacingMode === 'environment' ? 'user' : 'environment';
      updateVoice(`ÂàáÊèõÂà∞${recognitionCameraFacingMode === 'environment' ? 'ÂæåÁΩÆ' : 'ÂâçÁΩÆ'}Èè°È†≠`);
      
      if (recognitionStream) {
        recognitionStream.getTracks().forEach(track => track.stop());
        recognitionStream = null;
      }
      
      document.getElementById('recognitionCameraPreview').style.display = 'flex';
      document.getElementById('recognitionCameraPreview').innerHTML = `
        <div>
          <div style="font-size:48px; margin-bottom:10px;">üîÑ</div>
          <div>Ê≠£Âú®ÂàáÊèõÈè°È†≠...</div>
        </div>
      `;
      
      setTimeout(() => {
        assistant.setupRecognitionCamera();
      }, 500);
    }

    // Â∑•ÂÖ∑ÂáΩÊï∏
    function updateVoice(message) {
      const voiceAlert = document.getElementById('voiceAlert');
      voiceAlert.textContent = message;
      
      voiceAlert.classList.remove('loading');
      
      if (voiceEnabled && window.speechSynthesis) {
        try {
          window.speechSynthesis.cancel();
          const utterance = new SpeechSynthesisUtterance(message);
          utterance.lang = 'zh-TW';
          utterance.rate = 0.9;
          utterance.volume = 1.0;
          window.speechSynthesis.speak(utterance);
        } catch (error) {
          console.log('Ë™ûÈü≥ÂêàÊàêÈåØË™§:', error);
        }
      }
    }

    function updateStatus(status) {
      document.getElementById('status').textContent = status;
    }

    function updateCameraStatus(status) {
      document.getElementById('cameraStatus').textContent = status;
    }

    function updateDetectionStatus(status) {
      document.getElementById('detectionStatus').textContent = status;
    }

    function showDebugInfo(message) {
      const debugElement = document.getElementById('debugInfo');
      debugElement.textContent = 'Èô§ÈåØ: ' + message;
      debugElement.style.display = 'block';
      console.log(message);
    }

    function showError(message) {
      const errorElement = document.getElementById('errorMessage');
      errorElement.textContent = message;
      errorElement.style.display = 'block';
    }

    function hideError() {
      const errorElement = document.getElementById('errorMessage');
      errorElement.style.display = 'none';
    }

    function showModelProgress(message, percent) {
      const progressElement = document.getElementById('modelProgress');
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      
      progressElement.style.display = 'block';
      progressFill.style.width = percent + '%';
      progressText.textContent = percent + '% - ' + message;
    }

    function hideModelProgress() {
      const progressElement = document.getElementById('modelProgress');
      progressElement.style.display = 'none';
    }

    // ÂåÖË£ùÂáΩÊï∏
    function startItemRecognition() {
      assistant.startItemRecognition();
    }

    function toggleContinuousMode() {
      assistant.toggleContinuousMode();
    }

    function toggleVoice() {
      voiceEnabled = !voiceEnabled;
      const button = document.getElementById('voiceToggleBtn');
      if (voiceEnabled) {
        button.innerHTML = '<span>üîá</span><span>ÈóúÈñâË™ûÈü≥</span>';
        updateVoice('Ë™ûÈü≥ÊèêÁ§∫Â∑≤ÈñãÂïü');
      } else {
        button.innerHTML = '<span>üîä</span><span>ÈñãÂïüË™ûÈü≥</span>';
        window.speechSynthesis.cancel();
      }
    }

    function repeatInstruction() {
      const voiceAlert = document.getElementById('voiceAlert');
      if (voiceAlert.textContent && voiceEnabled) {
        updateVoice(voiceAlert.textContent);
      }
    }

    function filterItems() {
      assistant.filterDisplayedItems();
    }

    // È†ÅÈù¢ËºâÂÖ•ÊôÇÂàùÂßãÂåñ
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>