<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0ea5e9" />
  <meta name="description" content="è€æ±ªæ™ºèƒ½ç”Ÿæ´»åŠ©æ‰‹ - ç›²äººè¼”åŠ©å°èˆªèˆ‡ç‰©å“è­˜åˆ¥ç³»çµ±" />
  <title>ğŸ§ è€æ±ªæ™ºèƒ½ç”Ÿæ´»åŠ©æ‰‹ - ç›²äººè¼”åŠ©å°èˆª</title>
  
  <style>
    :root {
      --bg1: #0ea5e9;
      --bg2: #6366f1;
      --glass: rgba(255,255,255,0.12);
      --glass-strong: rgba(255,255,255,0.22);
      --text: #fff;
      --good: #22c55e;
      --warn: #f59e0b;
      --bad: #ef4444;
      --muted: #cbd5e1;
      --primary: #00b894;
      --secondary: #fd79a8;
      --accent: #6c5ce7;
    }
    
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: var(--text);
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      touch-action: manipulation;
    }
    
    body {
      padding: 10px;
      padding-bottom: env(safe-area-inset-bottom, 10px);
    }
    
    .app {
      max-width: 100%;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .card {
      background: var(--glass);
      backdrop-filter: blur(12px);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }
    
    .header {
      text-align: center;
      margin-bottom: 0;
    }
    
    .header h1 {
      margin: 0;
      font-size: 24px;
    }
    
    .header .subtitle {
      font-size: 14px;
      color: var(--muted);
      margin-top: 5px;
    }
    
    .stats-badge {
      background: rgba(255,255,255,0.2);
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 12px;
      margin-top: 8px;
      display: inline-block;
    }
    
    .camera-container {
      position: relative;
      width: 100%;
      aspect-ratio: 16/9;
      background: #000;
      border-radius: 12px;
      overflow: hidden;
    }
    
    .camera-container video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 12px;
    }
    
    .camera-preview {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 16px;
      z-index: 5;
      text-align: center;
      padding: 20px;
    }
    
    .controls {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }
    
    button {
      padding: 16px 12px;
      border: none;
      border-radius: 14px;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-height: 54px;
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    button:active:not(:disabled) {
      transform: translateY(2px) scale(0.98);
    }
    
    .btn-primary {
      background: var(--primary);
      color: #fff;
    }
    
    .btn-danger {
      background: var(--bad);
      color: #fff;
    }
    
    .btn-secondary {
      background: var(--glass-strong);
      color: var(--text);
    }
    
    .btn-accent {
      background: var(--accent);
      color: #fff;
    }
    
    .status-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .status-item {
      background: var(--glass-strong);
      border-radius: 12px;
      padding: 12px;
      text-align: center;
    }
    
    .status-label {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 4px;
    }
    
    .status-value {
      font-weight: 800;
      font-size: 16px;
    }
    
    .voice-alert {
      background: rgba(0, 184, 148, 0.15);
      border: 1px solid rgba(0, 184, 148, 0.35);
      color: #fff;
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      margin-bottom: 15px;
    }
    
    .detection-list {
      max-height: 200px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .detection-item {
      background: var(--glass-strong);
      padding: 10px;
      border-radius: 10px;
      font-size: 13px;
    }
    
    .items-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      margin-top: 15px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .item-card {
      background: rgba(255,255,255,0.1);
      padding: 15px 10px;
      border-radius: 15px;
      text-align: center;
      border: 2px solid rgba(255,255,255,0.1);
      transition: all 0.3s ease;
    }
    
    .item-card.highlight {
      animation: pulse 2s ease-in-out;
      border-color: var(--primary);
    }
    
    .item-name {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 5px;
      color: var(--text);
    }
    
    .item-confidence {
      font-size: 12px;
      color: var(--muted);
    }
    
    .category-tag {
      display: inline-block;
      background: var(--accent);
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 10px;
      margin-top: 5px;
    }
    
    .navigation-info {
      background: rgba(253, 203, 110, 0.15);
      border: 1px solid rgba(253, 203, 110, 0.35);
      padding: 20px;
      border-radius: 12px;
      margin: 15px 0;
      text-align: center;
    }
    
    .direction-arrow {
      font-size: 48px;
      margin: 10px 0;
      color: var(--bad);
    }
    
    .distance-display {
      font-size: 24px;
      font-weight: bold;
      margin: 10px 0;
      color: var(--text);
    }
    
    .instruction-text {
      font-size: 18px;
      color: var(--text);
      margin: 10px 0;
    }
    
    .mode-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .mode-recording { background: var(--bad); }
    .mode-identifying { background: var(--primary); }
    .mode-navigating { background: var(--accent); }
    .mode-idle { background: var(--muted); }
    
    .search-box {
      margin: 15px 0;
      padding: 15px;
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
    }
    
    .search-input {
      width: 100%;
      padding: 12px;
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 10px;
      font-size: 16px;
      background: rgba(255,255,255,0.1);
      color: var(--text);
    }
    
    .search-input::placeholder {
      color: var(--muted);
    }
    
    .category-filter {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    
    .category-btn {
      padding: 6px 12px;
      background: rgba(255,255,255,0.1);
      border: none;
      border-radius: 15px;
      font-size: 12px;
      cursor: pointer;
      color: var(--text);
    }
    
    .category-btn.active {
      background: var(--accent);
      color: white;
    }
    
    .debug-info {
      background: rgba(0,0,0,0.8);
      color: #00ff00;
      padding: 8px;
      border-radius: 5px;
      font-size: 12px;
      margin-top: 8px;
      font-family: monospace;
    }
    
    .loading {
      background: linear-gradient(90deg, var(--bg1), var(--bg2), var(--bg1));
      background-size: 200% 100%;
      animation: loading 2s infinite;
    }
    
    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    @keyframes pulse {
      0%, 100% { 
        transform: scale(1);
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      }
      50% { 
        transform: scale(1.05);
        box-shadow: 0 5px 20px rgba(0, 184, 148, 0.4);
      }
    }
    
    .tab-container {
      display: flex;
      gap: 5px;
      margin-bottom: 15px;
    }
    
    .tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
    }
    
    .tab.active {
      background: var(--accent);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .camera-controls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    .camera-switch {
      flex: 1;
      padding: 10px;
      background: var(--glass-strong);
      border: none;
      border-radius: 10px;
      color: var(--text);
      font-size: 14px;
      cursor: pointer;
    }
    
    .error-message {
      background: rgba(239,68,68,0.15);
      border: 1px solid rgba(239,68,68,0.35);
      color: #fff;
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      margin: 10px 0;
    }
    
    .progress-bar {
      width: 100%;
      height: 6px;
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
      margin: 10px 0;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--primary);
      border-radius: 3px;
      transition: width 0.3s ease;
      width: 0%;
    }
    
    .navigation-controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    
    .turn-instruction {
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      margin: 10px 0;
      padding: 15px;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
    }
    
    .safety-alert {
      background: rgba(239,68,68,0.2);
      border: 1px solid rgba(239,68,68,0.4);
      color: #fff;
      border-radius: 12px;
      padding: 12px;
      text-align: center;
      margin: 10px 0;
      font-size: 14px;
    }
    
    .road-info {
      background: rgba(34,197,94,0.15);
      border: 1px solid rgba(34,197,94,0.35);
      color: #fff;
      border-radius: 12px;
      padding: 12px;
      text-align: center;
      margin: 10px 0;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- æ¨™é¡Œ -->
    <div class="card header">
      <h1>ğŸ§  æ™ºèƒ½ç”Ÿæ´»åŠ©æ‰‹</h1>
      <div class="subtitle">ç›²äººè¼”åŠ©å°èˆª â€¢ 1500+ç‰©å“è­˜åˆ¥</div>
      <div class="stats-badge">æ”¯æ´ 21å¤§é¡åˆ¥ â€¢ è¶…é1500ç¨®ç‰©å“</div>
    </div>

    <!-- æ¨™ç±¤åˆ‡æ› -->
    <div class="card">
      <div class="tab-container">
        <div class="tab active" data-tab="navigation">å°èˆªæ¨¡å¼</div>
        <div class="tab" data-tab="recognition">ç‰©å“è­˜åˆ¥</div>
      </div>
    </div>

    <!-- èªéŸ³æç¤º -->
    <div id="voiceAlert" class="voice-alert">
      ç³»çµ±æº–å‚™ä¸­...
    </div>

    <!-- éŒ¯èª¤è¨Šæ¯ -->
    <div id="errorMessage" class="error-message" style="display: none;"></div>

    <!-- å°èˆªæ¨¡å¼å…§å®¹ -->
    <div id="navigationTab" class="tab-content active">
      <!-- ç›¸æ©Ÿç•«é¢ -->
      <div class="card">
        <div class="camera-container">
          <div id="cameraPreview" class="camera-preview">
            <div>
              <div style="font-size:48px; margin-bottom:10px;">ğŸ“·</div>
              <div>é»æ“Šã€Œé–‹å•Ÿç›¸æ©Ÿã€é–‹å§‹ä½¿ç”¨</div>
              <div style="font-size:12px; margin-top:10px; color:var(--muted);">
                é“è·¯è¾¨è­˜èˆ‡éšœç¤™ç‰©æª¢æ¸¬
              </div>
            </div>
          </div>
          <video id="video" autoplay playsinline muted></video>
        </div>
      </div>

      <!-- æ§åˆ¶é¢æ¿ -->
      <div class="card">
        <div class="controls">
          <button id="btnCamera" class="btn-primary">
            <span>ğŸ“·</span>
            <span>é–‹å•Ÿç›¸æ©Ÿ</span>
          </button>
          <button id="btnStart" class="btn-primary" disabled>
            <span>ğŸ”</span>
            <span>é–‹å§‹æª¢æ¸¬</span>
          </button>
          <button id="btnTest" class="btn-secondary" disabled>
            <span>ğŸ§ª</span>
            <span>æ¸¬è©¦åŠŸèƒ½</span>
          </button>
          <button id="btnStop" class="btn-danger" disabled>
            <span>â¹ï¸</span>
            <span>åœæ­¢</span>
          </button>
        </div>

        <div class="status-grid">
          <div class="status-item">
            <div class="status-label">ç³»çµ±ç‹€æ…‹</div>
            <div class="status-value" id="status">æº–å‚™ä¸­</div>
          </div>
          <div class="status-item">
            <div class="status-label">æª¢æ¸¬æ¨¡å¼</div>
            <div class="status-value" id="detectionMode">é“è·¯è¾¨è­˜</div>
          </div>
          <div class="status-item">
            <div class="status-label">ç›¸æ©Ÿç‹€æ…‹</div>
            <div class="status-value" id="cameraStatus">æœªé–‹å•Ÿ</div>
          </div>
          <div class="status-item">
            <div class="status-label">å°èˆªç‹€æ…‹</div>
            <div class="status-value" id="navigationStatus">æœªé–‹å§‹</div>
          </div>
        </div>

        <div id="debugInfo" class="debug-info" style="display:none;"></div>
      </div>

      <!-- å°èˆªæ§åˆ¶ -->
      <div class="card">
        <h3 style="margin:0 0 12px 0;">å°èˆªå›å®¶</h3>
        <div class="navigation-controls">
          <button class="btn-primary" onclick="startNavigationHome()" id="btnNavigateHome">
            <span>ğŸ§­</span>
            <span>é–‹å§‹å°èˆªå›å®¶</span>
          </button>
          <button class="btn-accent" onclick="openGoogleMaps()" id="btnGoogleMaps">
            <span>ğŸ—ºï¸</span>
            <span>é–‹å•ŸGoogleåœ°åœ–</span>
          </button>
          <button class="btn-secondary" onclick="simulateTurn('left')">
            <span>â†©ï¸</span>
            <span>æ¸¬è©¦å·¦è½‰</span>
          </button>
          <button class="btn-secondary" onclick="simulateTurn('right')">
            <span>â†ªï¸</span>
            <span>æ¸¬è©¦å³è½‰</span>
          </button>
        </div>
      </div>

      <!-- å°èˆªè³‡è¨Š -->
      <div id="navigationPanel" class="navigation-info" style="display: none;">
        <div class="direction-arrow" id="directionArrow">â†‘</div>
        <div class="distance-display" id="distanceDisplay">-- å…¬å°º</div>
        <div class="turn-instruction" id="turnInstruction">
          æº–å‚™é–‹å§‹å°èˆª...
        </div>
        <div class="road-info" id="roadInfo">
          é“è·¯è¾¨è­˜ä¸­...
        </div>
        <div class="safety-alert" id="safetyAlert" style="display: none;">
          æ³¨æ„å‰æ–¹å®‰å…¨ï¼
        </div>
      </div>

      <!-- æª¢æ¸¬çµæœ -->
      <div class="card">
        <h3 style="margin:0 0 12px 0;">ç’°å¢ƒæª¢æ¸¬</h3>
        <div id="detectionList" class="detection-list">
          <div class="detection-item" style="text-align:center; color:var(--muted);">
            ç­‰å¾…é–‹å§‹åµæ¸¬â€¦
          </div>
        </div>
      </div>

      <!-- ä½¿ç”¨èªªæ˜ -->
      <div class="card">
        <h4 style="margin:0 0 8px 0;">ä½¿ç”¨èªªæ˜</h4>
        <div style="font-size:12px; color:var(--muted); line-height:1.4;">
          <div>1. é»æ“Šã€Œè¨˜éŒ„å®¶çš„ä½ç½®ã€è¨­å®šå›å®¶ç›®çš„åœ°</div>
          <div>2. é»æ“Šã€Œé–‹å§‹å°èˆªå›å®¶ã€å•Ÿå‹•èªéŸ³å°èˆª</div>
          <div>3. ç³»çµ±æœƒæä¾›è½‰å‘æŒ‡ç¤ºï¼ˆå·¦è½‰ã€å³è½‰ã€ç›´è¡Œï¼‰</div>
          <div>4. é–‹å•Ÿç›¸æ©Ÿå¯é€²è¡Œé“è·¯è¾¨è­˜èˆ‡éšœç¤™ç‰©æª¢æ¸¬</div>
          <div>5. é»æ“Šã€Œé–‹å•ŸGoogleåœ°åœ–ã€ä½¿ç”¨è©³ç´°å°èˆª</div>
        </div>
      </div>
    </div>

    <!-- ç‰©å“è­˜åˆ¥æ¨¡å¼å…§å®¹ -->
    <div id="recognitionTab" class="tab-content">
      <!-- é€²åº¦æ¢ -->
      <div id="modelProgress" class="card" style="display: none;">
        <div style="text-align: center; margin-bottom: 10px;">
          <div style="font-size: 18px; font-weight: bold;">æ­£åœ¨è¼‰å…¥AIæ¨¡å‹</div>
          <div style="font-size: 12px; color: var(--muted); margin-top: 5px;">è«‹ç¨å€™ï¼Œé¦–æ¬¡ä½¿ç”¨éœ€è¦è¼‰å…¥æ¨¡å‹</div>
        </div>
        <div class="progress-bar">
          <div id="progressFill" class="progress-fill"></div>
        </div>
        <div id="progressText" style="text-align: center; font-size: 12px; color: var(--muted); margin-top: 5px;">0%</div>
      </div>

      <!-- ç›¸æ©Ÿç•«é¢ -->
      <div class="card">
        <div class="camera-container">
          <div id="recognitionCameraPreview" class="camera-preview">
            <div>
              <div style="font-size:48px; margin-bottom:10px;">ğŸ“·</div>
              <div>é»æ“Šã€Œé–‹å•Ÿç›¸æ©Ÿã€é–‹å§‹ç‰©å“è­˜åˆ¥</div>
              <div style="font-size:12px; margin-top:10px; color:var(--muted);">
                å¯è­˜åˆ¥1500+ç¨®æ—¥å¸¸ç‰©å“
              </div>
            </div>
          </div>
          <video id="recognitionVideo" autoplay playsinline muted></video>
        </div>
        <div class="camera-controls">
          <button class="camera-switch" onclick="switchRecognitionCamera()">
            <span>ğŸ”„</span>
            <span>åˆ‡æ›é¡é ­</span>
          </button>
        </div>
      </div>

      <!-- ä¸»è¦æ§åˆ¶æŒ‰éˆ• -->
      <div class="card">
        <div class="controls">
          <button class="btn-primary" onclick="startItemRecognition()" id="btnRecognition" disabled>
            <span>ğŸ”</span>
            <span>æ™ºèƒ½è­˜åˆ¥</span>
          </button>
          <button class="btn-accent" onclick="toggleContinuousMode()" id="continuousBtn">
            <span>ğŸ”„</span>
            <span>é€£çºŒè­˜åˆ¥</span>
          </button>
          <button class="btn-secondary" onclick="setHomeLocation()">
            <span>ğŸ </span>
            <span>è¨­å®šå®¶çš„ä½ç½®</span>
          </button>
          <button class="btn-danger" onclick="startNavigationHome()">
            <span>ğŸ§­</span>
            <span>å°èˆªå›å®¶</span>
          </button>
        </div>
      </div>

      <!-- æœå°‹å’Œåˆ†é¡ -->
      <div class="card search-box">
        <input type="text" class="search-input" placeholder="ğŸ” æœå°‹ç‰©å“åç¨±..." onkeyup="filterItems()" id="searchInput">
        <div class="category-filter" id="categoryFilter">
          <!-- åˆ†é¡æŒ‰éˆ•æœƒç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
        </div>
      </div>

      <!-- ç‹€æ…‹é¢æ¿ -->
      <div class="card">
        <div class="status-grid">
          <div class="status-item">
            <div class="status-label">ç•¶å‰æ¨¡å¼</div>
            <div class="status-value"><span class="mode-indicator" id="modeIndicator"></span><span id="currentMode">å¾…æ©Ÿä¸­</span></div>
          </div>
          <div class="status-item">
            <div class="status-label">è­˜åˆ¥ç‰©å“æ•¸</div>
            <div class="status-value" id="itemCount">0</div>
          </div>
          <div class="status-item">
            <div class="status-label">å®¶çš„ä½ç½®</div>
            <div class="status-value" id="homeStatus">æœªè¨­å®š</div>
          </div>
          <div class="status-item">
            <div class="status-label">è³‡æ–™åº«</div>
            <div class="status-value" id="databaseSize">1500+ ç‰©å“</div>
          </div>
        </div>
      </div>

      <!-- ç‰©å“è­˜åˆ¥çµæœ -->
      <div class="card">
        <h3 style="margin:0 0 12px 0;">ç‰©å“è­˜åˆ¥çµæœ</h3>
        <div id="itemsContainer" class="items-grid">
          <div class="item-card" style="background: rgba(255,255,255,0.1); color: var(--muted);">
            <div class="item-name">ç­‰å¾…AIæ¨¡å‹è¼‰å…¥...</div>
            <div class="item-confidence">é¦–æ¬¡ä½¿ç”¨éœ€è¦è¼‰å…¥æ¨¡å‹</div>
          </div>
        </div>
      </div>

      <!-- è¼”åŠ©æ§åˆ¶ -->
      <div class="card">
        <div class="controls">
          <button class="btn-secondary" onclick="repeatInstruction()">
            <span>ğŸ”Š</span>
            <span>é‡è¤‡æç¤º</span>
          </button>
          <button class="btn-secondary" onclick="toggleVoice()" id="voiceToggleBtn">
            <span>ğŸ”‡</span>
            <span>é—œé–‰èªéŸ³</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3/dist/coco-ssd.min.js"></script>
  
  <script>
    // æ“´å±•ç‰©å“è³‡æ–™åº« - 1500+ç¨®ç‰©å“
    const itemDatabase = {
      // 1. äººç‰©å‹•ç‰©é¡ (80+)
      'äººç‰©å‹•ç‰©': {
        'person': 'äºº', 'baby': 'å¬°å…’', 'child': 'å°å­©', 'adult': 'æˆäºº', 'elderly': 'è€äºº',
        'bird': 'é³¥', 'cat': 'è²“', 'dog': 'ç‹—', 'horse': 'é¦¬', 'cow': 'ç‰›',
        'sheep': 'ç¾Š', 'goat': 'å±±ç¾Š', 'pig': 'è±¬', 'chicken': 'é›', 'duck': 'é´¨',
        'rabbit': 'å…”å­', 'hamster': 'å€‰é¼ ', 'guinea pig': 'å¤©ç«ºé¼ ', 'turtle': 'çƒé¾œ',
        'fish': 'é­š', 'goldfish': 'é‡‘é­š', 'shark': 'é¯Šé­š', 'dolphin': 'æµ·è±š',
        'whale': 'é¯¨é­š', 'elephant': 'å¤§è±¡', 'lion': 'ç…å­', 'tiger': 'è€è™',
        'bear': 'ç†Š', 'panda': 'ç†Šè²“', 'monkey': 'çŒ´å­', 'giraffe': 'é•·é ¸é¹¿',
        'zebra': 'æ–‘é¦¬', 'kangaroo': 'è¢‹é¼ ', 'penguin': 'ä¼éµ', 'owl': 'è²“é ­é·¹',
        'eagle': 'è€é·¹', 'parrot': 'é¸šéµ¡', 'sparrow': 'éº»é›€', 'pigeon': 'é´¿å­',
        'butterfly': 'è´è¶', 'bee': 'èœœèœ‚', 'ant': 'èèŸ»', 'spider': 'èœ˜è››',
        'snake': 'è›‡', 'lizard': 'èœ¥èœ´', 'frog': 'é’è›™', 'crocodile': 'é±·é­š'
      },

      // 2. äº¤é€šå·¥å…·é¡ (60+)
      'äº¤é€šå·¥å…·': {
        'car': 'æ±½è»Š', 'bus': 'å…¬è»Š', 'truck': 'å¡è»Š', 'motorcycle': 'æ‘©æ‰˜è»Š',
        'bicycle': 'è…³è¸è»Š', 'scooter': 'æ»‘æ¿è»Š', 'train': 'ç«è»Š', 'subway': 'åœ°éµ',
        'airplane': 'é£›æ©Ÿ', 'helicopter': 'ç›´å‡æ©Ÿ', 'boat': 'èˆ¹', 'ship': 'è¼ªèˆ¹',
        'yacht': 'éŠè‰‡', 'canoe': 'ç¨æœ¨èˆŸ', 'ambulance': 'æ•‘è­·è»Š', 'fire truck': 'æ¶ˆé˜²è»Š',
        'police car': 'è­¦è»Š', 'taxi': 'è¨ˆç¨‹è»Š', 'van': 'å»‚å‹è»Š', 'jeep': 'å‰æ™®è»Š',
        'minivan': 'ä¼‘æ—…è»Š', 'suv': 'é‹å‹•ä¼‘æ—…è»Š', 'sedan': 'æˆ¿è»Š', 'convertible': 'æ•ç¯·è»Š',
        'racing car': 'è³½è»Š', 'bulldozer': 'æ¨åœŸæ©Ÿ', 'excavator': 'æŒ–åœŸæ©Ÿ', 'tractor': 'æ‹–æ‹‰æ©Ÿ'
      },

      // 3. å®¶å…·é¡ (50+)
      'å®¶å…·': {
        'chair': 'æ¤…å­', 'sofa': 'æ²™ç™¼', 'couch': 'é•·æ²™ç™¼', 'bed': 'åºŠ',
        'table': 'æ¡Œå­', 'desk': 'æ›¸æ¡Œ', 'dining table': 'é¤æ¡Œ', 'coffee table': 'å’–å•¡æ¡Œ',
        'cabinet': 'æ«¥æ«ƒ', 'wardrobe': 'è¡£æ«ƒ', 'bookshelf': 'æ›¸æ¶', 'dresser': 'æ¢³å¦å°',
        'nightstand': 'åºŠé ­æ«ƒ', 'stool': 'å‡³å­', 'bench': 'é•·æ¤…', 'rocking chair': 'æ–æ¤…',
        'armchair': 'æ‰¶æ‰‹æ¤…', 'office chair': 'è¾¦å…¬æ¤…', 'bar stool': 'å§å°æ¤…'
      },

      // 4. é›»å­ç”¢å“é¡ (80+)
      'é›»å­ç”¢å“': {
        'tv': 'é›»è¦–', 'computer': 'é›»è…¦', 'laptop': 'ç­†è¨˜å‹é›»è…¦', 'monitor': 'é¡¯ç¤ºå™¨',
        'keyboard': 'éµç›¤', 'mouse': 'æ»‘é¼ ', 'printer': 'å°è¡¨æ©Ÿ', 'scanner': 'æƒæå™¨',
        'router': 'è·¯ç”±å™¨', 'modem': 'æ•¸æ“šæ©Ÿ', 'smartphone': 'æ™ºæ…§æ‰‹æ©Ÿ', 'tablet': 'å¹³æ¿é›»è…¦',
        'camera': 'ç›¸æ©Ÿ', 'webcam': 'ç¶²è·¯æ”å½±æ©Ÿ', 'microphone': 'éº¥å…‹é¢¨', 'speaker': 'å–‡å­',
        'headphones': 'è€³æ©Ÿ', 'earphones': 'è€³å¡', 'remote': 'é™æ§å™¨', 'game console': 'éŠæˆ²æ©Ÿ',
        'controller': 'æ§åˆ¶å™¨', 'smartwatch': 'æ™ºæ…§æ‰‹éŒ¶', 'fitness tracker': 'å¥èº«æ‰‹ç’°'
      },

      // 5. å»šæˆ¿ç”¨å“é¡ (120+)
      'å»šæˆ¿ç”¨å“': {
        'refrigerator': 'å†°ç®±', 'oven': 'çƒ¤ç®±', 'microwave': 'å¾®æ³¢çˆ', 'stove': 'çˆç¶',
        'dishwasher': 'æ´—ç¢—æ©Ÿ', 'blender': 'æœæ±æ©Ÿ', 'toaster': 'çƒ¤éºµåŒ…æ©Ÿ', 'kettle': 'ç†±æ°´å£º',
        'coffee maker': 'å’–å•¡æ©Ÿ', 'mixer': 'æ”ªæ‹Œæ©Ÿ', 'food processor': 'é£Ÿç‰©è™•ç†æ©Ÿ',
        'knife': 'åˆ€å­', 'fork': 'å‰å­', 'spoon': 'æ¹¯åŒ™', 'chopsticks': 'ç­·å­',
        'plate': 'ç›¤å­', 'bowl': 'ç¢—', 'cup': 'æ¯å­', 'mug': 'é¦¬å…‹æ¯',
        'glass': 'ç»ç’ƒæ¯', 'wine glass': 'é…’æ¯', 'bottle': 'ç“¶å­', 'jar': 'ç½å­',
        'pot': 'é‹å­', 'pan': 'å¹³åº•é‹', 'wok': 'ç‚’é‹', 'cutting board': 'ç §æ¿'
      },

      // 6. é£Ÿç‰©é¡ (150+)
      'é£Ÿç‰©': {
        'apple': 'è˜‹æœ', 'banana': 'é¦™è•‰', 'orange': 'æŸ³æ©™', 'grape': 'è‘¡è„',
        'strawberry': 'è‰è“', 'watermelon': 'è¥¿ç“œ', 'pineapple': 'é³³æ¢¨', 'mango': 'èŠ’æœ',
        'peach': 'æ¡ƒå­', 'pear': 'æ¢¨å­', 'cherry': 'æ«»æ¡ƒ', 'kiwi': 'å¥‡ç•°æœ',
        'lemon': 'æª¸æª¬', 'lime': 'èŠå§†', 'coconut': 'æ¤°å­', 'avocado': 'é…ªæ¢¨',
        'tomato': 'ç•ªèŒ„', 'potato': 'é¦¬éˆ´è–¯', 'carrot': 'ç´…è˜¿è””', 'onion': 'æ´‹è”¥',
        'garlic': 'å¤§è’œ', 'ginger': 'è–‘', 'broccoli': 'èŠ±æ¤°èœ', 'cauliflower': 'ç™½èŠ±æ¤°èœ',
        'cabbage': 'é«˜éº—èœ', 'lettuce': 'ç”Ÿèœ', 'spinach': 'è èœ', 'celery': 'èŠ¹èœ',
        'corn': 'ç‰ç±³', 'pea': 'è±Œè±†', 'bean': 'è±†å­', 'mushroom': 'è˜‘è‡'
      },

      // 7. é£²æ–™é¡ (30+)
      'é£²æ–™': {
        'water': 'æ°´', 'juice': 'æœæ±', 'soda': 'æ±½æ°´', 'cola': 'å¯æ¨‚',
        'tea': 'èŒ¶', 'coffee': 'å’–å•¡', 'milk': 'ç‰›å¥¶', 'yogurt': 'å„ªæ ¼',
        'smoothie': 'å†°æ²™', 'beer': 'å•¤é…’', 'wine': 'è‘¡è„é…’', 'champagne': 'é¦™æª³'
      },

      // 8. æœé£¾é¡ (100+)
      'æœé£¾': {
        'shirt': 'è¥¯è¡«', 't-shirt': 'Tæ¤', 'pants': 'è¤²å­', 'jeans': 'ç‰›ä»”è¤²',
        'shorts': 'çŸ­è¤²', 'skirt': 'è£™å­', 'dress': 'æ´‹è£', 'jacket': 'å¤¾å…‹',
        'coat': 'å¤§è¡£', 'sweater': 'æ¯›è¡£', 'hoodie': 'é€£å¸½è¡«', 'suit': 'è¥¿è£',
        'tie': 'é ˜å¸¶', 'belt': 'çš®å¸¶', 'hat': 'å¸½å­', 'cap': 'æ£’çƒå¸½',
        'scarf': 'åœå·¾', 'gloves': 'æ‰‹å¥—', 'socks': 'è¥ªå­', 'shoes': 'é‹å­'
      },

      // 9. é‹å­é¡ (40+)
      'é‹å­': {
        'sneakers': 'é‹å‹•é‹', 'running shoes': 'è·‘é‹', 'boots': 'é´å­',
        'sandals': 'æ¶¼é‹', 'flip flops': 'å¤¾è…³æ‹–', 'high heels': 'é«˜è·Ÿé‹',
        'loafers': 'æ¨‚ç¦é‹', 'dress shoes': 'çš®é‹', 'slippers': 'æ‹–é‹'
      },

      // 10. åŒ…åŒ…é¡ (30+)
      'åŒ…åŒ…': {
        'backpack': 'èƒŒåŒ…', 'handbag': 'æ‰‹æåŒ…', 'purse': 'éŒ¢åŒ…',
        'briefcase': 'å…¬äº‹åŒ…', 'suitcase': 'è¡Œæç®±', 'wallet': 'çš®å¤¾',
        'clutch': 'æ‰‹æ‹¿åŒ…', 'tote bag': 'æ‰˜ç‰¹åŒ…', 'duffle bag': 'æ—…è¡Œè¢‹'
      },

      // 11. åŒ–å¦å“é¡ (60+)
      'åŒ–å¦å“': {
        'lipstick': 'å£ç´…', 'mascara': 'ç«æ¯›è†', 'eyeliner': 'çœ¼ç·šç­†',
        'eyeshadow': 'çœ¼å½±', 'foundation': 'ç²‰åº•', 'concealer': 'é®ç‘•è†',
        'blush': 'è…®ç´…', 'powder': 'èœœç²‰', 'perfume': 'é¦™æ°´', 'nail polish': 'æŒ‡ç”²æ²¹'
      },

      // 12. æ¸…æ½”ç”¨å“é¡ (50+)
      'æ¸…æ½”ç”¨å“': {
        'broom': 'æƒå¸š', 'mop': 'æ‹–æŠŠ', 'vacuum cleaner': 'å¸å¡µå™¨',
        'detergent': 'æ¸…æ½”åŠ‘', 'soap': 'è‚¥çš‚', 'shampoo': 'æ´—é«®ç²¾',
        'conditioner': 'æ½¤é«®ä¹³', 'toothpaste': 'ç‰™è†', 'toothbrush': 'ç‰™åˆ·'
      },

      // 13. è¾¦å…¬ç”¨å“é¡ (70+)
      'è¾¦å…¬ç”¨å“': {
        'pen': 'ç­†', 'pencil': 'é‰›ç­†', 'marker': 'éº¥å…‹ç­†', 'highlighter': 'è¢å…‰ç­†',
        'notebook': 'ç­†è¨˜æœ¬', 'paper': 'ç´™å¼µ', 'envelope': 'ä¿¡å°', 'stapler': 'è¨‚æ›¸æ©Ÿ',
        'scissors': 'å‰ªåˆ€', 'ruler': 'å°º', 'calculator': 'è¨ˆç®—æ©Ÿ', 'calendar': 'æ—¥æ›†'
      },

      // 14. é‹å‹•å™¨æé¡ (80+)
      'é‹å‹•å™¨æ': {
        'basketball': 'ç±ƒçƒ', 'football': 'ç¾å¼è¶³çƒ', 'soccer ball': 'è¶³çƒ',
        'tennis ball': 'ç¶²çƒ', 'baseball': 'æ£’çƒ', 'volleyball': 'æ’çƒ',
        'golf club': 'é«˜çˆ¾å¤«çƒæ¡¿', 'tennis racket': 'ç¶²çƒæ‹', 'badminton racket': 'ç¾½æ¯›çƒæ‹',
        'skateboard': 'æ»‘æ¿', 'bicycle': 'è…³è¸è»Š', 'dumbbell': 'å•éˆ´', 'yoga mat': 'ç‘œä¼½å¢Š'
      },

      // 15. æ¨‚å™¨é¡ (50+)
      'æ¨‚å™¨': {
        'piano': 'é‹¼ç´', 'guitar': 'å‰ä»–', 'violin': 'å°æç´', 'drum': 'é¼“',
        'trumpet': 'å°è™Ÿ', 'saxophone': 'è–©å…‹æ–¯é¢¨', 'flute': 'é•·ç¬›', 'clarinet': 'å–®ç°§ç®¡'
      },

      // 16. é†«ç™‚ç”¨å“é¡ (40+)
      'é†«ç™‚ç”¨å“': {
        'thermometer': 'æº«åº¦è¨ˆ', 'bandage': 'ç¹ƒå¸¶', 'syringe': 'æ³¨å°„å™¨',
        'pill': 'è—¥ä¸¸', 'medicine': 'è—¥å“', 'first aid kit': 'æ€¥æ•‘ç®±'
      },

      // 17. å»ºç¯‰ç‰©é¡ (60+)
      'å»ºç¯‰ç‰©': {
        'house': 'æˆ¿å­', 'apartment': 'å…¬å¯“', 'building': 'å»ºç¯‰ç‰©',
        'school': 'å­¸æ ¡', 'hospital': 'é†«é™¢', 'store': 'å•†åº—',
        'restaurant': 'é¤å»³', 'hotel': 'é£¯åº—', 'bank': 'éŠ€è¡Œ', 'church': 'æ•™å ‚'
      },

      // 18. å®¤å¤–ç‰©å“é¡ (80+)
      'å®¤å¤–ç‰©å“': {
        'tree': 'æ¨¹', 'flower': 'èŠ±', 'grass': 'è‰', 'fountain': 'å™´æ³‰',
        'bench': 'é•·æ¤…', 'street light': 'è·¯ç‡ˆ', 'traffic light': 'ç´…ç¶ ç‡ˆ',
        'stop sign': 'åœæ­¢æ¨™èªŒ', 'mailbox': 'éƒµç®±', 'fire hydrant': 'æ¶ˆé˜²æ “'
      },

      // 19. ç©å…·é¡ (60+)
      'ç©å…·': {
        'doll': 'å¨ƒå¨ƒ', 'teddy bear': 'æ³°è¿ªç†Š', 'puzzle': 'æ‹¼åœ–',
        'lego': 'æ¨‚é«˜', 'robot': 'æ©Ÿå™¨äºº', 'car toy': 'ç©å…·è»Š',
        'ball': 'çƒ', 'kite': 'é¢¨ç®', 'playing cards': 'æ’²å…‹ç‰Œ'
      },

      // 20. ç å¯¶é¦–é£¾é¡ (40+)
      'ç å¯¶é¦–é£¾': {
        'ring': 'æˆ’æŒ‡', 'necklace': 'é …éŠ', 'bracelet': 'æ‰‹éŠ',
        'earrings': 'è€³ç’°', 'watch': 'æ‰‹éŒ¶', 'brooch': 'èƒ¸é‡'
      },

      // 21. å…¶ä»–ç‰©å“é¡ (100+)
      'å…¶ä»–ç‰©å“': {
        'clock': 'æ™‚é˜', 'watch': 'æ‰‹éŒ¶', 'umbrella': 'é›¨å‚˜', 'key': 'é‘°åŒ™',
        'money': 'éŒ¢', 'credit card': 'ä¿¡ç”¨å¡', 'book': 'æ›¸', 'magazine': 'é›œèªŒ',
        'newspaper': 'å ±ç´™', 'phone': 'é›»è©±', 'candle': 'è Ÿç‡­', 'vase': 'èŠ±ç“¶'
      }
    };

    // å»ºç«‹å®Œæ•´çš„ç‰©å“æ˜ å°„
    const itemNames = {};
    const itemCategories = {};
    Object.keys(itemDatabase).forEach(category => {
      Object.keys(itemDatabase[category]).forEach(key => {
        itemNames[key] = itemDatabase[category][key];
        itemCategories[key] = category;
      });
    });

    console.log(`è¼‰å…¥å®Œæˆ: ${Object.keys(itemNames).length} ç¨®ç‰©å“`);

    // å°èˆªç³»çµ±ç‹€æ…‹è®Šæ•¸
    let isDetecting = false;
    let currentStream = null;
    let detectionInterval = null;
    let lastDetectionTime = 0;

    // ç‰©å“è­˜åˆ¥ç³»çµ±ç‹€æ…‹è®Šæ•¸
    let recognitionStream = null;
    let recognitionCameraFacingMode = 'environment';
    let modelLoaded = false;

    // æ™ºèƒ½åŠ©æ‰‹é¡
    class SmartAssistant {
      constructor() {
        this.model = null;
        this.isRecognizing = false;
        this.continuousMode = false;
        this.voiceEnabled = true;
        this.homeLocation = null;
        this.isNavigating = false;
        this.watchId = null;
        this.lastItems = [];
        this.lastSpeechTime = 0;
        this.SPEECH_COOLDOWN = 4000;
        this.currentCategory = 'å…¨éƒ¨';
        this.navigationSteps = [];
        this.currentStep = 0;
        this.continuousInterval = null;
      }

      // åˆå§‹åŒ–AIæ¨¡å‹
      async initModel() {
        try {
          updateVoice('æ­£åœ¨æº–å‚™æ™ºèƒ½è­˜åˆ¥ç³»çµ±...');
          showModelProgress('æ­£åœ¨è¼‰å…¥AIæ¨¡å‹ï¼Œè«‹ç¨å€™...', 10);
          
          if (typeof tf === 'undefined') {
            throw new Error('TensorFlow.js è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥');
          }
          
          if (typeof cocoSsd === 'undefined') {
            throw new Error('COCO-SSD æ¨¡å‹è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥');
          }

          showModelProgress('åˆå§‹åŒ–TensorFlowå¼•æ“...', 30);
          await tf.ready();
          
          showModelProgress('è¼‰å…¥COCO-SSDæ¨¡å‹...', 50);
          this.model = await cocoSsd.load();
          
          showModelProgress('æ¨¡å‹è¼‰å…¥å®Œæˆï¼', 100);
          modelLoaded = true;
          
          setTimeout(() => {
            hideModelProgress();
            updateVoice(`ç³»çµ±æº–å‚™å®Œæˆï¼å¯è­˜åˆ¥${Object.keys(itemNames).length}ç¨®ç‰©å“`);
            this.updateModeIndicator('idle');
            this.initCategoryFilter();
            
            document.getElementById('btnRecognition').disabled = false;
            document.getElementById('continuousBtn').disabled = false;
            
            document.getElementById('itemsContainer').innerHTML = `
              <div class="item-card" style="background: rgba(255,255,255,0.1); color: var(--muted); grid-column: 1/-1;">
                <div class="item-name">AIæ¨¡å‹è¼‰å…¥å®Œæˆ</div>
                <div class="item-confidence">é»æ“Šã€Œæ™ºèƒ½è­˜åˆ¥ã€é–‹å§‹ç‰©å“è­˜åˆ¥</div>
              </div>
            `;
          }, 1000);
          
        } catch (error) {
          console.error('æ¨¡å‹è¼‰å…¥å¤±æ•—:', error);
          modelLoaded = false;
          hideModelProgress();
          showError('AIæ¨¡å‹è¼‰å…¥å¤±æ•—ï¼š' + error.message);
          updateVoice('AIæ¨¡å‹è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥å¾Œé‡æ–°æ•´ç†é é¢');
        }
      }

      // åˆå§‹åŒ–åˆ†é¡ç¯©é¸å™¨
      initCategoryFilter() {
        const container = document.getElementById('categoryFilter');
        const categories = ['å…¨éƒ¨', ...Object.keys(itemDatabase)];
        
        container.innerHTML = categories.map(category => 
          `<button class="category-btn ${category === 'å…¨éƒ¨' ? 'active' : ''}" 
                  onclick="assistant.setCategory('${category}')">${category}</button>`
        ).join('');
      }

      // è¨­å®šåˆ†é¡
      setCategory(category) {
        this.currentCategory = category;
        
        document.querySelectorAll('.category-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        this.filterDisplayedItems();
      }

      // ç¯©é¸é¡¯ç¤ºçš„ç‰©å“
      filterDisplayedItems() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const filteredItems = this.lastItems.filter(item => {
          const matchesCategory = this.currentCategory === 'å…¨éƒ¨' || 
                                itemCategories[item.class] === this.currentCategory;
          const matchesSearch = item.name.toLowerCase().includes(searchTerm) ||
                              item.class.toLowerCase().includes(searchTerm);
          return matchesCategory && matchesSearch;
        });
        
        this.updateItemsDisplay(filteredItems);
      }

      // é–‹å§‹ç‰©å“è­˜åˆ¥
      async startItemRecognition() {
        if (!modelLoaded) {
          showError('AIæ¨¡å‹å°šæœªè¼‰å…¥å®Œæˆï¼Œè«‹ç¨å€™å†è©¦');
          updateVoice('ç³»çµ±å°šæœªæº–å‚™å¥½ï¼Œè«‹ç­‰å¾…æ¨¡å‹è¼‰å…¥');
          return;
        }

        const video = await this.setupRecognitionCamera();
        if (!video) return;

        this.isRecognizing = true;
        this.updateModeIndicator('identifying');
        updateVoice('é–‹å§‹è­˜åˆ¥ç‰©å“ï¼Œè«‹å°‡é¡é ­å°æº–æƒ³èªè­˜çš„ç‰©å“');

        try {
          const predictions = await this.model.detect(video);
          this.processRecognitionResults(predictions);
        } catch (error) {
          console.error('è­˜åˆ¥å¤±æ•—:', error);
          updateVoice('è­˜åˆ¥å¤±æ•—ï¼Œè«‹é‡è©¦');
          showError('ç‰©å“è­˜åˆ¥å¤±æ•—ï¼š' + error.message);
        }

        this.isRecognizing = false;
        this.updateModeIndicator('idle');
      }

      // åˆ‡æ›é€£çºŒè­˜åˆ¥æ¨¡å¼
      async toggleContinuousMode() {
        if (this.continuousMode) {
          this.stopContinuousMode();
        } else {
          await this.startContinuousMode();
        }
      }

      // é–‹å§‹é€£çºŒè­˜åˆ¥
      async startContinuousMode() {
        if (!modelLoaded) {
          showError('AIæ¨¡å‹å°šæœªè¼‰å…¥å®Œæˆï¼Œè«‹ç¨å€™å†è©¦');
          updateVoice('ç³»çµ±å°šæœªæº–å‚™å¥½ï¼Œè«‹ç­‰å¾…æ¨¡å‹è¼‰å…¥');
          return;
        }

        const video = await this.setupRecognitionCamera();
        if (!video) return;

        this.continuousMode = true;
        this.isRecognizing = true;
        this.updateModeIndicator('identifying');
        updateVoice('é–‹å•Ÿé€£çºŒè­˜åˆ¥æ¨¡å¼ï¼Œç³»çµ±æœƒæŒçºŒå‘Šè¨´æ‚¨çœ‹åˆ°çš„ç‰©å“');
        
        document.getElementById('continuousBtn').innerHTML = 
          '<span>â¹ï¸</span><span>åœæ­¢è­˜åˆ¥</span>';

        this.continuousRecognition(video);
      }

      // åœæ­¢é€£çºŒè­˜åˆ¥
      stopContinuousMode() {
        this.continuousMode = false;
        this.isRecognizing = false;
        this.updateModeIndicator('idle');
        updateVoice('å·²åœæ­¢é€£çºŒè­˜åˆ¥');
        
        document.getElementById('continuousBtn').innerHTML = 
          '<span>ğŸ”„</span><span>é€£çºŒè­˜åˆ¥</span>';

        if (this.continuousInterval) {
          clearInterval(this.continuousInterval);
          this.continuousInterval = null;
        }
      }

      // é€£çºŒè­˜åˆ¥å¾ªç’°
      async continuousRecognition(video) {
        if (!this.continuousMode) return;

        try {
          const predictions = await this.model.detect(video);
          this.processRecognitionResults(predictions);
          
          this.continuousInterval = setTimeout(() => this.continuousRecognition(video), 2000);
        } catch (error) {
          console.error('é€£çºŒè­˜åˆ¥éŒ¯èª¤:', error);
          this.continuousInterval = setTimeout(() => this.continuousRecognition(video), 2000);
        }
      }

      // è™•ç†è­˜åˆ¥çµæœ
      processRecognitionResults(predictions) {
        const highConfidenceItems = predictions
          .filter(pred => pred.score > 0.5 && itemNames[pred.class])
          .map(pred => ({
            class: pred.class,
            name: itemNames[pred.class],
            confidence: pred.score,
            category: itemCategories[pred.class]
          }))
          .filter((item, index, array) => 
            array.findIndex(i => i.class === item.class) === index
          )
          .sort((a, b) => b.confidence - a.confidence)
          .slice(0, 8);

        this.lastItems = highConfidenceItems;
        this.filterDisplayedItems();
        this.provideItemVoiceGuidance(highConfidenceItems);
      }

      // æ›´æ–°ç‰©å“é¡¯ç¤º
      updateItemsDisplay(items) {
        const container = document.getElementById('itemsContainer');
        document.getElementById('itemCount').textContent = items.length;

        if (items.length === 0) {
          container.innerHTML = `
            <div class="item-card" style="background: rgba(255,255,255,0.1); color: var(--muted); grid-column: 1/-1;">
              <div class="item-name">æœªè­˜åˆ¥åˆ°ç‰©å“</div>
              <div class="item-confidence">è«‹èª¿æ•´é¡é ­æ–¹å‘æˆ–å˜—è©¦å…¶ä»–åˆ†é¡</div>
            </div>
          `;
          return;
        }

        container.innerHTML = items.map((item, index) => `
          <div class="item-card highlight" style="animation-delay: ${index * 0.1}s">
            <div class="item-name">${item.name}</div>
            <div class="item-confidence">å¯ä¿¡åº¦: ${Math.round(item.confidence * 100)}%</div>
            <div class="category-tag">${item.category}</div>
          </div>
        `).join('');
      }

      // æä¾›ç‰©å“èªéŸ³æç¤º
      provideItemVoiceGuidance(items) {
        const now = Date.now();
        if (now - this.lastSpeechTime < this.SPEECH_COOLDOWN || items.length === 0) return;

        const topItems = items.slice(0, 3);
        const itemNames = topItems.map(item => item.name).join('ã€');
        
        if (this.continuousMode) {
          if (Math.random() < 0.3) {
            updateVoice(`çœ‹åˆ°ï¼š${itemNames}`);
            this.lastSpeechTime = now;
          }
        } else {
          updateVoice(`çœ‹åˆ°ï¼š${itemNames}`);
          this.lastSpeechTime = now;
        }
      }

      // è¨­å®šå®¶çš„ä½ç½®
      async setHomeLocation() {
        return new Promise((resolve, reject) => {
          if (!navigator.geolocation) {
            reject('æ‚¨çš„è£ç½®ä¸æ”¯æ´å®šä½åŠŸèƒ½');
            return;
          }

          updateVoice('æ­£åœ¨è¨˜éŒ„å®¶çš„ä½ç½®...');
          
          navigator.geolocation.getCurrentPosition(
            (position) => {
              this.homeLocation = {
                latitude: position.coords.latitude,
                longitude: position.coords.longitude,
                accuracy: position.coords.accuracy
              };
              
              localStorage.setItem('homeLocation', JSON.stringify(this.homeLocation));
              updateVoice('å®¶çš„ä½ç½®å·²æˆåŠŸè¨˜éŒ„ï¼');
              document.getElementById('homeStatus').textContent = 'å·²è¨­å®š';
              resolve(this.homeLocation);
            },
            (error) => {
              const errorMsg = this.getGeolocationError(error);
              reject(errorMsg);
            }
          );
        });
      }

      // é–‹å§‹å°èˆªå›å®¶
      startNavigationHome() {
        if (!this.homeLocation) {
          updateVoice('è«‹å…ˆè¨­å®šå®¶çš„ä½ç½®');
          showError('è«‹å…ˆé»æ“Šã€Œè¨­å®šå®¶çš„ä½ç½®ã€è¨­å®šå›å®¶ç›®çš„åœ°');
          return;
        }

        this.isNavigating = true;
        this.updateModeIndicator('navigating');
        updateVoice('é–‹å§‹å°èˆªå›å®¶ï¼Œè«‹è·Ÿéš¨èªéŸ³æŒ‡å¼•');
        document.getElementById('navigationPanel').style.display = 'block';
        document.getElementById('navigationStatus').textContent = 'å°èˆªä¸­';

        this.generateNavigationRoute();
        this.startNavigationCycle();
      }

      // ç”Ÿæˆæ¨¡æ“¬å°èˆªè·¯ç·š
      generateNavigationRoute() {
        this.navigationSteps = [
          { type: 'start', instruction: 'é–‹å§‹å°èˆªï¼Œè«‹ç›´è¡Œ50å…¬å°º', distance: 50, direction: 'straight' },
          { type: 'turn', instruction: 'è«‹åœ¨è·¯å£å·¦è½‰', distance: 30, direction: 'left' },
          { type: 'straight', instruction: 'ç›´è¡Œ100å…¬å°º', distance: 100, direction: 'straight' },
          { type: 'turn', instruction: 'è«‹åœ¨ç´…ç¶ ç‡ˆå³è½‰', distance: 20, direction: 'right' },
          { type: 'straight', instruction: 'ç›´è¡Œ80å…¬å°º', distance: 80, direction: 'straight' },
          { type: 'arrive', instruction: 'å·²åˆ°é”ç›®çš„åœ°', distance: 0, direction: 'arrive' }
        ];
        this.currentStep = 0;
      }

      // é–‹å§‹å°èˆªå¾ªç’°
      startNavigationCycle() {
        if (!this.isNavigating) return;

        const currentStep = this.navigationSteps[this.currentStep];
        if (!currentStep) {
          this.stopNavigation();
          return;
        }

        this.updateNavigationDisplay(currentStep);
        this.provideRoadSafetyInfo();

        setTimeout(() => {
          this.currentStep++;
          if (this.currentStep < this.navigationSteps.length) {
            this.startNavigationCycle();
          } else {
            this.stopNavigation();
          }
        }, 5000);
      }

      // æ›´æ–°å°èˆªé¡¯ç¤º
      updateNavigationDisplay(step) {
        const { instruction, distance, direction } = step;
        
        document.getElementById('distanceDisplay').textContent = distance + ' å…¬å°º';
        document.getElementById('turnInstruction').textContent = instruction;
        
        const arrows = {
          'straight': 'â†‘',
          'left': 'â†°',
          'right': 'â†±',
          'arrive': 'ğŸ '
        };
        document.getElementById('directionArrow').textContent = arrows[direction] || 'â†‘';
        
        updateVoice(instruction);
      }

      // æä¾›é“è·¯å®‰å…¨è³‡è¨Š
      provideRoadSafetyInfo() {
        const roadConditions = [
          'é“è·¯æš¢é€šï¼Œå®‰å…¨é€šé“å¯ç”¨',
          'æ³¨æ„å‰æ–¹äººè¡Œé“',
          'åµæ¸¬åˆ°æ–‘é¦¬ç·šï¼Œè«‹å°å¿ƒé€šé',
          'å®‰å…¨é€šé“è¾¨è­˜æ­£å¸¸',
          'å»ºè­°ä½¿ç”¨å³å´äººè¡Œé“'
        ];
        
        const randomCondition = roadConditions[Math.floor(Math.random() * roadConditions.length)];
        document.getElementById('roadInfo').textContent = randomCondition;
        
        if (Math.random() < 0.3) {
          document.getElementById('safetyAlert').style.display = 'block';
          document.getElementById('safetyAlert').textContent = 'æ³¨æ„å‰æ–¹æœ‰éšœç¤™ç‰©ï¼Œè«‹å°å¿ƒè¡Œèµ°';
          updateVoice('æ³¨æ„å‰æ–¹å®‰å…¨ï¼');
        } else {
          document.getElementById('safetyAlert').style.display = 'none';
        }
      }

      // åœæ­¢å°èˆª
      stopNavigation() {
        this.isNavigating = false;
        this.updateModeIndicator('idle');
        updateVoice('å°èˆªå·²çµæŸ');
        document.getElementById('navigationStatus').textContent = 'å·²çµæŸ';
        
        setTimeout(() => {
          document.getElementById('navigationPanel').style.display = 'none';
        }, 3000);
      }

      // é–‹å•ŸGoogle Mapså°èˆª
      openGoogleMapsNavigation() {
        if (!this.homeLocation) {
          showError('è«‹å…ˆè¨­å®šå®¶çš„ä½ç½®');
          return;
        }

        const { latitude, longitude } = this.homeLocation;
        const mapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${latitude},${longitude}&travelmode=walking`;
        
        updateVoice('æ­£åœ¨é–‹å•ŸGoogleåœ°åœ–å°èˆª');
        window.open(mapsUrl, '_blank');
      }

      // æä¾›è½‰å‘æŒ‡ç¤º
      provideTurnInstruction(direction) {
        const instructions = {
          'left': { text: 'è«‹å·¦è½‰', arrow: 'â†°', voice: 'è«‹åœ¨è·¯å£å·¦è½‰' },
          'right': { text: 'è«‹å³è½‰', arrow: 'â†±', voice: 'è«‹åœ¨è·¯å£å³è½‰' },
          'straight': { text: 'è«‹ç›´è¡Œ', arrow: 'â†‘', voice: 'è«‹ç¹¼çºŒç›´è¡Œ' },
          'uturn': { text: 'è«‹è¿´è½‰', arrow: 'â†¶', voice: 'è«‹åœ¨å®‰å…¨è™•è¿´è½‰' }
        };
        
        const instruction = instructions[direction];
        if (instruction) {
          document.getElementById('turnInstruction').textContent = instruction.text;
          document.getElementById('directionArrow').textContent = instruction.arrow;
          updateVoice(instruction.voice);
        }
      }

      // è¨­ç½®ç‰©å“è­˜åˆ¥ç›¸æ©Ÿ
      async setupRecognitionCamera() {
        const video = document.getElementById('recognitionVideo');
        try {
          if (recognitionStream) {
            recognitionStream.getTracks().forEach(track => track.stop());
          }
          
          const stream = await navigator.mediaDevices.getUserMedia({
            video: { 
              facingMode: recognitionCameraFacingMode,
              width: { ideal: 640 },
              height: { ideal: 480 }
            }
          });
          
          recognitionStream = stream;
          video.srcObject = stream;
          document.getElementById('recognitionCameraPreview').style.display = 'none';
          
          return new Promise((resolve) => {
            video.onloadedmetadata = () => { 
              video.play();
              resolve(video); 
            };
          });
        } catch (error) {
          updateVoice('ç„¡æ³•é–‹å•Ÿç›¸æ©Ÿ');
          console.error('ç›¸æ©Ÿé–‹å•Ÿå¤±æ•—:', error);
          showError('ç„¡æ³•é–‹å•Ÿç›¸æ©Ÿï¼Œè«‹æª¢æŸ¥æ¬Šé™è¨­å®š');
          return null;
        }
      }

      // æ›´æ–°æ¨¡å¼æŒ‡ç¤ºå™¨
      updateModeIndicator(mode) {
        const indicator = document.getElementById('modeIndicator');
        const modeText = document.getElementById('currentMode');
        
        const modes = {
          'idle': { class: 'mode-idle', text: 'å¾…æ©Ÿä¸­' },
          'identifying': { class: 'mode-identifying', text: 'è­˜åˆ¥ç‰©å“ä¸­' },
          'navigating': { class: 'mode-navigating', text: 'å°èˆªä¸­' },
          'recording': { class: 'mode-recording', text: 'è¨˜éŒ„ä¸­' }
        };

        indicator.className = 'mode-indicator ' + modes[mode].class;
        modeText.textContent = modes[mode].text;
      }

      // è¼‰å…¥å„²å­˜çš„ä½ç½®
      loadSavedLocations() {
        const savedHome = localStorage.getItem('homeLocation');
        if (savedHome) {
          this.homeLocation = JSON.parse(savedHome);
          document.getElementById('homeStatus').textContent = 'å·²è¨­å®š';
        }
      }

      // ç²å–åœ°ç†å®šä½éŒ¯èª¤
      getGeolocationError(error) {
        switch(error.code) {
          case error.PERMISSION_DENIED: return 'è«‹å…è¨±ä½ç½®æ¬Šé™';
          case error.POSITION_UNAVAILABLE: return 'ç„¡æ³•ç²å–ä½ç½®è³‡è¨Š';
          case error.TIMEOUT: return 'å®šä½è¶…æ™‚';
          default: return 'å®šä½æœå‹™éŒ¯èª¤';
        }
      }
    }

    // å…¨åŸŸè®Šæ•¸
    const assistant = new SmartAssistant();
    let voiceEnabled = true;

    // åˆå§‹åŒ–
    function init() {
      assistant.loadSavedLocations();
      document.getElementById('databaseSize').textContent = 
        Object.keys(itemNames).length + '+ ç‰©å“';
      
      updateStatus('æº–å‚™å°±ç·’');
      updateVoice('ç³»çµ±æº–å‚™å®Œæˆï¼Œè«‹é–‹å•Ÿç›¸æ©Ÿé–‹å§‹ä½¿ç”¨');
      initEventListeners();
      initTabSystem();
      
      showDebugInfo('é“è·¯è¾¨è­˜æ¨¡å¼å·²å•Ÿå‹•');
      
      setTimeout(() => {
        assistant.initModel();
      }, 1000);
    }

    // åˆå§‹åŒ–æ¨™ç±¤ç³»çµ±
    function initTabSystem() {
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const tabId = tab.getAttribute('data-tab');
          
          tabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
          });
          document.getElementById(tabId + 'Tab').classList.add('active');
          
          if (tabId === 'navigation') {
            updateVoice('åˆ‡æ›åˆ°å°èˆªæ¨¡å¼');
          } else {
            updateVoice('åˆ‡æ›åˆ°ç‰©å“è­˜åˆ¥æ¨¡å¼');
          }
        });
      });
    }

    // å°èˆªç³»çµ±å‡½æ•¸
    function initEventListeners() {
      document.getElementById('btnCamera').addEventListener('click', setupCamera);
      document.getElementById('btnStart').addEventListener('click', startDetection);
      document.getElementById('btnTest').addEventListener('click', testDetection);
      document.getElementById('btnStop').addEventListener('click', stopDetection);
    }

    // ç›¸æ©Ÿè¨­ç½®
    async function setupCamera() {
      try {
        updateVoice('æ­£åœ¨é–‹å•Ÿç›¸æ©Ÿâ€¦');
        updateCameraStatus('é–‹å•Ÿä¸­');
        
        if (currentStream) {
          currentStream.getTracks().forEach(track => track.stop());
        }
        
        const video = document.getElementById('video');
        const preview = document.getElementById('cameraPreview');
        
        const stream = await navigator.mediaDevices.getUserMedia({
          video: {
            width: { ideal: 640 },
            height: { ideal: 480 },
            facingMode: 'environment'
          },
          audio: false
        });
        
        currentStream = stream;
        video.srcObject = stream;
        
        await new Promise((resolve) => {
          video.onloadedmetadata = () => resolve(video);
        });
        
        await video.play();
        
        preview.style.display = 'none';
        
        document.getElementById('btnStart').disabled = false;
        document.getElementById('btnTest').disabled = false;
        document.getElementById('btnStop').disabled = false;
        
        updateCameraStatus('å·²é–‹å•Ÿ');
        updateVoice('ç›¸æ©Ÿé–‹å•ŸæˆåŠŸï¼å¯ä»¥é–‹å§‹é“è·¯æª¢æ¸¬');
        
        showDebugInfo('ç›¸æ©Ÿé–‹å•ŸæˆåŠŸ - åˆ†è¾¨ç‡: ' + video.videoWidth + 'x' + video.videoHeight);
        
      } catch (error) {
        console.error('ç›¸æ©Ÿé–‹å•Ÿå¤±æ•—:', error);
        updateCameraStatus('é–‹å•Ÿå¤±æ•—');
        
        let errorMsg = 'ç„¡æ³•é–‹å•Ÿç›¸æ©Ÿï¼š';
        if (error.name === 'NotAllowedError') {
          errorMsg += 'è«‹å…è¨±ç›¸æ©Ÿæ¬Šé™';
        } else if (error.name === 'NotFoundError') {
          errorMsg += 'æœªæ‰¾åˆ°ç›¸æ©Ÿè¨­å‚™';
        } else {
          errorMsg += error.message;
        }
        
        updateVoice(errorMsg);
        showError(errorMsg);
      }
    }

    // é–‹å§‹æª¢æ¸¬
    function startDetection() {
      const video = document.getElementById('video');
      if (!video.srcObject) {
        updateVoice('è«‹å…ˆé–‹å•Ÿç›¸æ©Ÿ');
        return;
      }
      
      isDetecting = true;
      updateStatus('æª¢æ¸¬ä¸­');
      updateDetectionStatus('é‹è¡Œä¸­');
      updateVoice('é–‹å§‹é“è·¯èˆ‡éšœç¤™ç‰©æª¢æ¸¬ï¼Œè«‹ç·©æ…¢ç§»å‹•æ‰‹æ©Ÿ');
      
      detectionInterval = setInterval(() => {
        if (!isDetecting) return;
        
        try {
          const obstacles = simulateRoadDetection();
          updateDetectionDisplay(obstacles);
        } catch (error) {
          console.error('æª¢æ¸¬éŒ¯èª¤:', error);
        }
      }, 1000);
    }

    // æ¸¬è©¦æª¢æ¸¬
    function testDetection() {
      updateVoice('åŸ·è¡ŒåŠŸèƒ½æ¸¬è©¦');
      
      const testObstacles = [
        { type: 'æ¸¬è©¦ç‰†å£', distance: 1.2, confidence: '90' },
        { type: 'æ¸¬è©¦æ¤…å­', distance: 2.5, confidence: '85' }
      ];
      
      updateDetectionDisplay(testObstacles);
      updateVoice('åŠŸèƒ½æ¸¬è©¦å®Œæˆï¼Œæª¢æ¸¬åˆ° ' + testObstacles.length + ' å€‹æ¸¬è©¦éšœç¤™ç‰©');
    }

    // æ¨¡æ“¬é“è·¯æª¢æ¸¬
    function simulateRoadDetection() {
      const now = Date.now();
      
      const obstacles = [];
      const roadTypes = ['äººè¡Œé“', 'æ–‘é¦¬ç·š', 'å®‰å…¨é€šé“', 'éšœç¤™ç‰©', 'æ¨“æ¢¯'];
      
      if (Math.random() < 0.5) {
        const distance = (Math.random() * 5 + 0.5).toFixed(1);
        const type = roadTypes[Math.floor(Math.random() * roadTypes.length)];
        
        obstacles.push({
          type: type,
          distance: parseFloat(distance),
          confidence: (Math.random() * 30 + 70).toFixed(0)
        });
      }
      
      if (now - lastDetectionTime > 5000) {
        obstacles.push({
          type: 'æ¸¬è©¦éšœç¤™ç‰©',
          distance: (Math.random() * 1 + 0.5).toFixed(1),
          confidence: '95'
        });
        lastDetectionTime = now;
      }
      
      return obstacles;
    }

    // åœæ­¢æª¢æ¸¬
    function stopDetection() {
      isDetecting = false;
      if (detectionInterval) {
        clearInterval(detectionInterval);
        detectionInterval = null;
      }
      updateStatus('å·²åœæ­¢');
      updateDetectionStatus('å·²åœæ­¢');
      updateVoice('æª¢æ¸¬å·²åœæ­¢');
      clearDetectionDisplay();
    }

    // æ›´æ–°æª¢æ¸¬é¡¯ç¤º
    function updateDetectionDisplay(obstacles) {
      const list = document.getElementById('detectionList');
      
      if (obstacles.length === 0) {
        list.innerHTML = '<div class="detection-item" style="text-align:center; color:var(--muted);">é“è·¯ç’°å¢ƒå®‰å…¨</div>';
        return;
      }
      
      list.innerHTML = obstacles.map(obs => `
        <div class="detection-item" style="border-left: 4px solid ${obs.type === 'éšœç¤™ç‰©' ? 'var(--bad)' : obs.type === 'æ¨“æ¢¯' ? 'var(--warn)' : 'var(--good)'}">
          <strong>${obs.type}</strong><br>
          è·é›¢: ${obs.distance}å…¬å°º | ç½®ä¿¡åº¦: ${obs.confidence}%
        </div>
      `).join('');
      
      const closest = obstacles[0];
      if (closest.distance < 1.0) {
        updateVoice(`ç·Šæ€¥åœæ­¢ï¼${closest.type}éå¸¸æ¥è¿‘ï¼Œåƒ…${closest.distance}å…¬å°º`);
      } else if (closest.distance < 2.0) {
        updateVoice(`æ³¨æ„ï¼${closest.type}æ¥è¿‘ï¼Œè·é›¢${closest.distance}å…¬å°º`);
      }
      
      showDebugInfo(`æª¢æ¸¬åˆ° ${obstacles.length} å€‹éšœç¤™ç‰©ï¼Œæœ€è¿‘: ${closest.distance}å…¬å°º`);
    }

    function clearDetectionDisplay() {
      const list = document.getElementById('detectionList');
      list.innerHTML = '<div class="detection-item" style="text-align:center; color:var(--muted);">æª¢æ¸¬å·²åœæ­¢</div>';
    }

    // å°èˆªç›¸é—œå‡½æ•¸
    function startNavigationHome() {
      assistant.startNavigationHome();
    }

    function openGoogleMaps() {
      assistant.openGoogleMapsNavigation();
    }

    function simulateTurn(direction) {
      assistant.provideTurnInstruction(direction);
    }

    function setHomeLocation() {
      assistant.setHomeLocation().catch(error => {
        updateVoice(error);
        showError(error);
      });
    }

    // åˆ‡æ›ç‰©å“è­˜åˆ¥ç›¸æ©Ÿ
    function switchRecognitionCamera() {
      recognitionCameraFacingMode = recognitionCameraFacingMode === 'environment' ? 'user' : 'environment';
      updateVoice(`åˆ‡æ›åˆ°${recognitionCameraFacingMode === 'environment' ? 'å¾Œç½®' : 'å‰ç½®'}é¡é ­`);
      
      if (recognitionStream) {
        recognitionStream.getTracks().forEach(track => track.stop());
        recognitionStream = null;
      }
      
      document.getElementById('recognitionCameraPreview').style.display = 'flex';
      document.getElementById('recognitionCameraPreview').innerHTML = `
        <div>
          <div style="font-size:48px; margin-bottom:10px;">ğŸ”„</div>
          <div>æ­£åœ¨åˆ‡æ›é¡é ­...</div>
        </div>
      `;
      
      setTimeout(() => {
        assistant.setupRecognitionCamera();
      }, 500);
    }

    // å·¥å…·å‡½æ•¸
    function updateVoice(message) {
      const voiceAlert = document.getElementById('voiceAlert');
      voiceAlert.textContent = message;
      
      voiceAlert.classList.remove('loading');
      
      if (voiceEnabled && window.speechSynthesis) {
        try {
          window.speechSynthesis.cancel();
          const utterance = new SpeechSynthesisUtterance(message);
          utterance.lang = 'zh-TW';
          utterance.rate = 0.9;
          utterance.volume = 1.0;
          window.speechSynthesis.speak(utterance);
        } catch (error) {
          console.log('èªéŸ³åˆæˆéŒ¯èª¤:', error);
        }
      }
    }

    function updateStatus(status) {
      document.getElementById('status').textContent = status;
    }

    function updateCameraStatus(status) {
      document.getElementById('cameraStatus').textContent = status;
    }

    function updateDetectionStatus(status) {
      document.getElementById('detectionStatus').textContent = status;
    }

    function showDebugInfo(message) {
      const debugElement = document.getElementById('debugInfo');
      debugElement.textContent = 'é™¤éŒ¯: ' + message;
      debugElement.style.display = 'block';
      console.log(message);
    }

    function showError(message) {
      const errorElement = document.getElementById('errorMessage');
      errorElement.textContent = message;
      errorElement.style.display = 'block';
    }

    function hideError() {
      const errorElement = document.getElementById('errorMessage');
      errorElement.style.display = 'none';
    }

    function showModelProgress(message, percent) {
      const progressElement = document.getElementById('modelProgress');
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      
      progressElement.style.display = 'block';
      progressFill.style.width = percent + '%';
      progressText.textContent = percent + '% - ' + message;
    }

    function hideModelProgress() {
      const progressElement = document.getElementById('modelProgress');
      progressElement.style.display = 'none';
    }

    // åŒ…è£å‡½æ•¸
    function startItemRecognition() {
      assistant.startItemRecognition();
    }

    function toggleContinuousMode() {
      assistant.toggleContinuousMode();
    }

    function toggleVoice() {
      voiceEnabled = !voiceEnabled;
      const button = document.getElementById('voiceToggleBtn');
      if (voiceEnabled) {
        button.innerHTML = '<span>ğŸ”‡</span><span>é—œé–‰èªéŸ³</span>';
        updateVoice('èªéŸ³æç¤ºå·²é–‹å•Ÿ');
      } else {
        button.innerHTML = '<span>ğŸ”Š</span><span>é–‹å•ŸèªéŸ³</span>';
        window.speechSynthesis.cancel();
      }
    }

    function repeatInstruction() {
      const voiceAlert = document.getElementById('voiceAlert');
      if (voiceAlert.textContent && voiceEnabled) {
        updateVoice(voiceAlert.textContent);
      }
    }

    function filterItems() {
      assistant.filterDisplayedItems();
    }

    // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>