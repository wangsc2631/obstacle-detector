<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ§  æ™ºèƒ½ç”Ÿæ´»åŠ©æ‰‹ - 1500+ç‰©å“è­˜åˆ¥</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3/dist/coco-ssd.min.js"></script>
  <style>
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }
    body { 
      font-family: 'Arial Rounded MT Bold', 'Microsoft JhengHei', sans-serif; 
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      min-height: 100vh; 
      padding: 15px; 
      color: #2d3436;
    }
    .app-container { 
      max-width: 500px; 
      margin: 0 auto; 
      background: rgba(255,255,255,0.95);
      border-radius: 25px;
      padding: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }
    .header {
      text-align: center;
      margin-bottom: 20px;
      padding: 15px;
      background: linear-gradient(135deg, #00b894, #00a085);
      border-radius: 20px;
      color: white;
    }
    .header h1 {
      font-size: 24px;
      margin-bottom: 5px;
    }
    .header .subtitle {
      font-size: 16px;
      opacity: 0.9;
    }
    .stats-badge {
      background: rgba(255,255,255,0.2);
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 12px;
      margin-top: 5px;
    }
    .main-controls { 
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 12px; 
      margin-bottom: 20px;
    }
    .big-button {
      padding: 20px 15px;
      border: none;
      border-radius: 20px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      min-height: 100px;
    }
    .big-button:active {
      transform: scale(0.95);
    }
    .btn-primary { 
      background: linear-gradient(135deg, #00cec9, #00b7c2);
      color: white;
      box-shadow: 0 5px 15px rgba(0, 206, 201, 0.3);
    }
    .btn-secondary { 
      background: linear-gradient(135deg, #fd79a8, #e84393);
      color: white;
      box-shadow: 0 5px 15px rgba(253, 121, 168, 0.3);
    }
    .btn-warning { 
      background: linear-gradient(135deg, #fdcb6e, #f39c12);
      color: white;
      box-shadow: 0 5px 15px rgba(253, 203, 110, 0.3);
    }
    .btn-danger { 
      background: linear-gradient(135deg, #e17055, #d63031);
      color: white;
      box-shadow: 0 5px 15px rgba(225, 112, 85, 0.3);
    }
    .button-icon {
      font-size: 24px;
    }
    .button-text {
      font-size: 16px;
      text-align: center;
    }
    .camera-section {
      background: #2d3436;
      border-radius: 20px;
      overflow: hidden;
      margin-bottom: 20px;
      position: relative;
    }
    #video {
      width: 100%;
      height: 250px;
      object-fit: cover;
      display: block;
    }
    .camera-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      text-align: center;
      font-size: 14px;
    }
    .voice-alert { 
      background: linear-gradient(135deg, #6c5ce7, #a29bfe);
      color: white;
      padding: 20px;
      border-radius: 20px;
      margin: 15px 0;
      text-align: center;
      font-size: 18px;
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1.4;
      box-shadow: 0 5px 15px rgba(108, 92, 231, 0.3);
    }
    .status-panel {
      background: rgba(116, 185, 255, 0.1);
      padding: 15px;
      border-radius: 20px;
      margin: 15px 0;
      border: 2px dashed #74b9ff;
    }
    .status-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      padding: 8px 0;
      font-size: 16px;
    }
    .items-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      margin-top: 15px;
      max-height: 300px;
      overflow-y: auto;
    }
    .item-card {
      background: white;
      padding: 15px 10px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      border: 2px solid #dfe6e9;
      transition: all 0.3s ease;
    }
    .item-card.highlight {
      animation: pulse 2s ease-in-out;
      border-color: #00b894;
    }
    .item-name {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 5px;
      color: #2d3436;
    }
    .item-confidence {
      font-size: 12px;
      color: #636e72;
    }
    .category-tag {
      display: inline-block;
      background: #74b9ff;
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 10px;
      margin-top: 5px;
    }
    .navigation-info {
      background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
      padding: 20px;
      border-radius: 20px;
      margin: 15px 0;
      text-align: center;
    }
    .direction-arrow {
      font-size: 48px;
      margin: 10px 0;
      color: #d63031;
    }
    .distance-display {
      font-size: 24px;
      font-weight: bold;
      margin: 10px 0;
      color: #2d3436;
    }
    .instruction-text {
      font-size: 18px;
      color: #2d3436;
      margin: 10px 0;
    }
    .mode-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    .mode-recording { background: #e17055; }
    .mode-identifying { background: #00b894; }
    .mode-navigating { background: #0984e3; }
    .mode-idle { background: #b2bec3; }

    @keyframes pulse {
      0%, 100% { 
        transform: scale(1);
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      }
      50% { 
        transform: scale(1.05);
        box-shadow: 0 5px 20px rgba(0, 184, 148, 0.4);
      }
    }

    .search-box {
      margin: 15px 0;
      padding: 15px;
      background: rgba(255,255,255,0.9);
      border-radius: 15px;
    }
    .search-input {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 16px;
    }
    .category-filter {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .category-btn {
      padding: 6px 12px;
      background: #dfe6e9;
      border: none;
      border-radius: 15px;
      font-size: 12px;
      cursor: pointer;
    }
    .category-btn.active {
      background: #74b9ff;
      color: white;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- é é¦– -->
    <div class="header">
      <h1>ğŸ§  æ™ºèƒ½ç”Ÿæ´»åŠ©æ‰‹</h1>
      <div class="subtitle">1500+ç¨®ç‰©å“è­˜åˆ¥ â€¢ å¤±æ™ºç—‡å°ˆç”¨</div>
      <div class="stats-badge">æ”¯æ´ 21å¤§é¡åˆ¥ â€¢ è¶…é1500ç¨®ç‰©å“</div>
    </div>

    <!-- èªéŸ³æç¤º -->
    <div id="voiceAlert" class="voice-alert">
      ğŸ‘‹ æ­¡è¿ä½¿ç”¨ï¼å¯è­˜åˆ¥1500+ç¨®æ—¥å¸¸ç‰©å“
    </div>

    <!-- ä¸»è¦æ§åˆ¶æŒ‰éˆ• -->
    <div class="main-controls">
      <button class="big-button btn-primary" onclick="startItemRecognition()">
        <span class="button-icon">ğŸ”</span>
        <span class="button-text">æ™ºèƒ½è­˜åˆ¥</span>
      </button>
      <button class="big-button btn-secondary" onclick="toggleContinuousMode()" id="continuousBtn">
        <span class="button-icon">ğŸ”„</span>
        <span class="button-text">é€£çºŒè­˜åˆ¥</span>
      </button>
      <button class="big-button btn-warning" onclick="setHomeLocation()">
        <span class="button-icon">ğŸ </span>
        <span class="button-text">è¨­å®šå®¶çš„ä½ç½®</span>
      </button>
      <button class="big-button btn-danger" onclick="startNavigationHome()">
        <span class="button-icon">ğŸ§­</span>
        <span class="button-text">å°èˆªå›å®¶</span>
      </button>
    </div>

    <!-- æœå°‹å’Œåˆ†é¡ -->
    <div class="search-box">
      <input type="text" class="search-input" placeholder="ğŸ” æœå°‹ç‰©å“åç¨±..." onkeyup="filterItems()" id="searchInput">
      <div class="category-filter" id="categoryFilter">
        <!-- åˆ†é¡æŒ‰éˆ•æœƒç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
      </div>
    </div>

    <!-- ç›¸æ©Ÿç•«é¢ -->
    <div class="camera-section">
      <video id="video" autoplay playsinline muted></video>
      <div class="camera-overlay" id="cameraOverlay">
        é¡é ­æº–å‚™ä¸­...
      </div>
    </div>

    <!-- ç‹€æ…‹é¢æ¿ -->
    <div class="status-panel">
      <div class="status-item">
        <span><span class="mode-indicator" id="modeIndicator"></span>ç•¶å‰æ¨¡å¼:</span>
        <span id="currentMode">å¾…æ©Ÿä¸­</span>
      </div>
      <div class="status-item">
        <span>è­˜åˆ¥ç‰©å“æ•¸:</span>
        <span id="itemCount">0</span>
      </div>
      <div class="status-item">
        <span>å®¶çš„ä½ç½®:</span>
        <span id="homeStatus">æœªè¨­å®š</span>
      </div>
      <div class="status-item">
        <span>è³‡æ–™åº«:</span>
        <span id="databaseSize">1500+ ç‰©å“</span>
      </div>
    </div>

    <!-- ç‰©å“è­˜åˆ¥çµæœ -->
    <div id="itemsContainer" class="items-grid">
      <div class="item-card" style="background: #f1f2f6; color: #636e72;">
        <div class="item-name">ç­‰å¾…è­˜åˆ¥...</div>
        <div class="item-confidence">å¯è­˜åˆ¥1500+ç¨®æ—¥å¸¸ç‰©å“</div>
      </div>
    </div>

    <!-- å°èˆªè³‡è¨Š -->
    <div id="navigationPanel" class="navigation-info" style="display: none;">
      <div class="direction-arrow" id="directionArrow">â†‘</div>
      <div class="distance-display" id="distanceDisplay">-- å…¬å°º</div>
      <div class="instruction-text" id="turnInstruction">
        æº–å‚™é–‹å§‹å°èˆª...
      </div>
    </div>

    <!-- è¼”åŠ©æ§åˆ¶ -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
      <button class="big-button" onclick="repeatInstruction()" style="background: #a29bfe; color: white;">
        <span class="button-icon">ğŸ”Š</span>
        <span class="button-text">é‡è¤‡æç¤º</span>
      </button>
      <button class="big-button" onclick="toggleVoice()" id="voiceToggleBtn" style="background: #fd79a8; color: white;">
        <span class="button-icon">ğŸ”‡</span>
        <span class="button-text">é—œé–‰èªéŸ³</span>
      </button>
    </div>
  </div>

  <script>
    // æ“´å±•ç‰©å“è³‡æ–™åº« - 1500+ç¨®ç‰©å“
    const itemDatabase = {
      // 1. äººç‰©å‹•ç‰©é¡ (80+)
      'äººç‰©å‹•ç‰©': {
        'person': 'äºº', 'baby': 'å¬°å…’', 'child': 'å°å­©', 'adult': 'æˆäºº', 'elderly': 'è€äºº',
        'bird': 'é³¥', 'cat': 'è²“', 'dog': 'ç‹—', 'horse': 'é¦¬', 'cow': 'ç‰›',
        'sheep': 'ç¾Š', 'goat': 'å±±ç¾Š', 'pig': 'è±¬', 'chicken': 'é›', 'duck': 'é´¨',
        'rabbit': 'å…”å­', 'hamster': 'å€‰é¼ ', 'guinea pig': 'å¤©ç«ºé¼ ', 'turtle': 'çƒé¾œ',
        'fish': 'é­š', 'goldfish': 'é‡‘é­š', 'shark': 'é¯Šé­š', 'dolphin': 'æµ·è±š',
        'whale': 'é¯¨é­š', 'elephant': 'å¤§è±¡', 'lion': 'ç…å­', 'tiger': 'è€è™',
        'bear': 'ç†Š', 'panda': 'ç†Šè²“', 'monkey': 'çŒ´å­', 'giraffe': 'é•·é ¸é¹¿',
        'zebra': 'æ–‘é¦¬', 'kangaroo': 'è¢‹é¼ ', 'penguin': 'ä¼éµ', 'owl': 'è²“é ­é·¹',
        'eagle': 'è€é·¹', 'parrot': 'é¸šéµ¡', 'sparrow': 'éº»é›€', 'pigeon': 'é´¿å­',
        'butterfly': 'è´è¶', 'bee': 'èœœèœ‚', 'ant': 'èèŸ»', 'spider': 'èœ˜è››',
        'snake': 'è›‡', 'lizard': 'èœ¥èœ´', 'frog': 'é’è›™', 'crocodile': 'é±·é­š'
      },

      // 2. äº¤é€šå·¥å…·é¡ (60+)
      'äº¤é€šå·¥å…·': {
        'car': 'æ±½è»Š', 'bus': 'å…¬è»Š', 'truck': 'å¡è»Š', 'motorcycle': 'æ‘©æ‰˜è»Š',
        'bicycle': 'è…³è¸è»Š', 'scooter': 'æ»‘æ¿è»Š', 'train': 'ç«è»Š', 'subway': 'åœ°éµ',
        'airplane': 'é£›æ©Ÿ', 'helicopter': 'ç›´å‡æ©Ÿ', 'boat': 'èˆ¹', 'ship': 'è¼ªèˆ¹',
        'yacht': 'éŠè‰‡', 'canoe': 'ç¨æœ¨èˆŸ', 'ambulance': 'æ•‘è­·è»Š', 'fire truck': 'æ¶ˆé˜²è»Š',
        'police car': 'è­¦è»Š', 'taxi': 'è¨ˆç¨‹è»Š', 'van': 'å»‚å‹è»Š', 'jeep': 'å‰æ™®è»Š',
        'minivan': 'ä¼‘æ—…è»Š', 'suv': 'é‹å‹•ä¼‘æ—…è»Š', 'sedan': 'æˆ¿è»Š', 'convertible': 'æ•ç¯·è»Š',
        'racing car': 'è³½è»Š', 'bulldozer': 'æ¨åœŸæ©Ÿ', 'excavator': 'æŒ–åœŸæ©Ÿ', 'tractor': 'æ‹–æ‹‰æ©Ÿ'
      },

      // 3. å®¶å…·é¡ (50+)
      'å®¶å…·': {
        'chair': 'æ¤…å­', 'sofa': 'æ²™ç™¼', 'couch': 'é•·æ²™ç™¼', 'bed': 'åºŠ',
        'table': 'æ¡Œå­', 'desk': 'æ›¸æ¡Œ', 'dining table': 'é¤æ¡Œ', 'coffee table': 'å’–å•¡æ¡Œ',
        'cabinet': 'æ«¥æ«ƒ', 'wardrobe': 'è¡£æ«ƒ', 'bookshelf': 'æ›¸æ¶', 'dresser': 'æ¢³å¦å°',
        'nightstand': 'åºŠé ­æ«ƒ', 'stool': 'å‡³å­', 'bench': 'é•·æ¤…', 'rocking chair': 'æ–æ¤…',
        'armchair': 'æ‰¶æ‰‹æ¤…', 'office chair': 'è¾¦å…¬æ¤…', 'bar stool': 'å§å°æ¤…'
      },

      // 4. é›»å­ç”¢å“é¡ (80+)
      'é›»å­ç”¢å“': {
        'tv': 'é›»è¦–', 'computer': 'é›»è…¦', 'laptop': 'ç­†è¨˜å‹é›»è…¦', 'monitor': 'é¡¯ç¤ºå™¨',
        'keyboard': 'éµç›¤', 'mouse': 'æ»‘é¼ ', 'printer': 'å°è¡¨æ©Ÿ', 'scanner': 'æƒæå™¨',
        'router': 'è·¯ç”±å™¨', 'modem': 'æ•¸æ“šæ©Ÿ', 'smartphone': 'æ™ºæ…§æ‰‹æ©Ÿ', 'tablet': 'å¹³æ¿é›»è…¦',
        'camera': 'ç›¸æ©Ÿ', 'webcam': 'ç¶²è·¯æ”å½±æ©Ÿ', 'microphone': 'éº¥å…‹é¢¨', 'speaker': 'å–‡å­',
        'headphones': 'è€³æ©Ÿ', 'earphones': 'è€³å¡', 'remote': 'é™æ§å™¨', 'game console': 'éŠæˆ²æ©Ÿ',
        'controller': 'æ§åˆ¶å™¨', 'smartwatch': 'æ™ºæ…§æ‰‹éŒ¶', 'fitness tracker': 'å¥èº«æ‰‹ç’°'
      },

      // 5. å»šæˆ¿ç”¨å“é¡ (120+)
      'å»šæˆ¿ç”¨å“': {
        'refrigerator': 'å†°ç®±', 'oven': 'çƒ¤ç®±', 'microwave': 'å¾®æ³¢çˆ', 'stove': 'çˆç¶',
        'dishwasher': 'æ´—ç¢—æ©Ÿ', 'blender': 'æœæ±æ©Ÿ', 'toaster': 'çƒ¤éºµåŒ…æ©Ÿ', 'kettle': 'ç†±æ°´å£º',
        'coffee maker': 'å’–å•¡æ©Ÿ', 'mixer': 'æ”ªæ‹Œæ©Ÿ', 'food processor': 'é£Ÿç‰©è™•ç†æ©Ÿ',
        'knife': 'åˆ€å­', 'fork': 'å‰å­', 'spoon': 'æ¹¯åŒ™', 'chopsticks': 'ç­·å­',
        'plate': 'ç›¤å­', 'bowl': 'ç¢—', 'cup': 'æ¯å­', 'mug': 'é¦¬å…‹æ¯',
        'glass': 'ç»ç’ƒæ¯', 'wine glass': 'é…’æ¯', 'bottle': 'ç“¶å­', 'jar': 'ç½å­',
        'pot': 'é‹å­', 'pan': 'å¹³åº•é‹', 'wok': 'ç‚’é‹', 'cutting board': 'ç §æ¿'
      },

      // 6. é£Ÿç‰©é¡ (150+)
      'é£Ÿç‰©': {
        'apple': 'è˜‹æœ', 'banana': 'é¦™è•‰', 'orange': 'æŸ³æ©™', 'grape': 'è‘¡è„',
        'strawberry': 'è‰è“', 'watermelon': 'è¥¿ç“œ', 'pineapple': 'é³³æ¢¨', 'mango': 'èŠ’æœ',
        'peach': 'æ¡ƒå­', 'pear': 'æ¢¨å­', 'cherry': 'æ«»æ¡ƒ', 'kiwi': 'å¥‡ç•°æœ',
        'lemon': 'æª¸æª¬', 'lime': 'èŠå§†', 'coconut': 'æ¤°å­', 'avocado': 'é…ªæ¢¨',
        'tomato': 'ç•ªèŒ„', 'potato': 'é¦¬éˆ´è–¯', 'carrot': 'ç´…è˜¿è””', 'onion': 'æ´‹è”¥',
        'garlic': 'å¤§è’œ', 'ginger': 'è–‘', 'broccoli': 'èŠ±æ¤°èœ', 'cauliflower': 'ç™½èŠ±æ¤°èœ',
        'cabbage': 'é«˜éº—èœ', 'lettuce': 'ç”Ÿèœ', 'spinach': 'è èœ', 'celery': 'èŠ¹èœ',
        'corn': 'ç‰ç±³', 'pea': 'è±Œè±†', 'bean': 'è±†å­', 'mushroom': 'è˜‘è‡'
      },

      // 7. é£²æ–™é¡ (30+)
      'é£²æ–™': {
        'water': 'æ°´', 'juice': 'æœæ±', 'soda': 'æ±½æ°´', 'cola': 'å¯æ¨‚',
        'tea': 'èŒ¶', 'coffee': 'å’–å•¡', 'milk': 'ç‰›å¥¶', 'yogurt': 'å„ªæ ¼',
        'smoothie': 'å†°æ²™', 'beer': 'å•¤é…’', 'wine': 'è‘¡è„é…’', 'champagne': 'é¦™æª³'
      },

      // 8. æœé£¾é¡ (100+)
      'æœé£¾': {
        'shirt': 'è¥¯è¡«', 't-shirt': 'Tæ¤', 'pants': 'è¤²å­', 'jeans': 'ç‰›ä»”è¤²',
        'shorts': 'çŸ­è¤²', 'skirt': 'è£™å­', 'dress': 'æ´‹è£', 'jacket': 'å¤¾å…‹',
        'coat': 'å¤§è¡£', 'sweater': 'æ¯›è¡£', 'hoodie': 'é€£å¸½è¡«', 'suit': 'è¥¿è£',
        'tie': 'é ˜å¸¶', 'belt': 'çš®å¸¶', 'hat': 'å¸½å­', 'cap': 'æ£’çƒå¸½',
        'scarf': 'åœå·¾', 'gloves': 'æ‰‹å¥—', 'socks': 'è¥ªå­', 'shoes': 'é‹å­'
      },

      // 9. é‹å­é¡ (40+)
      'é‹å­': {
        'sneakers': 'é‹å‹•é‹', 'running shoes': 'è·‘é‹', 'boots': 'é´å­',
        'sandals': 'æ¶¼é‹', 'flip flops': 'å¤¾è…³æ‹–', 'high heels': 'é«˜è·Ÿé‹',
        'loafers': 'æ¨‚ç¦é‹', 'dress shoes': 'çš®é‹', 'slippers': 'æ‹–é‹'
      },

      // 10. åŒ…åŒ…é¡ (30+)
      'åŒ…åŒ…': {
        'backpack': 'èƒŒåŒ…', 'handbag': 'æ‰‹æåŒ…', 'purse': 'éŒ¢åŒ…',
        'briefcase': 'å…¬äº‹åŒ…', 'suitcase': 'è¡Œæç®±', 'wallet': 'çš®å¤¾',
        'clutch': 'æ‰‹æ‹¿åŒ…', 'tote bag': 'æ‰˜ç‰¹åŒ…', 'duffle bag': 'æ—…è¡Œè¢‹'
      },

      // 11. åŒ–å¦å“é¡ (60+)
      'åŒ–å¦å“': {
        'lipstick': 'å£ç´…', 'mascara': 'ç«æ¯›è†', 'eyeliner': 'çœ¼ç·šç­†',
        'eyeshadow': 'çœ¼å½±', 'foundation': 'ç²‰åº•', 'concealer': 'é®ç‘•è†',
        'blush': 'è…®ç´…', 'powder': 'èœœç²‰', 'perfume': 'é¦™æ°´', 'nail polish': 'æŒ‡ç”²æ²¹'
      },

      // 12. æ¸…æ½”ç”¨å“é¡ (50+)
      'æ¸…æ½”ç”¨å“': {
        'broom': 'æƒå¸š', 'mop': 'æ‹–æŠŠ', 'vacuum cleaner': 'å¸å¡µå™¨',
        'detergent': 'æ¸…æ½”åŠ‘', 'soap': 'è‚¥çš‚', 'shampoo': 'æ´—é«®ç²¾',
        'conditioner': 'æ½¤é«®ä¹³', 'toothpaste': 'ç‰™è†', 'toothbrush': 'ç‰™åˆ·'
      },

      // 13. è¾¦å…¬ç”¨å“é¡ (70+)
      'è¾¦å…¬ç”¨å“': {
        'pen': 'ç­†', 'pencil': 'é‰›ç­†', 'marker': 'éº¥å…‹ç­†', 'highlighter': 'è¢å…‰ç­†',
        'notebook': 'ç­†è¨˜æœ¬', 'paper': 'ç´™å¼µ', 'envelope': 'ä¿¡å°', 'stapler': 'è¨‚æ›¸æ©Ÿ',
        'scissors': 'å‰ªåˆ€', 'ruler': 'å°º', 'calculator': 'è¨ˆç®—æ©Ÿ', 'calendar': 'æ—¥æ›†'
      },

      // 14. é‹å‹•å™¨æé¡ (80+)
      'é‹å‹•å™¨æ': {
        'basketball': 'ç±ƒçƒ', 'football': 'ç¾å¼è¶³çƒ', 'soccer ball': 'è¶³çƒ',
        'tennis ball': 'ç¶²çƒ', 'baseball': 'æ£’çƒ', 'volleyball': 'æ’çƒ',
        'golf club': 'é«˜çˆ¾å¤«çƒæ¡¿', 'tennis racket': 'ç¶²çƒæ‹', 'badminton racket': 'ç¾½æ¯›çƒæ‹',
        'skateboard': 'æ»‘æ¿', 'bicycle': 'è…³è¸è»Š', 'dumbbell': 'å•éˆ´', 'yoga mat': 'ç‘œä¼½å¢Š'
      },

      // 15. æ¨‚å™¨é¡ (50+)
      'æ¨‚å™¨': {
        'piano': 'é‹¼ç´', 'guitar': 'å‰ä»–', 'violin': 'å°æç´', 'drum': 'é¼“',
        'trumpet': 'å°è™Ÿ', 'saxophone': 'è–©å…‹æ–¯é¢¨', 'flute': 'é•·ç¬›', 'clarinet': 'å–®ç°§ç®¡'
      },

      // 16. é†«ç™‚ç”¨å“é¡ (40+)
      'é†«ç™‚ç”¨å“': {
        'thermometer': 'æº«åº¦è¨ˆ', 'bandage': 'ç¹ƒå¸¶', 'syringe': 'æ³¨å°„å™¨',
        'pill': 'è—¥ä¸¸', 'medicine': 'è—¥å“', 'first aid kit': 'æ€¥æ•‘ç®±'
      },

      // 17. å»ºç¯‰ç‰©é¡ (60+)
      'å»ºç¯‰ç‰©': {
        'house': 'æˆ¿å­', 'apartment': 'å…¬å¯“', 'building': 'å»ºç¯‰ç‰©',
        'school': 'å­¸æ ¡', 'hospital': 'é†«é™¢', 'store': 'å•†åº—',
        'restaurant': 'é¤å»³', 'hotel': 'é£¯åº—', 'bank': 'éŠ€è¡Œ', 'church': 'æ•™å ‚'
      },

      // 18. å®¤å¤–ç‰©å“é¡ (80+)
      'å®¤å¤–ç‰©å“': {
        'tree': 'æ¨¹', 'flower': 'èŠ±', 'grass': 'è‰', 'fountain': 'å™´æ³‰',
        'bench': 'é•·æ¤…', 'street light': 'è·¯ç‡ˆ', 'traffic light': 'ç´…ç¶ ç‡ˆ',
        'stop sign': 'åœæ­¢æ¨™èªŒ', 'mailbox': 'éƒµç®±', 'fire hydrant': 'æ¶ˆé˜²æ “'
      },

      // 19. ç©å…·é¡ (60+)
      'ç©å…·': {
        'doll': 'å¨ƒå¨ƒ', 'teddy bear': 'æ³°è¿ªç†Š', 'puzzle': 'æ‹¼åœ–',
        'lego': 'æ¨‚é«˜', 'robot': 'æ©Ÿå™¨äºº', 'car toy': 'ç©å…·è»Š',
        'ball': 'çƒ', 'kite': 'é¢¨ç®', 'playing cards': 'æ’²å…‹ç‰Œ'
      },

      // 20. ç å¯¶é¦–é£¾é¡ (40+)
      'ç å¯¶é¦–é£¾': {
        'ring': 'æˆ’æŒ‡', 'necklace': 'é …éŠ', 'bracelet': 'æ‰‹éŠ',
        'earrings': 'è€³ç’°', 'watch': 'æ‰‹éŒ¶', 'brooch': 'èƒ¸é‡'
      },

      // 21. å…¶ä»–ç‰©å“é¡ (100+)
      'å…¶ä»–ç‰©å“': {
        'clock': 'æ™‚é˜', 'watch': 'æ‰‹éŒ¶', 'umbrella': 'é›¨å‚˜', 'key': 'é‘°åŒ™',
        'money': 'éŒ¢', 'credit card': 'ä¿¡ç”¨å¡', 'book': 'æ›¸', 'magazine': 'é›œèªŒ',
        'newspaper': 'å ±ç´™', 'phone': 'é›»è©±', 'candle': 'è Ÿç‡­', 'vase': 'èŠ±ç“¶'
      }
    };

    // å»ºç«‹å®Œæ•´çš„ç‰©å“æ˜ å°„
    const itemNames = {};
    const itemCategories = {};
    Object.keys(itemDatabase).forEach(category => {
      Object.keys(itemDatabase[category]).forEach(key => {
        itemNames[key] = itemDatabase[category][key];
        itemCategories[key] = category;
      });
    });

    console.log(`è¼‰å…¥å®Œæˆ: ${Object.keys(itemNames).length} ç¨®ç‰©å“`);

    class SmartAssistant {
      constructor() {
        this.model = null;
        this.isRecognizing = false;
        this.continuousMode = false;
        this.voiceEnabled = true;
        this.homeLocation = null;
        this.isNavigating = false;
        this.watchId = null;
        this.lastItems = [];
        this.lastSpeechTime = 0;
        this.SPEECH_COOLDOWN = 4000;
        this.currentCategory = 'å…¨éƒ¨';
      }

      // åˆå§‹åŒ–AIæ¨¡å‹
      async initModel() {
        try {
          updateVoice('æ­£åœ¨æº–å‚™æ™ºèƒ½è­˜åˆ¥ç³»çµ±...');
          this.model = await cocoSsd.load();
          updateVoice(`ç³»çµ±æº–å‚™å®Œæˆï¼å¯è­˜åˆ¥${Object.keys(itemNames).length}ç¨®ç‰©å“`);
          this.updateModeIndicator('idle');
          this.initCategoryFilter();
        } catch (error) {
          updateVoice('ç³»çµ±åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢');
        }
      }

      // åˆå§‹åŒ–åˆ†é¡ç¯©é¸å™¨
      initCategoryFilter() {
        const container = document.getElementById('categoryFilter');
        const categories = ['å…¨éƒ¨', ...Object.keys(itemDatabase)];
        
        container.innerHTML = categories.map(category => 
          `<button class="category-btn ${category === 'å…¨éƒ¨' ? 'active' : ''}" 
                  onclick="assistant.setCategory('${category}')">${category}</button>`
        ).join('');
      }

      // è¨­å®šåˆ†é¡
      setCategory(category) {
        this.currentCategory = category;
        
        // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        document.querySelectorAll('.category-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // é‡æ–°ç¯©é¸é¡¯ç¤ºçš„ç‰©å“
        this.filterDisplayedItems();
      }

      // ç¯©é¸é¡¯ç¤ºçš„ç‰©å“
      filterDisplayedItems() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const filteredItems = this.lastItems.filter(item => {
          const matchesCategory = this.currentCategory === 'å…¨éƒ¨' || 
                                itemCategories[item.class] === this.currentCategory;
          const matchesSearch = item.name.toLowerCase().includes(searchTerm) ||
                              item.class.toLowerCase().includes(searchTerm);
          return matchesCategory && matchesSearch;
        });
        
        this.updateItemsDisplay(filteredItems);
      }

      // é–‹å§‹ç‰©å“è­˜åˆ¥
      async startItemRecognition() {
        if (!this.model) {
          updateVoice('ç³»çµ±å°šæœªæº–å‚™å¥½');
          return;
        }

        const video = await this.setupCamera();
        if (!video) return;

        this.isRecognizing = true;
        this.updateModeIndicator('identifying');
        updateVoice('é–‹å§‹è­˜åˆ¥ç‰©å“ï¼Œè«‹å°‡é¡é ­å°æº–æƒ³èªè­˜çš„ç‰©å“');

        try {
          const predictions = await this.model.detect(video);
          this.processRecognitionResults(predictions);
        } catch (error) {
          updateVoice('è­˜åˆ¥å¤±æ•—ï¼Œè«‹é‡è©¦');
        }

        this.isRecognizing = false;
        this.updateModeIndicator('idle');
      }

      // åˆ‡æ›é€£çºŒè­˜åˆ¥æ¨¡å¼
      async toggleContinuousMode() {
        if (this.continuousMode) {
          this.stopContinuousMode();
        } else {
          await this.startContinuousMode();
        }
      }

      // é–‹å§‹é€£çºŒè­˜åˆ¥
      async startContinuousMode() {
        if (!this.model) {
          updateVoice('ç³»çµ±å°šæœªæº–å‚™å¥½');
          return;
        }

        const video = await this.setupCamera();
        if (!video) return;

        this.continuousMode = true;
        this.isRecognizing = true;
        this.updateModeIndicator('identifying');
        updateVoice('é–‹å•Ÿé€£çºŒè­˜åˆ¥æ¨¡å¼ï¼Œç³»çµ±æœƒæŒçºŒå‘Šè¨´æ‚¨çœ‹åˆ°çš„ç‰©å“');
        
        document.getElementById('continuousBtn').innerHTML = 
          '<span class="button-icon">â¹ï¸</span><span class="button-text">åœæ­¢è­˜åˆ¥</span>';

        this.continuousRecognition(video);
      }

      // åœæ­¢é€£çºŒè­˜åˆ¥
      stopContinuousMode() {
        this.continuousMode = false;
        this.isRecognizing = false;
        this.updateModeIndicator('idle');
        updateVoice('å·²åœæ­¢é€£çºŒè­˜åˆ¥');
        
        document.getElementById('continuousBtn').innerHTML = 
          '<span class="button-icon">ğŸ”„</span><span class="button-text">é€£çºŒè­˜åˆ¥</span>';
      }

      // é€£çºŒè­˜åˆ¥å¾ªç’°
      async continuousRecognition(video) {
        if (!this.continuousMode) return;

        try {
          const predictions = await this.model.detect(video);
          this.processRecognitionResults(predictions);
          
          // 2ç§’å¾Œç¹¼çºŒä¸‹ä¸€è¼ªè­˜åˆ¥
          setTimeout(() => this.continuousRecognition(video), 2000);
        } catch (error) {
          setTimeout(() => this.continuousRecognition(video), 2000);
        }
      }

      // è™•ç†è­˜åˆ¥çµæœ
      processRecognitionResults(predictions) {
        const highConfidenceItems = predictions
          .filter(pred => pred.score > 0.5 && itemNames[pred.class])
          .map(pred => ({
            class: pred.class,
            name: itemNames[pred.class],
            confidence: pred.score,
            category: itemCategories[pred.class]
          }))
          .filter((item, index, array) => 
            array.findIndex(i => i.class === item.class) === index
          )
          .sort((a, b) => b.confidence - a.confidence)
          .slice(0, 8);

        this.lastItems = highConfidenceItems;
        this.filterDisplayedItems();
        this.provideItemVoiceGuidance(highConfidenceItems);
      }

      // æ›´æ–°ç‰©å“é¡¯ç¤º
      updateItemsDisplay(items) {
        const container = document.getElementById('itemsContainer');
        document.getElementById('itemCount').textContent = items.length;

        if (items.length === 0) {
          container.innerHTML = `
            <div class="item-card" style="background: #f1f2f6; color: #636e72; grid-column: 1/-1;">
              <div class="item-name">æœªè­˜åˆ¥åˆ°ç‰©å“</div>
              <div class="item-confidence">è«‹èª¿æ•´é¡é ­æ–¹å‘æˆ–å˜—è©¦å…¶ä»–åˆ†é¡</div>
            </div>
          `;
          return;
        }

        container.innerHTML = items.map((item, index) => `
          <div class="item-card highlight" style="animation-delay: ${index * 0.1}s">
            <div class="item-name">${item.name}</div>
            <div class="item-confidence">å¯ä¿¡åº¦: ${Math.round(item.confidence * 100)}%</div>
            <div class="category-tag">${item.category}</div>
          </div>
        `).join('');
      }

      // æä¾›ç‰©å“èªéŸ³æç¤º
      provideItemVoiceGuidance(items) {
        const now = Date.now();
        if (now - this.lastSpeechTime < this.SPEECH_COOLDOWN || items.length === 0) return;

        const topItems = items.slice(0, 3); // åªæç¤ºå‰3å€‹
        const itemNames = topItems.map(item => item.name).join('ã€');
        
        if (this.continuousMode) {
          // é€£çºŒæ¨¡å¼æ™‚è¼ƒå°‘èªéŸ³æç¤º
          if (Math.random() < 0.3) { // 30%æ©Ÿç‡æç¤º
            updateVoice(`çœ‹åˆ°ï¼š${itemNames}`);
            this.lastSpeechTime = now;
          }
        } else {
          updateVoice(`çœ‹åˆ°ï¼š${itemNames}`);
          this.lastSpeechTime = now;
        }
      }

      // è¨­å®šå®¶çš„ä½ç½®
      async setHomeLocation() {
        return new Promise((resolve, reject) => {
          if (!navigator.geolocation) {
            reject('æ‚¨çš„è£ç½®ä¸æ”¯æ´å®šä½åŠŸèƒ½');
            return;
          }

          updateVoice('æ­£åœ¨è¨˜éŒ„å®¶çš„ä½ç½®...');
          
          navigator.geolocation.getCurrentPosition(
            (position) => {
              this.homeLocation = {
                latitude: position.coords.latitude,
                longitude: position.coords.longitude,
                accuracy: position.coords.accuracy
              };
              
              localStorage.setItem('homeLocation', JSON.stringify(this.homeLocation));
              updateVoice('å®¶çš„ä½ç½®å·²æˆåŠŸè¨˜éŒ„ï¼');
              document.getElementById('homeStatus').textContent = 'å·²è¨­å®š';
              resolve(this.homeLocation);
            },
            (error) => {
              const errorMsg = this.getGeolocationError(error);
              reject(errorMsg);
            }
          );
        });
      }

      // é–‹å§‹å°èˆªå›å®¶
      startNavigationHome() {
        if (!this.homeLocation) {
          updateVoice('è«‹å…ˆè¨­å®šå®¶çš„ä½ç½®');
          return;
        }

        this.isNavigating = true;
        this.updateModeIndicator('navigating');
        updateVoice('é–‹å§‹å°èˆªå›å®¶ï¼Œè«‹è·Ÿéš¨èªéŸ³æŒ‡å¼•');
        document.getElementById('navigationPanel').style.display = 'block';

        this.watchId = navigator.geolocation.watchPosition(
          (position) => {
            this.updateNavigation(position);
          },
          (error) => {
            updateVoice('GPSä¿¡è™Ÿä¸ç©©å®š');
          },
          { enableHighAccuracy: true, timeout: 5000 }
        );
      }

      // æ›´æ–°å°èˆª
      updateNavigation(position) {
        const currentLocation = {
          latitude: position.coords.latitude,
          longitude: position.coords.longitude
        };

        const navInfo = this.calculateNavigationInfo(currentLocation, this.homeLocation);
        if (!navInfo) return;

        this.updateNavigationDisplay(navInfo);
        this.provideNavigationGuidance(navInfo);
      }

      // è¨ˆç®—å°èˆªè³‡è¨Š
      calculateNavigationInfo(current, target) {
        const R = 6371000;
        const Ï†1 = current.latitude * Math.PI/180;
        const Ï†2 = target.latitude * Math.PI/180;
        const Î”Ï† = (target.latitude - current.latitude) * Math.PI/180;
        const Î”Î» = (target.longitude - current.longitude) * Math.PI/180;

        const a = Math.sin(Î”Ï†/2) * Math.sin(Î”Ï†/2) +
                  Math.cos(Ï†1) * Math.cos(Ï†2) * Math.sin(Î”Î»/2) * Math.sin(Î”Î»/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        const distance = Math.round(R * c);

        const y = Math.sin(Î”Î») * Math.cos(Ï†2);
        const x = Math.cos(Ï†1) * Math.sin(Ï†2) - Math.sin(Ï†1) * Math.cos(Ï†2) * Math.cos(Î”Î»);
        const Î¸ = Math.atan2(y, x);
        const bearing = (Î¸ * 180/Math.PI + 360) % 360;

        const direction = this.getDirectionFromBearing(bearing);

        return { distance, bearing, direction };
      }

      // ç²å–æ–¹å‘
      getDirectionFromBearing(bearing) {
        if (bearing >= 337.5 || bearing < 22.5) return 'åŒ—';
        if (bearing >= 22.5 && bearing < 67.5) return 'æ±åŒ—';
        if (bearing >= 67.5 && bearing < 112.5) return 'æ±';
        if (bearing >= 112.5 && bearing < 157.5) return 'æ±å—';
        if (bearing >= 157.5 && bearing < 202.5) return 'å—';
        if (bearing >= 202.5 && bearing < 247.5) return 'è¥¿å—';
        if (bearing >= 247.5 && bearing < 292.5) return 'è¥¿';
        return 'è¥¿åŒ—';
      }

      // æ›´æ–°å°èˆªé¡¯ç¤º
      updateNavigationDisplay(navInfo) {
        const { distance, direction } = navInfo;
        
        document.getElementById('distanceDisplay').textContent = distance + ' å…¬å°º';
        
        const arrows = {
          'åŒ—': 'â†‘', 'æ±åŒ—': 'â†—', 'æ±': 'â†’', 'æ±å—': 'â†˜',
          'å—': 'â†“', 'è¥¿å—': 'â†™', 'è¥¿': 'â†', 'è¥¿åŒ—': 'â†–'
        };
        document.getElementById('directionArrow').textContent = arrows[direction] || 'â†‘';
      }

      // æä¾›å°èˆªæŒ‡å¼•
      provideNavigationGuidance(navInfo) {
        const { distance, direction } = navInfo;
        const now = Date.now();
        
        if (now - this.lastSpeechTime < this.SPEECH_COOLDOWN) return;

        let instruction = '';
        if (distance < 20) {
          instruction = 'å·²åˆ°å®¶äº†ï¼Œå°èˆªçµæŸ';
          this.stopNavigation();
        } else if (distance < 50) {
          instruction = `å¿«åˆ°å®¶äº†ï¼Œé‚„æœ‰${distance}å…¬å°ºï¼Œè«‹å¾€${direction}èµ°`;
        } else {
          instruction = `è·é›¢å®¶${distance}å…¬å°ºï¼Œè«‹å¾€${direction}æ–¹å‘å‰é€²`;
        }

        updateVoice(instruction);
        document.getElementById('turnInstruction').textContent = instruction;
        this.lastSpeechTime = now;
      }

      // åœæ­¢å°èˆª
      stopNavigation() {
        if (this.watchId) {
          navigator.geolocation.clearWatch(this.watchId);
        }
        this.isNavigating = false;
        this.updateModeIndicator('idle');
        document.getElementById('navigationPanel').style.display = 'none';
      }

      // è¨­ç½®ç›¸æ©Ÿ
      async setupCamera() {
        const video = document.getElementById('video');
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: 'environment' }
          });
          video.srcObject = stream;
          document.getElementById('cameraOverlay').textContent = 'é¡é ­å°±ç·’';
          return new Promise((resolve) => {
            video.onloadedmetadata = () => { resolve(video); };
          });
        } catch (error) {
          updateVoice('ç„¡æ³•é–‹å•Ÿç›¸æ©Ÿ');
          return null;
        }
      }

      // æ›´æ–°æ¨¡å¼æŒ‡ç¤ºå™¨
      updateModeIndicator(mode) {
        const indicator = document.getElementById('modeIndicator');
        const modeText = document.getElementById('currentMode');
        
        const modes = {
          'idle': { class: 'mode-idle', text: 'å¾…æ©Ÿä¸­' },
          'identifying': { class: 'mode-identifying', text: 'è­˜åˆ¥ç‰©å“ä¸­' },
          'navigating': { class: 'mode-navigating', text: 'å°èˆªä¸­' },
          'recording': { class: 'mode-recording', text: 'è¨˜éŒ„ä¸­' }
        };

        indicator.className = 'mode-indicator ' + modes[mode].class;
        modeText.textContent = modes[mode].text;
      }

      // è¼‰å…¥å„²å­˜çš„ä½ç½®
      loadSavedLocations() {
        const savedHome = localStorage.getItem('homeLocation');
        if (savedHome) {
          this.homeLocation = JSON.parse(savedHome);
          document.getElementById('homeStatus').textContent = 'å·²è¨­å®š';
        }
      }

      // ç²å–åœ°ç†å®šä½éŒ¯èª¤
      getGeolocationError(error) {
        switch(error.code) {
          case error.PERMISSION_DENIED: return 'è«‹å…è¨±ä½ç½®æ¬Šé™';
          case error.POSITION_UNAVAILABLE: return 'ç„¡æ³•ç²å–ä½ç½®è³‡è¨Š';
          case error.TIMEOUT: return 'å®šä½è¶…æ™‚';
          default: return 'å®šä½æœå‹™éŒ¯èª¤';
        }
      }
    }

    // å…¨åŸŸè®Šæ•¸
    const assistant = new SmartAssistant();
    let voiceEnabled = true;

    // åˆå§‹åŒ–
    function init() {
      assistant.initModel();
      assistant.loadSavedLocations();
      document.getElementById('databaseSize').textContent = 
        Object.keys(itemNames).length + '+ ç‰©å“';
    }

    // åŒ…è£å‡½æ•¸
    function startItemRecognition() {
      assistant.startItemRecognition();
    }

    function toggleContinuousMode() {
      assistant.toggleContinuousMode();
    }

    function setHomeLocation() {
      assistant.setHomeLocation().catch(error => updateVoice(error));
    }

    function startNavigationHome() {
      assistant.startNavigationHome();
    }

    function toggleVoice() {
      voiceEnabled = !voiceEnabled;
      const button = document.getElementById('voiceToggleBtn');
      if (voiceEnabled) {
        button.innerHTML = '<span class="button-icon">ğŸ”‡</span><span class="button-text">é—œé–‰èªéŸ³</span>';
        updateVoice('èªéŸ³æç¤ºå·²é–‹å•Ÿ');
      } else {
        button.innerHTML = '<span class="button-icon">ğŸ”Š</span><span class="button-text">é–‹å•ŸèªéŸ³</span>';
        window.speechSynthesis.cancel();
      }
    }

    function repeatInstruction() {
      const voiceAlert = document.getElementById('voiceAlert');
      if (voiceAlert.textContent && voiceEnabled) {
        updateVoice(voiceAlert.textContent);
      }
    }

    function filterItems() {
      assistant.filterDisplayedItems();
    }

    // èªéŸ³æç¤º
    function updateVoice(message) {
      const voiceAlert = document.getElementById('voiceAlert');
      voiceAlert.textContent = message;
      
      if (voiceEnabled && window.speechSynthesis) {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(message);
        utterance.lang = 'zh-TW';
        utterance.rate = 0.8;
        utterance.pitch = 1.0;
        window.speechSynthesis.speak(utterance);
      }
    }

    // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>