<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç›²äººå°èˆªåŠ©æ‰‹ - å¢å¼·ç‰ˆ</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.18.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2/dist/coco-ssd.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: #1e293b;
      color: white;
      height: 100vh;
      overflow: hidden;
      padding: 10px;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 10px;
    }
    
    .header {
      text-align: center;
      padding: 15px;
      background: #334155;
      border-radius: 12px;
    }
    
    .camera-container {
      flex: 1;
      background: #000;
      border-radius: 12px;
      position: relative;
      overflow: hidden;
    }
    
    #video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scaleX(-1);
    }
    
    #canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    .status-panel {
      background: #334155;
      border-radius: 12px;
      padding: 15px;
    }
    
    .status-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .status-item {
      text-align: center;
      padding: 10px;
      background: #475569;
      border-radius: 8px;
    }
    
    .status-label {
      font-size: 12px;
      opacity: 0.8;
      margin-bottom: 5px;
    }
    
    .status-value {
      font-size: 16px;
      font-weight: bold;
    }
    
    .warning-level {
      height: 8px;
      background: #475569;
      border-radius: 4px;
      margin: 10px 0;
      overflow: hidden;
    }
    
    .warning-fill {
      height: 100%;
      border-radius: 4px;
      transition: all 0.3s;
    }
    
    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .btn {
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn:active {
      transform: scale(0.98);
    }
    
    .btn-primary {
      background: #22c55e;
    }
    
    .btn-danger {
      background: #ef4444;
    }
    
    .btn-warning {
      background: #f59e0b;
    }
    
    .btn-secondary {
      background: #475569;
    }
    
    .emergency-btn {
      width: 100%;
      padding: 18px;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      font-weight: bold;
      margin-top: 10px;
    }
    
    .voice-feedback {
      background: #334155;
      border-radius: 12px;
      padding: 15px;
      margin-top: 10px;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 14px;
    }
    
    .detection-info {
      font-size: 12px;
      text-align: center;
      margin-top: 10px;
      opacity: 0.7;
    }
    
    .continuous-scan {
      background: #22c55e;
      padding: 8px;
      border-radius: 6px;
      text-align: center;
      margin-top: 10px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ§­ ç›²äººå°èˆªåŠ©æ‰‹ - å¢å¼·ç‰ˆ</h1>
      <div>é€£çºŒéšœç¤™ç‰©æª¢æ¸¬ Â· 80ç¨®ç‰©é«”è­˜åˆ¥</div>
    </div>
    
    <div class="camera-container">
      <video id="video" autoplay playsinline muted></video>
      <canvas id="canvas"></canvas>
      <div class="continuous-scan" id="scanStatus">
        ğŸ”„ é€£çºŒæƒæä¸­...
      </div>
    </div>
    
    <div class="status-panel">
      <div class="status-grid">
        <div class="status-item">
          <div class="status-label">æª¢æ¸¬ç‹€æ…‹</div>
          <div class="status-value" id="detectionStatus">æº–å‚™ä¸­</div>
        </div>
        <div class="status-item">
          <div class="status-label">æœ€è¿‘éšœç¤™ç‰©</div>
          <div class="status-value" id="closestObject">--</div>
        </div>
        <div class="status-item">
          <div class="status-label">å±éšªç­‰ç´š</div>
          <div class="status-value" id="dangerLevel">--</div>
        </div>
        <div class="status-item">
          <div class="status-label">æª¢æ¸¬æ•¸é‡</div>
          <div class="status-value" id="detectionCount">0</div>
        </div>
      </div>
      
      <div class="warning-level">
        <div class="warning-fill" id="warningFill" style="width: 0%; background: #22c55e"></div>
      </div>
      
      <div class="detection-info" id="detectionInfo">
        æ­£åœ¨åˆå§‹åŒ–AIæ¨¡å‹...
      </div>
    </div>
    
    <div class="controls">
      <button class="btn btn-primary" id="btnStart">é–‹å§‹é€£çºŒæª¢æ¸¬</button>
      <button class="btn btn-danger" id="btnStop" disabled>åœæ­¢æª¢æ¸¬</button>
      <button class="btn btn-secondary" id="btnToggleVoice">ğŸ”Š èªéŸ³é–‹</button>
      <button class="btn btn-warning" id="btnRepeat">é‡è¤‡è­¦å‘Š</button>
    </div>
    
    <button class="emergency-btn" id="btnEmergency">
      ğŸ†˜ ç·Šæ€¥æ±‚åŠ© & åˆ†äº«ä½ç½®
    </button>
    
    <div class="voice-feedback" id="voiceFeedback">
      ç³»çµ±æº–å‚™ä¸­ï¼Œè«‹ç¨å€™...
    </div>
  </div>

  <script>
    // å¢å¼·ç‰ˆç›²äººå°èˆªåŠ©æ‰‹ - è§£æ±ºé€£çºŒæª¢æ¸¬å’Œè­˜åˆ¥ç¯„åœå•é¡Œ
    class EnhancedBlindNavigation {
      constructor() {
        this.isDetecting = false;
        this.model = null;
        this.video = null;
        this.canvas = null;
        this.ctx = null;
        this.voiceEnabled = true;
        this.detectionFrameId = null;
        this.lastWarningTime = 0;
        this.warningCooldown = 2000; // 2ç§’è­¦å‘Šå†·å»
        this.lastSpokenWarning = '';
        
        // æ“´å±•çš„éšœç¤™ç‰©é¡åˆ¥ï¼ˆCOCOæ•¸æ“šé›†çš„80å€‹é¡åˆ¥ï¼‰
        this.obstacleClasses = new Set([
          'person', 'bicycle', 'car', 'motorcycle', 'airplane', 'bus', 'train', 'truck',
          'boat', 'traffic light', 'fire hydrant', 'stop sign', 'parking meter',
          'bench', 'bird', 'cat', 'dog', 'horse', 'sheep', 'cow', 'elephant', 'bear',
          'zebra', 'giraffe', 'backpack', 'umbrella', 'handbag', 'tie', 'suitcase',
          'frisbee', 'skis', 'snowboard', 'sports ball', 'kite', 'baseball bat',
          'baseball glove', 'skateboard', 'surfboard', 'tennis racket', 'bottle',
          'wine glass', 'cup', 'fork', 'knife', 'spoon', 'bowl', 'banana', 'apple',
          'sandwich', 'orange', 'broccoli', 'carrot', 'hot dog', 'pizza', 'donut',
          'cake', 'chair', 'couch', 'potted plant', 'bed', 'dining table', 'toilet',
          'tv', 'laptop', 'mouse', 'remote', 'keyboard', 'cell phone', 'microwave',
          'oven', 'toaster', 'sink', 'refrigerator', 'book', 'clock', 'vase',
          'scissors', 'teddy bear', 'hair drier', 'toothbrush'
        ]);
        
        this.initialize();
      }
      
      async initialize() {
        this.video = document.getElementById('video');
        this.canvas = document.getElementById('canvas');
        this.ctx = this.canvas.getContext('2d');
        
        this.speak('æ­£åœ¨åŠ è¼‰AIè¦–è¦ºæ¨¡å‹ï¼Œè«‹ç¨å€™');
        
        try {
          // ä½¿ç”¨æ›´è¼•é‡çš„æ¨¡å‹é…ç½®åŠ å¿«åŠ è¼‰é€Ÿåº¦
          this.model = await cocoSsd.load({
            base: 'lite_mobilenet_v2' // æ›´è¼•é‡çš„æ¨¡å‹
          });
          
          this.speak('AIæ¨¡å‹åŠ è¼‰å®Œæˆï¼Œå¯ä»¥é–‹å§‹é€£çºŒéšœç¤™ç‰©æª¢æ¸¬');
          this.updateDetectionStatus('å°±ç·’');
          this.updateDetectionInfo('å¯è­˜åˆ¥80ç¨®å¸¸è¦‹ç‰©é«”');
          
        } catch (error) {
          console.error('æ¨¡å‹åŠ è¼‰å¤±æ•—:', error);
          this.speak('æ¨¡å‹åŠ è¼‰å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡é€£æ¥å¾Œåˆ·æ–°é é¢');
        }
      }
      
      async startContinuousDetection() {
        if (!this.model) {
          this.speak('AIæ¨¡å‹å°šæœªå°±ç·’ï¼Œè«‹ç¨å€™');
          return;
        }
        
        try {
          // é–‹å•Ÿæ”åƒé ­
          const stream = await navigator.mediaDevices.getUserMedia({
            video: { 
              facingMode: 'environment',
              width: { ideal: 640 },
              height: { ideal: 480 },
              frameRate: { ideal: 15 } // é™ä½å¹€ç‡æé«˜æ€§èƒ½
            }
          });
          
          this.video.srcObject = stream;
          this.isDetecting = true;
          
          // ç­‰å¾…è¦–é »æº–å‚™å¥½
          await new Promise(resolve => {
            this.video.onloadedmetadata = () => {
              this.video.play().then(resolve);
            };
          });
          
          // è¨­ç½®ç•«å¸ƒå°ºå¯¸
          this.canvas.width = this.video.videoWidth;
          this.canvas.height = this.video.videoHeight;
          
          this.updateDetectionStatus('é€£çºŒæª¢æ¸¬ä¸­');
          this.speak('é–‹å§‹é€£çºŒéšœç¤™ç‰©æª¢æ¸¬ï¼Œç³»çµ±å°‡æŒçºŒæƒæå‘¨åœç’°å¢ƒ');
          
          // å•Ÿç”¨åœæ­¢æŒ‰éˆ•
          document.getElementById('btnStop').disabled = false;
          document.getElementById('btnStart').disabled = true;
          
          // é–‹å§‹é€£çºŒæª¢æ¸¬å¾ªç’°
          this.detectionLoop();
          
        } catch (error) {
          console.error('ç›¸æ©Ÿå•Ÿå‹•å¤±æ•—:', error);
          this.handleCameraError(error);
        }
      }
      
      async detectionLoop() {
        if (!this.isDetecting) return;
        
        try {
          // æ¸…ç©ºç•«å¸ƒ
          this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
          
          // é€²è¡Œç‰©é«”æª¢æ¸¬
          const predictions = await this.model.detect(this.video);
          
          // è™•ç†æª¢æ¸¬çµæœ
          this.processDetections(predictions);
          
          // ç«‹å³é–‹å§‹ä¸‹ä¸€å¹€æª¢æ¸¬ï¼ˆçœŸæ­£çš„é€£çºŒæª¢æ¸¬ï¼‰
          this.detectionFrameId = requestAnimationFrame(() => this.detectionLoop());
          
        } catch (error) {
          console.error('æª¢æ¸¬éŒ¯èª¤:', error);
          // å³ä½¿å‡ºéŒ¯ä¹Ÿç¹¼çºŒæª¢æ¸¬
          this.detectionFrameId = requestAnimationFrame(() => this.detectionLoop());
        }
      }
      
      processDetections(predictions) {
        // éæ¿¾å‡ºæ‰€æœ‰å¯èƒ½æˆç‚ºéšœç¤™ç‰©çš„ç‰©é«”
        const obstacles = predictions.filter(pred => 
          this.obstacleClasses.has(pred.class) && pred.score > 0.4 // é™ä½ç½®ä¿¡åº¦é–¾å€¼
        );
        
        // æ›´æ–°æª¢æ¸¬æ•¸é‡é¡¯ç¤º
        this.updateDetectionDisplay(obstacles);
        
        if (obstacles.length > 0) {
          // æ‰¾å‡ºæœ€å±éšªçš„éšœç¤™ç‰©ï¼ˆåŸºæ–¼å¤§å°å’Œä½ç½®ï¼‰
          const mostDangerous = this.findMostDangerousObstacle(obstacles);
          this.handleDangerAssessment(mostDangerous, obstacles);
          this.drawDetectionBoxes(obstacles);
        } else {
          this.clearWarnings();
        }
      }
      
      findMostDangerousObstacle(obstacles) {
        return obstacles.reduce((mostDangerous, current) => {
          // è¨ˆç®—å±éšªåˆ†æ•¸ï¼ˆåŸºæ–¼å¤§å°ã€ä½ç½®ã€ç½®ä¿¡åº¦ï¼‰
          const currentScore = this.calculateDangerScore(current);
          const mostDangerousScore = this.calculateDangerScore(mostDangerous);
          return currentScore > mostDangerousScore ? current : mostDangerous;
        });
      }
      
      calculateDangerScore(obstacle) {
        const bbox = obstacle.bbox;
        const centerX = bbox[0] + bbox[2] / 2;
        const centerY = bbox[1] + bbox[3] / 2;
        
        // è¨ˆç®—åœ¨ç•«é¢ä¸­å¿ƒçš„ç¨‹åº¦ï¼ˆè¶Šä¸­å¿ƒè¶Šå±éšªï¼‰
        const canvasCenterX = this.canvas.width / 2;
        const canvasCenterY = this.canvas.height / 2;
        const distanceFromCenter = Math.sqrt(
          Math.pow(centerX - canvasCenterX, 2) + 
          Math.pow(centerY - canvasCenterY, 2)
        );
        
        const centerFactor = 1 - (distanceFromCenter / (this.canvas.width / 2));
        
        // è¨ˆç®—å¤§å°å› ç´ ï¼ˆè¶Šå¤§è¶Šå±éšªï¼‰
        const sizeFactor = (bbox[2] * bbox[3]) / (this.canvas.width * this.canvas.height);
        
        // è¨ˆç®—ç½®ä¿¡åº¦å› ç´ 
        const confidenceFactor = obstacle.score;
        
        // ç¶œåˆå±éšªåˆ†æ•¸
        return (centerFactor * 0.4) + (sizeFactor * 0.4) + (confidenceFactor * 0.2);
      }
      
      handleDangerAssessment(obstacle, allObstacles) {
        const dangerScore = this.calculateDangerScore(obstacle);
        const bbox = obstacle.bbox;
        const coverage = (bbox[2] * bbox[3]) / (this.canvas.width * this.canvas.height);
        
        let dangerLevel = 'å®‰å…¨';
        let warningColor = '#22c55e';
        let speakPriority = 0;
        
        if (coverage > 0.25 || dangerScore > 0.7) {
          dangerLevel = 'é«˜å±éšª';
          warningColor = '#ef4444';
          speakPriority = 3;
        } else if (coverage > 0.15 || dangerScore > 0.5) {
          dangerLevel = 'ä¸­å±éšª';
          warningColor = '#f59e0b';
          speakPriority = 2;
        } else if (coverage > 0.05 || dangerScore > 0.3) {
          dangerLevel = 'ä½å±éšª';
          warningColor = '#eab308';
          speakPriority = 1;
        }
        
        // æ›´æ–°é¡¯ç¤º
        document.getElementById('closestObject').textContent = obstacle.class;
        document.getElementById('dangerLevel').textContent = dangerLevel;
        
        // æ›´æ–°è­¦å‘Šæ¢
        const warningFill = document.getElementById('warningFill');
        const fillPercentage = Math.min(100, dangerScore * 150);
        warningFill.style.width = fillPercentage + '%';
        warningFill.style.background = warningColor;
        
        // èªéŸ³è­¦å‘Šï¼ˆå¸¶å†·å»æ™‚é–“ï¼‰
        const now = Date.now();
        if (speakPriority >= 2 && now - this.lastWarningTime > this.warningCooldown) {
          const warningMessage = this.generateWarningMessage(obstacle, dangerLevel, allObstacles.length);
          if (this.lastSpokenWarning !== warningMessage) {
            this.speak(warningMessage);
            this.lastSpokenWarning = warningMessage;
            this.lastWarningTime = now;
            
            // é«˜å±éšªæ™‚æŒ¯å‹•
            if (speakPriority === 3 && 'vibrate' in navigator) {
              navigator.vibrate([300, 100, 300, 100, 300]);
            }
          }
        }
        
        this.updateDetectionInfo(`æª¢æ¸¬åˆ° ${allObstacles.length} å€‹ç‰©é«”ï¼Œæœ€è¿‘: ${obstacle.class}`);
      }
      
      generateWarningMessage(obstacle, dangerLevel, totalCount) {
        const objectName = this.getLocalizedName(obstacle.class);
        
        if (dangerLevel === 'é«˜å±éšª') {
          return `ç·Šæ€¥ï¼å‰æ–¹æœ‰${objectName}ï¼Œè«‹ç«‹å³åœæ­¢ç§»å‹•`;
        } else if (dangerLevel === 'ä¸­å±éšª') {
          return `æ³¨æ„ï¼å‰æ–¹æœ‰${objectName}ï¼Œè«‹å°å¿ƒ`;
        } else {
          return `å‰æ–¹æœ‰${objectName}ï¼Œè«‹æ³¨æ„`;
        }
      }
      
      getLocalizedName(className) {
        const nameMap = {
          'person': 'äºº',
          'chair': 'æ¤…å­',
          'table': 'æ¡Œå­',
          'car': 'æ±½è»Š',
          'bottle': 'ç“¶å­',
          'cup': 'æ¯å­',
          'book': 'æ›¸æœ¬',
          'cell phone': 'æ‰‹æ©Ÿ',
          'laptop': 'ç­†è¨˜æœ¬é›»è…¦',
          'tv': 'é›»è¦–',
          'bed': 'åºŠ',
          'couch': 'æ²™ç™¼'
        };
        
        return nameMap[className] || className;
      }
      
      drawDetectionBoxes(obstacles) {
        obstacles.forEach(obstacle => {
          const [x, y, width, height] = obstacle.bbox;
          const dangerScore = this.calculateDangerScore(obstacle);
          
          // æ ¹æ“šå±éšªç¨‹åº¦è¨­ç½®é¡è‰²
          let color = '#22c55e'; // å®‰å…¨ - ç¶ è‰²
          if (dangerScore > 0.5) color = '#f59e0b'; // ä¸­ç­‰ - é»ƒè‰²
          if (dangerScore > 0.7) color = '#ef4444'; // å±éšª - ç´…è‰²
          
          // ç¹ªè£½é‚Šç•Œæ¡†
          this.ctx.strokeStyle = color;
          this.ctx.lineWidth = 3;
          this.ctx.strokeRect(x, y, width, height);
          
          // ç¹ªè£½æ¨™ç±¤
          this.ctx.fillStyle = color;
          const text = `${obstacle.class} ${Math.round(obstacle.score * 100)}%`;
          this.ctx.fillRect(x, y - 20, 150, 20);
          
          this.ctx.fillStyle = 'white';
          this.ctx.font = '14px Arial';
          this.ctx.fillText(text, x + 5, y - 5);
        });
      }
      
      stopDetection() {
        this.isDetecting = false;
        
        if (this.detectionFrameId) {
          cancelAnimationFrame(this.detectionFrameId);
          this.detectionFrameId = null;
        }
        
        if (this.video.srcObject) {
          this.video.srcObject.getTracks().forEach(track => track.stop());
          this.video.srcObject = null;
        }
        
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        
        this.updateDetectionStatus('å·²åœæ­¢');
        this.speak('æª¢æ¸¬å·²åœæ­¢');
        this.clearWarnings();
        
        document.getElementById('btnStop').disabled = true;
        document.getElementById('btnStart').disabled = false;
      }
      
      clearWarnings() {
        document.getElementById('closestObject').textContent = '--';
        document.getElementById('dangerLevel').textContent = '--';
        document.getElementById('warningFill').style.width = '0%';
        document.getElementById('warningFill').style.background = '#22c55e';
        this.updateDetectionInfo('æœªæª¢æ¸¬åˆ°éšœç¤™ç‰©');
      }
      
      updateDetectionStatus(status) {
        document.getElementById('detectionStatus').textContent = status;
      }
      
      updateDetectionInfo(info) {
        document.getElementById('detectionInfo').textContent = info;
      }
      
      updateDetectionDisplay(obstacles) {
        document.getElementById('detectionCount').textContent = obstacles.length;
      }
      
      handleCameraError(error) {
        let message = 'ç„¡æ³•å•Ÿå‹•ç›¸æ©Ÿ: ';
        if (error.name === 'NotAllowedError') {
          message += 'è«‹å…è¨±ç›¸æ©Ÿæ¬Šé™';
        } else {
          message += 'è«‹æª¢æŸ¥ç›¸æ©Ÿè¨­å‚™';
        }
        this.speak(message);
      }
      
      toggleVoice() {
        this.voiceEnabled = !this.voiceEnabled;
        const status = this.voiceEnabled ? 'é–‹å•Ÿ' : 'é—œé–‰';
        this.speak(`èªéŸ³æç¤ºå·²${status}`);
        document.getElementById('btnToggleVoice').textContent = 
          this.voiceEnabled ? 'ğŸ”Š èªéŸ³é–‹' : 'ğŸ”‡ èªéŸ³é—œ';
      }
      
      repeatWarning() {
        if (this.lastSpokenWarning) {
          this.speak(this.lastSpokenWarning);
        } else {
          this.speak('ç›®å‰æ²’æœ‰æª¢æ¸¬åˆ°éšœç¤™ç‰©');
        }
      }
      
      emergencyAlert() {
        this.speak('ç·Šæ€¥æ±‚åŠ©å·²å•Ÿå‹•ï¼æ­£åœ¨ç™¼é€ä½ç½®ä¿¡æ¯');
        
        if ('geolocation' in navigator) {
          navigator.geolocation.getCurrentPosition(
            position => {
              const lat = position.coords.latitude.toFixed(4);
              const lng = position.coords.longitude.toFixed(4);
              this.speak(`ä½ç½®ç™¼é€æˆåŠŸï¼Œç¶“åº¦${lng}ï¼Œç·¯åº¦${lat}`);
              
              // å¯¦éš›æ‡‰ç”¨ä¸­é€™è£¡æ‡‰è©²ç™¼é€çœŸå¯¦çš„æ±‚åŠ©ä¿¡æ¯
              if (navigator.share) {
                navigator.share({
                  title: 'ç·Šæ€¥æ±‚åŠ©',
                  text: `æˆ‘éœ€è¦å¹«åŠ©ï¼ä½ç½®ï¼šç¶“åº¦${lng}ï¼Œç·¯åº¦${lat}`,
                  url: window.location.href
                });
              }
            },
            error => {
              this.speak('ä½ç½®ç²å–å¤±æ•—ï¼Œä½†æ±‚åŠ©ä¿¡æ¯å·²ç™¼é€');
            }
          );
        }
      }
      
      speak(message) {
        if (this.voiceEnabled && window.speechSynthesis) {
          window.speechSynthesis.cancel();
          const utterance = new SpeechSynthesisUtterance(message);
          utterance.lang = 'zh-TW';
          utterance.rate = 0.9;
          utterance.pitch = 1.0;
          window.speechSynthesis.speak(utterance);
        }
        document.getElementById('voiceFeedback').textContent = message;
      }
    }

    // åˆå§‹åŒ–ç³»çµ±
    const navigation = new EnhancedBlindNavigation();

    // äº‹ä»¶ç›£è½
    document.getElementById('btnStart').addEventListener('click', () => {
      navigation.startContinuousDetection();
    });
    
    document.getElementById('btnStop').addEventListener('click', () => {
      navigation.stopDetection();
    });
    
    document.getElementById('btnToggleVoice').addEventListener('click', () => {
      navigation.toggleVoice();
    });
    
    document.getElementById('btnRepeat').addEventListener('click', () => {
      navigation.repeatWarning();
    });
    
    document.getElementById('btnEmergency').addEventListener('click', () => {
      navigation.emergencyAlert();
    });

    // è‡ªå‹•èªéŸ³æç¤º
    setTimeout(() => {
      if (!navigation.isDetecting) {
        navigation.speak('ç³»çµ±æº–å‚™å°±ç·’ï¼Œè«‹é»æ“Šé–‹å§‹é€£çºŒæª¢æ¸¬æŒ‰éˆ•');
      }
    }, 3000);
  </script>
</body>
</html>