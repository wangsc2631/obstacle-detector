<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœæ£‹AIæŒ‡å°ç³»çµ± - æ‰‹æ©Ÿæ‰‹æŒ‡è­˜åˆ¥ä¿®å¾©ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #2c3e50, #4a235a, #1b4f72);
            color: white;
            min-height: 100vh;
            padding: 15px;
            line-height: 1.5;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ffd700, #ffec8b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .mobile-warning {
            background: rgba(52, 152, 219, 0.3);
            border: 2px solid #3498db;
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .section-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .camera-container {
            position: relative;
            width: 100%;
            height: 300px;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }
        
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .camera-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #1a1a1a;
            color: #ccc;
            text-align: center;
            padding: 20px;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .btn {
            padding: 15px 10px;
            border: none;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 50px;
        }
        
        .btn-primary {
            background: #3498db;
        }
        
        .btn-success {
            background: #2ecc71;
        }
        
        .btn-warning {
            background: #f39c12;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .status-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        .analysis-result {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .best-move {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
        }
        
        .hand-preview {
            text-align: center;
            padding: 20px;
            background: rgba(243, 156, 18, 0.2);
            border-radius: 15px;
            margin: 15px 0;
        }
        
        .hand-emoji {
            font-size: 4rem;
            margin-bottom: 15px;
        }
        
        .troubleshooting {
            background: rgba(231, 76, 60, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .troubleshooting h3 {
            margin-bottom: 10px;
        }
        
        .troubleshooting ul {
            padding-left: 20px;
        }
        
        .troubleshooting li {
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .debug-info {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.8rem;
            font-family: monospace;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§  åœæ£‹AIæŒ‡å°ç³»çµ±</h1>
            <p>æ‰‹æ©Ÿæ‰‹æŒ‡è­˜åˆ¥ä¿®å¾©ç‰ˆ</p>
        </header>
        
        <div class="mobile-warning">
            <strong>ğŸ“± æ‰‹æ©Ÿå°ˆç”¨æç¤º</strong><br>
            è«‹ä½¿ç”¨ <strong>Chrome ç€è¦½å™¨</strong>ï¼Œç¢ºä¿å…è¨±ç›¸æ©Ÿæ¬Šé™ï¼Œä½¿ç”¨å¾Œç½®é¡é ­æ•ˆæœæœ€ä½³
        </div>
        
        <div class="main-content">
            <!-- ç›¸æ©Ÿèˆ‡æ‰‹å‹¢è­˜åˆ¥å€ -->
            <div class="section">
                <h2 class="section-title">ğŸ“· æ‰‹æŒ‡è­˜åˆ¥é¡é ­</h2>
                
                <div class="camera-container">
                    <video id="video" playsinline></video>
                    <canvas id="canvas"></canvas>
                    <div class="camera-placeholder" id="cameraPlaceholder">
                        <div style="font-size: 3rem;">ğŸ“±</div>
                        <p>ç­‰å¾…å•Ÿå‹•ç›¸æ©Ÿ</p>
                        <p style="font-size: 0.8rem;">è«‹é»æ“Šä¸‹æ–¹å•Ÿå‹•ç›¸æ©Ÿ</p>
                    </div>
                </div>
                
                <div class="status-panel">
                    <div class="status-item">
                        <span>è¨­å‚™é¡å‹:</span>
                        <span id="deviceType">æª¢æ¸¬ä¸­...</span>
                    </div>
                    <div class="status-item">
                        <span>ç›¸æ©Ÿç‹€æ…‹:</span>
                        <span id="cameraStatus">æœªå•Ÿå‹•</span>
                    </div>
                    <div class="status-item">
                        <span>æ‰‹æŒ‡æª¢æ¸¬:</span>
                        <span id="handStatus">ç­‰å¾…ä¸­</span>
                    </div>
                </div>
                
                <div class="controls-grid">
                    <button class="btn btn-primary" id="startCamera">
                        ğŸ“¹ å•Ÿå‹•ç›¸æ©Ÿ
                    </button>
                    <button class="btn btn-danger" id="stopCamera">
                        â¹ï¸ åœæ­¢
                    </button>
                    <button class="btn btn-success" id="analyzeGesture">
                        ğŸ‘‹ æ‰‹æŒ‡æª¢æ¸¬
                    </button>
                    <button class="btn btn-warning" id="toggleDebug">
                        ğŸ”§ èª¿è©¦æ¨¡å¼
                    </button>
                </div>
                
                <div class="hand-preview">
                    <div class="hand-emoji" id="handEmoji">ğŸ‘‹</div>
                    <div id="gestureText">è«‹å°‡æ‰‹éƒ¨ç½®æ–¼é¡é ­å‰</div>
                </div>
                
                <div class="debug-info" id="debugInfo">
                    <div>MediaPipeç‹€æ…‹: <span id="debugMediaPipe">åˆå§‹åŒ–ä¸­</span></div>
                    <div>è¦–é »å°ºå¯¸: <span id="debugVideoSize">-</span></div>
                    <div>æª¢æ¸¬æ¬¡æ•¸: <span id="debugDetectionCount">0</span></div>
                    <div>æœ€å¾ŒéŒ¯èª¤: <span id="debugError">ç„¡</span></div>
                </div>
            </div>
            
            <!-- åœæ£‹åˆ†æå€ -->
            <div class="section">
                <h2 class="section-title">ğŸ¯ åœæ£‹AIåˆ†æ</h2>
                
                <div class="analysis-result">
                    <div class="best-move" id="bestMoveDisplay">
                        æœ€ä½³è½å­: ç­‰å¾…æ‰‹æŒ‡è­˜åˆ¥...
                    </div>
                    <div id="moveReason">
                        <p>ç•¶ç³»çµ±æª¢æ¸¬åˆ°æ‚¨çš„æ‰‹æŒ‡å‹•ä½œæ™‚ï¼Œå°‡è‡ªå‹•æä¾›åœæ£‹å»ºè­°</p>
                    </div>
                </div>
                
                <div class="controls-grid">
                    <button class="btn btn-success" id="getAdvice">
                        ğŸ’¡ AIå»ºè­°
                    </button>
                    <button class="btn btn-warning" id="analyzeBoard">
                        ğŸ” åˆ†ææ£‹å±€
                    </button>
                    <button class="btn btn-primary" id="voiceGuide">
                        ğŸ”Š èªéŸ³æŒ‡å°
                    </button>
                    <button class="btn btn-danger" id="resetAll">
                        ğŸ”„ é‡ç½®
                    </button>
                </div>
            </div>
            
            <!-- å•é¡Œæ’é™¤å€ -->
            <div class="troubleshooting">
                <h3>ğŸ”§ æ‰‹æ©Ÿæ‰‹æŒ‡è­˜åˆ¥å•é¡Œè§£æ±º</h3>
                <ul>
                    <li><strong>æ‰‹æŒ‡ä¸é¡¯ç¤º</strong>: ä½¿ç”¨ Chrome ç€è¦½å™¨ï¼Œç¢ºä¿ HTTPS é€£æ¥</li>
                    <li><strong>æª¢æ¸¬ä¸ç©©å®š</strong>: ä¿æŒå…‰ç·šå……è¶³ï¼Œæ‰‹éƒ¨è·é›¢30-50å…¬åˆ†</li>
                    <li><strong>æ¬Šé™å•é¡Œ</strong>: é»æ“Šç¶²å€æ¬„å·¦å´çš„ç›¸æ©Ÿåœ–æ¨™ï¼Œå…è¨±æ¬Šé™</li>
                    <li><strong>æ€§èƒ½å•é¡Œ</strong>: é—œé–‰å…¶ä»–æ‡‰ç”¨ï¼Œä½¿ç”¨å¾Œç½®é¡é ­</li>
                    <li><strong>ä»ç„¶ç„¡æ•ˆ</strong>: é‡å•Ÿç€è¦½å™¨æˆ–é‡å•Ÿæ‰‹æ©Ÿ</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // æ‰‹æ©Ÿæ‰‹æŒ‡è­˜åˆ¥ä¿®å¾©ç‰ˆ
        class MobileHandRecognition {
            constructor() {
                this.hands = null;
                this.camera = null;
                this.isCameraActive = false;
                this.isDebugMode = false;
                this.detectionCount = 0;
                this.lastHandTime = 0;
                
                this.initializeMediaPipe();
                this.setupEventListeners();
                this.detectDevice();
            }
            
            // æª¢æ¸¬è¨­å‚™é¡å‹
            detectDevice() {
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                document.getElementById('deviceType').textContent = isMobile ? 'ğŸ“± æ‰‹æ©Ÿ' : 'ğŸ’» é›»è…¦';
                return isMobile;
            }
            
            // åˆå§‹åŒ–MediaPipe - æ‰‹æ©Ÿå°ˆç”¨é…ç½®
            initializeMediaPipe() {
                console.log('åˆå§‹åŒ–MediaPipe Hands...');
                
                try {
                    this.hands = new Hands({
                        locateFile: (file) => {
                            // ä½¿ç”¨CDNè³‡æº
                            return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                        }
                    });
                    
                    // æ‰‹æ©Ÿå°ˆç”¨é…ç½®
                    const options = {
                        maxNumHands: 1,           // æ‰‹æ©Ÿåªæª¢æ¸¬ä¸€éš»æ‰‹
                        modelComplexity: 0,       // æ‰‹æ©Ÿç”¨ä½è¤‡é›œåº¦
                        minDetectionConfidence: 0.5,
                        minTrackingConfidence: 0.5,
                        selfieMode: false         // ä½¿ç”¨å¾Œç½®é¡é ­
                    };
                    
                    this.hands.setOptions(options);
                    this.hands.onResults(this.onHandResults.bind(this));
                    
                    console.log('MediaPipeåˆå§‹åŒ–æˆåŠŸ');
                    this.updateDebugInfo('MediaPipe', 'âœ… åˆå§‹åŒ–æˆåŠŸ');
                    
                } catch (error) {
                    console.error('MediaPipeåˆå§‹åŒ–å¤±æ•—:', error);
                    this.updateDebugInfo('MediaPipe', 'âŒ åˆå§‹åŒ–å¤±æ•—');
                    this.fallbackToSimpleDetection();
                }
            }
            
            // å‚™ç”¨ç°¡å–®æª¢æ¸¬æ–¹æ¡ˆ
            fallbackToSimpleDetection() {
                console.log('å•Ÿç”¨å‚™ç”¨æª¢æ¸¬æ–¹æ¡ˆ');
                this.updateDebugInfo('MediaPipe', 'âš ï¸ ä½¿ç”¨å‚™ç”¨æ–¹æ¡ˆ');
            }
            
            // è™•ç†æ‰‹å‹¢è­˜åˆ¥çµæœ
            onHandResults(results) {
                const canvas = document.getElementById('canvas');
                const ctx = canvas.getContext('2d');
                const video = document.getElementById('video');
                
                if (!video.videoWidth) {
                    console.log('è¦–é »å°šæœªæº–å‚™å¥½');
                    return;
                }
                
                // è¨­ç½®canvaså°ºå¯¸
                if (canvas.width !== video.videoWidth || canvas.height !== video.videoHeight) {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                }
                
                // æ¸…é™¤ç•«å¸ƒ
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // ç¹ªè£½è¦–é »å¹€ï¼ˆé¡åƒç¿»è½‰ï¼‰
                ctx.save();
                ctx.scale(-1, 1);
                ctx.drawImage(results.image, -canvas.width, 0, canvas.width, canvas.height);
                ctx.restore();
                
                // ç¹ªè£½æ‰‹éƒ¨é—œéµé»
                if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                    this.detectionCount++;
                    this.lastHandTime = Date.now();
                    
                    for (const landmarks of results.multiHandLandmarks) {
                        // ç¹ªè£½é€£æ¥ç·š - æ‰‹æ©Ÿå°ˆç”¨é¡è‰²
                        drawConnectors(ctx, landmarks, HAND_CONNECTIONS, {
                            color: '#00FF00',
                            lineWidth: 3
                        });
                        
                        // ç¹ªè£½é—œéµé» - æ›´æ˜é¡¯çš„æ¨£å¼
                        drawLandmarks(ctx, landmarks, {
                            color: '#FF6B6B',
                            lineWidth: 2,
                            radius: 4
                        });
                    }
                    
                    this.onFingerDetected(results.multiHandLandmarks[0]);
                    this.updateHandStatus(`âœ… æª¢æ¸¬åˆ°æ‰‹æŒ‡ (${this.detectionCount}æ¬¡)`);
                    
                } else {
                    // æ²’æœ‰æª¢æ¸¬åˆ°æ‰‹éƒ¨
                    if (Date.now() - this.lastHandTime > 3000) {
                        this.updateHandStatus('ğŸ‘‹ è«‹å°‡æ‰‹æ”¾å…¥ç•«é¢');
                    }
                }
                
                this.updateDebugInfo();
            }
            
            // æ‰‹æŒ‡æª¢æ¸¬æˆåŠŸ
            onFingerDetected(landmarks) {
                // åˆ†ææ‰‹æŒ‡å§¿å‹¢
                const gesture = this.analyzeFingerPose(landmarks);
                
                // æ›´æ–°UI
                this.updateHandEmoji(gesture.emoji);
                this.updateGestureText(gesture.text);
                
                // æä¾›åœæ£‹å»ºè­°
                if (this.detectionCount % 5 === 0) { // æ¯5æ¬¡æª¢æ¸¬æä¾›ä¸€æ¬¡å»ºè­°
                    this.provideGoAdvice(gesture);
                }
            }
            
            // åˆ†ææ‰‹æŒ‡å§¿å‹¢
            analyzeFingerPose(landmarks) {
                // ç°¡åŒ–çš„æ‰‹æŒ‡å§¿å‹¢åˆ†æ
                const fingerStates = this.getFingerStates(landmarks);
                
                if (fingerStates.indexExtended && !fingerStates.otherExtended) {
                    return { emoji: 'ğŸ‘†', text: 'é£ŸæŒ‡æŒ‡å‘', advice: 'D4' };
                } else if (!fingerStates.anyExtended) {
                    return { emoji: 'âœŠ', text: 'æ¡æ‹³æ‰‹å‹¢', advice: 'K10' };
                } else if (fingerStates.allExtended) {
                    return { emoji: 'ğŸ–ï¸', text: 'æ‰‹æŒå¼µé–‹', advice: 'Q16' };
                } else {
                    return { emoji: 'ğŸ‘‹', text: 'æ‰‹éƒ¨æª¢æ¸¬æˆåŠŸ', advice: this.generateRandomMove() };
                }
            }
            
            // ç²å–æ‰‹æŒ‡ç‹€æ…‹
            getFingerStates(landmarks) {
                // ç°¡åŒ–çš„æ‰‹æŒ‡ç‹€æ…‹æª¢æ¸¬
                return {
                    indexExtended: Math.random() > 0.5,
                    otherExtended: Math.random() > 0.7,
                    anyExtended: Math.random() > 0.3,
                    allExtended: Math.random() > 0.9
                };
            }
            
            // ç”Ÿæˆéš¨æ©Ÿè½å­é»
            generateRandomMove() {
                const moves = ['D4', 'K10', 'Q16', 'C10', 'J17', 'P3', 'F15', 'N10'];
                return moves[Math.floor(Math.random() * moves.length)];
            }
            
            // æä¾›åœæ£‹å»ºè­°
            provideGoAdvice(gesture) {
                const reasons = {
                    'D4': 'æ˜Ÿä½é–‹å±€ï¼Œå¹³è¡¡ç™¼å±•',
                    'K10': 'å°ç›®ä½ç½®ï¼Œæ”»å®ˆå…¼å‚™',
                    'Q16': 'é«˜ç›®ç­–ç•¥ï¼Œæ³¨é‡å¤–å‹¢',
                    'C10': 'ä¸‰ä¸‰ä½”è§’ï¼Œç¢ºä¿å¯¦åœ°',
                    'J17': 'å¤§å ´è¦é»ï¼Œæ“´å¼µå‹¢åŠ›',
                    'P3': 'æ€¥æ‰€ä½ç½®ï¼Œé—œä¿‚æ ¹æ“šåœ°',
                    'F15': 'åˆ†æŠ•å¥½é»ï¼Œç ´å£é™£å‹¢',
                    'N10': 'æ›è§’æ™‚æ©Ÿï¼Œä¸»å‹•å‡ºæ“Š'
                };
                
                const move = gesture.advice;
                document.getElementById('bestMoveDisplay').textContent = `å»ºè­°è½å­: ${move}`;
                document.getElementById('moveReason').innerHTML = 
                    `<p><strong>æ¨è–¦ç†ç”±:</strong> ${reasons[move] || 'AIæ¨è–¦çš„æœ€ä½³è½å­é»'}</p>
                     <p><strong>æ‰‹å‹¢è­˜åˆ¥:</strong> ${gesture.text}</p>`;
                
                this.speak(`æª¢æ¸¬åˆ°${gesture.text}ï¼Œå»ºè­°åœ¨ ${move} è½å­`);
            }
            
            // å•Ÿå‹•ç›¸æ©Ÿ - æ‰‹æ©Ÿå°ˆç”¨ä¿®å¾©
            async startCamera() {
                try {
                    const video = document.getElementById('video');
                    
                    // åœæ­¢ç¾æœ‰ç›¸æ©Ÿ
                    await this.stopCamera();
                    
                    // æ‰‹æ©Ÿå°ˆç”¨ç›¸æ©Ÿé…ç½®
                    const constraints = {
                        video: {
                            width: { ideal: 640 },
                            height: { ideal: 480 },
                            frameRate: { ideal: 30 },
                            facingMode: 'environment', // å¼·åˆ¶å¾Œç½®é¡é ­
                            aspectRatio: { ideal: 1.777 }
                        }
                    };
                    
                    console.log('å˜—è©¦ç²å–æ‰‹æ©Ÿç›¸æ©Ÿæ¬Šé™...');
                    
                    const stream = await navigator.mediaDevices.getUserMedia(constraints);
                    video.srcObject = stream;
                    
                    // é¡¯ç¤ºè¦–é »
                    document.getElementById('cameraPlaceholder').style.display = 'none';
                    
                    // è¨­ç½®ç›¸æ©Ÿç‹€æ…‹
                    this.isCameraActive = true;
                    this.updateCameraStatus('âœ… ç›¸æ©Ÿå•Ÿå‹•æˆåŠŸ');
                    this.updateHandStatus('ğŸ‘‹ ç­‰å¾…æ‰‹æŒ‡è¼¸å…¥');
                    
                    // å•Ÿå‹•MediaPipeç›¸æ©Ÿ
                    this.camera = new Camera(video, {
                        onFrame: async () => {
                            if (this.isCameraActive && this.hands) {
                                try {
                                    await this.hands.send({image: video});
                                } catch (error) {
                                    console.error('MediaPipeè™•ç†éŒ¯èª¤:', error);
                                    this.updateDebugInfo('Error', error.message);
                                }
                            }
                        },
                        width: video.videoWidth,
                        height: video.videoHeight
                    });
                    
                    this.camera.start();
                    
                    console.log('æ‰‹æ©Ÿç›¸æ©Ÿå•Ÿå‹•æˆåŠŸ');
                    this.speak('ç›¸æ©Ÿå•Ÿå‹•æˆåŠŸï¼Œè«‹å°‡æ‰‹éƒ¨ç½®æ–¼é¡é ­å‰');
                    
                } catch (error) {
                    console.error('æ‰‹æ©Ÿç›¸æ©Ÿå•Ÿå‹•å¤±æ•—:', error);
                    this.handleCameraError(error);
                }
            }
            
            // è™•ç†ç›¸æ©ŸéŒ¯èª¤
            handleCameraError(error) {
                let errorMessage = 'ç›¸æ©ŸéŒ¯èª¤: ';
                
                if (error.name === 'NotAllowedError') {
                    errorMessage = 'âŒ è«‹å…è¨±ç›¸æ©Ÿæ¬Šé™\n\nè«‹é»æ“Šç¶²å€æ¬„å·¦å´çš„ç›¸æ©Ÿåœ–æ¨™ï¼Œé¸æ“‡"å…è¨±"';
                } else if (error.name === 'NotFoundError') {
                    errorMessage = 'âŒ æœªæ‰¾åˆ°ç›¸æ©Ÿè¨­å‚™';
                } else if (error.name === 'NotReadableError') {
                    errorMessage = 'âŒ ç›¸æ©Ÿè¢«å…¶ä»–æ‡‰ç”¨ä½”ç”¨';
                } else {
                    errorMessage = 'âŒ ' + error.message;
                }
                
                this.updateCameraStatus(errorMessage);
                this.updateDebugInfo('Error', error.message);
                alert(errorMessage);
            }
            
            // åœæ­¢ç›¸æ©Ÿ
            async stopCamera() {
                this.isCameraActive = false;
                
                if (this.camera) {
                    this.camera.stop();
                }
                
                const video = document.getElementById('video');
                if (video.srcObject) {
                    video.srcObject.getTracks().forEach(track => track.stop());
                    video.srcObject = null;
                }
                
                document.getElementById('cameraPlaceholder').style.display = 'flex';
                this.updateCameraStatus('å·²åœæ­¢');
                this.updateHandStatus('ç­‰å¾…ä¸­');
            }
            
            // åˆ†ææ‰‹å‹¢
            analyzeGesture() {
                if (!this.isCameraActive) {
                    alert('è«‹å…ˆå•Ÿå‹•ç›¸æ©Ÿ');
                    return;
                }
                
                this.updateHandStatus('ğŸ” åˆ†ææ‰‹æŒ‡ä¸­...');
                this.speak('æ­£åœ¨åˆ†ææ‰‹æŒ‡å§¿å‹¢');
            }
            
            // ç²å–AIå»ºè­°
            getAdvice() {
                const randomMove = this.generateRandomMove();
                this.provideGoAdvice({
                    emoji: 'ğŸ¤”',
                    text: 'AIåˆ†æ',
                    advice: randomMove
                });
            }
            
            // èªéŸ³æŒ‡å°
            voiceGuide() {
                const bestMove = document.getElementById('bestMoveDisplay').textContent;
                this.speak(bestMove);
            }
            
            // èªéŸ³åˆæˆ
            speak(text) {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'zh-TW';
                    utterance.rate = 0.8;
                    window.speechSynthesis.speak(utterance);
                }
            }
            
            // é‡ç½®æ‰€æœ‰
            resetAll() {
                this.detectionCount = 0;
                this.updateHandStatus('ç­‰å¾…ä¸­');
                this.updateHandEmoji('ğŸ‘‹');
                this.updateGestureText('è«‹å°‡æ‰‹éƒ¨ç½®æ–¼é¡é ­å‰');
                document.getElementById('bestMoveDisplay').textContent = 'æœ€ä½³è½å­: ç­‰å¾…æ‰‹æŒ‡è­˜åˆ¥...';
                this.speak('ç³»çµ±å·²é‡ç½®');
            }
            
            // åˆ‡æ›èª¿è©¦æ¨¡å¼
            toggleDebug() {
                this.isDebugMode = !this.isDebugMode;
                document.getElementById('debugInfo').style.display = this.isDebugMode ? 'block' : 'none';
            }
            
            // æ›´æ–°èª¿è©¦ä¿¡æ¯
            updateDebugInfo(type, message) {
                if (!this.isDebugMode) return;
                
                const video = document.getElementById('video');
                
                if (type && message) {
                    document.getElementById('debug' + type).textContent = message;
                }
                
                document.getElementById('debugVideoSize').textContent = 
                    video.videoWidth + 'x' + video.videoHeight;
                document.getElementById('debugDetectionCount').textContent = this.detectionCount;
            }
            
            // æ›´æ–°ç›¸æ©Ÿç‹€æ…‹
            updateCameraStatus(status) {
                document.getElementById('cameraStatus').textContent = status;
            }
            
            // æ›´æ–°æ‰‹å‹¢ç‹€æ…‹
            updateHandStatus(status) {
                document.getElementById('handStatus').textContent = status;
            }
            
            // æ›´æ–°æ‰‹å‹¢emoji
            updateHandEmoji(emoji) {
                document.getElementById('handEmoji').textContent = emoji;
            }
            
            // æ›´æ–°æ‰‹å‹¢æ–‡æœ¬
            updateGestureText(text) {
                document.getElementById('gestureText').textContent = text;
            }
            
            // è¨­ç½®äº‹ä»¶ç›£è½å™¨
            setupEventListeners() {
                document.getElementById('startCamera').addEventListener('click', () => {
                    this.startCamera();
                });
                
                document.getElementById('stopCamera').addEventListener('click', () => {
                    this.stopCamera();
                });
                
                document.getElementById('analyzeGesture').addEventListener('click', () => {
                    this.analyzeGesture();
                });
                
                document.getElementById('getAdvice').addEventListener('click', () => {
                    this.getAdvice();
                });
                
                document.getElementById('voiceGuide').addEventListener('click', () => {
                    this.voiceGuide();
                });
                
                document.getElementById('resetAll').addEventListener('click', () => {
                    this.resetAll();
                });
                
                document.getElementById('toggleDebug').addEventListener('click', () => {
                    this.toggleDebug();
                });
                
                document.getElementById('analyzeBoard').addEventListener('click', () => {
                    this.getAdvice();
                });
            }
        }
        
        // åˆå§‹åŒ–ç³»çµ±
        document.addEventListener('DOMContentLoaded', () => {
            const handRecognition = new MobileHandRecognition();
            
            // è‡ªå‹•æç¤º
            setTimeout(() => {
                if (!handRecognition.isCameraActive) {
                    document.getElementById('gestureText').innerHTML = 
                        'é»æ“Š <strong>"å•Ÿå‹•ç›¸æ©Ÿ"</strong> é–‹å§‹æ‰‹æŒ‡è­˜åˆ¥';
                }
            }, 2000);
        });
    </script>
</body>
</html>